<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERP √çMPAR ‚Äì Login Cronograma de Obras</title>

  <style>
    :root{
      --bg:#020617;
      --card:#020617;
      --border:#1f2937;
      --text:#e5e7eb;
      --text-soft:#9ca3af;
      --blue:#3b82f6;
      --blue-dark:#1d4ed8;
      --green:#22c55e;
      --yellow:#eab308;
      --red:#ef4444;
      --accent:#cc6e00;
    }
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:
        radial-gradient(circle at top left,#1d4ed8 0,transparent 55%),
        radial-gradient(circle at bottom right,#f97316 0,transparent 55%),
        linear-gradient(120deg,#020617,#020617 60%,#030712);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      padding:10px 16px 4px;
      display:flex;
      justify-content:center;
    }
    .header-inner{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:space-between;
      gap:16px;
      align-items:flex-start;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      text-shadow:0 2px 6px rgba(0,0,0,.8);
    }
    .brand span:nth-child(1){
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.22em;
      opacity:.9;
    }
    .brand span:nth-child(2){
      font-size:20px;
      font-weight:800;
    }
    .brand span:nth-child(3){
      font-size:11px;
      opacity:.9;
    }

    .tag-top{
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.7);
      color:var(--text-soft);
      display:flex;
      gap:8px;
      align-items:center;
      margin-top:12px;
    }
    .pill-btn{
      border-radius:999px;
      border:1px solid #4b5563;
      background:#020617;
      padding:5px 10px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--text-soft);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:5px;
    }
    .pill-btn span.icn{font-size:12px;}
    .pill-btn:hover{
      border-color:#9ca3af;
      color:#e5e7eb;
    }

    main{
      flex:1 0 auto;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:6px 12px 16px;
    }
    .layout{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:center;
    }

    .container{
      background:rgba(15,23,42,.96);
      border-radius:18px;
      border:1px solid rgba(55,65,81,.9);
      box-shadow:0 18px 40px rgba(0,0,0,.75);
      padding:18px 20px 20px;
      max-width:420px;
      width:100%;
    }

    h1{
      margin-top:0;
      color:#ffffff;
      font-size:18px;
      margin-bottom:6px;
    }
    .subtitulo{
      font-size:12px;
      color:var(--text-soft);
      margin-bottom:14px;
    }

    label{
      display:block;
      font-size:12px;
      margin-bottom:3px;
      color:#cfd8ff;
    }

    select,
    input{
      width:100%;
      padding:7px 9px;
      border-radius:8px;
      border:1px solid #293552;
      background:#020617;
      color:#f5f5f5;
      font-size:13px;
    }

    .senha-container{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .senha-container input{
      flex:1;
    }
    .toggle-eye{
      cursor:pointer;
      font-size:16px;
      user-select:none;
    }

    .linha-opcoes{
      display:flex;
      align-items:center;
      gap:6px;
      margin-top:6px;
      font-size:11px;
      color:var(--text-soft);
    }
    .linha-opcoes input[type="checkbox"]{
      width:auto;
      cursor:pointer;
    }

    button{
      border:none;
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      cursor:pointer;
      margin-top:10px;
      width:100%;
    }
    .btn-primary{
      background:linear-gradient(135deg,#2563eb,#22c55e);
      color:#fff;
      box-shadow:0 10px 24px rgba(0,0,0,.7);
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight:600;
    }

    .msg{
      margin-top:8px;
      font-size:11px;
      min-height:14px;
    }
    .msg.ok{ color:var(--green); }
    .msg.err{ color:var(--red); }

    footer{
      background:#020617;
      color:#9ca3af;
      padding:6px 16px;
      font-size:10px;
    }
    .rodape-inner{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <span>PLATAFORMA</span>
      <span>ERP √çMPAR ‚Ä¢ Cronograma de Obras</span>
      <span>Acesso seguro ao farol e √† linha de base</span>
    </div>
    <div class="tag-top">
      <button class="pill-btn" type="button" id="btnVoltarMenu">
        <span class="icn">üè†</span>
        Menu principal
      </button>
    </div>
  </div>
</header>

<main>
  <div class="layout">
    <div class="container">
      <h1>Login ‚Äì Cronograma de Obras</h1>
      <div class="subtitulo">
        Selecione seu usu√°rio corporativo, informe a senha e acesse o farol
        consolidado das obras e o cronograma detalhado.
      </div>

      <form id="loginForm">
        <div style="margin-bottom:10px;">
          <label for="usuario">Usu√°rio</label>
          <select id="usuario" required>
            <option value="">Selecione o usu√°rio.</option>
          </select>
        </div>

        <div style="margin-bottom:4px;">
          <label for="senha">Senha</label>
          <div class="senha-container">
            <input type="password" id="senha" placeholder="Digite sua senha" autocomplete="current-password" required>
            <span id="toggleSenha" class="toggle-eye">üëÅÔ∏è</span>
          </div>
        </div>

        <div class="linha-opcoes">
          <input type="checkbox" id="lembrarUsuario">
          <label for="lembrarUsuario" style="margin:0;">Lembrar meu usu√°rio neste computador</label>
        </div>

        <button type="submit" class="btn-primary">Entrar</button>

        <div id="msg" class="msg"></div>
      </form>
    </div>
  </div>
</main>

<footer>
  <div class="rodape-inner">
    <span>¬© 2025 ERP √çMPAR ‚Ä¢ Acesso ao Cronograma de Obras</span>
    <span>Layout √çMPAR Premium ‚Äì integrado aos demais m√≥dulos</span>
  </div>
</footer>

<script>
  // Voltar para o menu principal
  document.getElementById("btnVoltarMenu").addEventListener("click", () => {
    window.location.href = "./index.html";
  });

  // Toggle visualizar senha
  const toggleSenha = document.getElementById("toggleSenha");
  const inputSenha  = document.getElementById("senha");

  toggleSenha.addEventListener("click", () => {
    const isPassword = inputSenha.type === "password";
    inputSenha.type = isPassword ? "text" : "password";
    toggleSenha.textContent = isPassword ? "üôà" : "üëÅÔ∏è";
  });

  // ---------- LOGIN CRONOGRAMA ----------
  const URL_USUARIOS_CRONO = "assets/usuario_cronograma.json?_=" + Date.now();
  const STORAGE_LAST_USER_CRONO = "impar_crono_last_user";

  let usuariosCrono = [];

  async function carregarUsuariosCrono(){
    try{
      const resp = await fetch(URL_USUARIOS_CRONO, { cache: "no-store" });
      if(!resp.ok) throw new Error("Falha ao carregar usu√°rios");
      usuariosCrono = await resp.json();

      const select = document.getElementById("usuario");
      select.innerHTML = '<option value="">Selecione o usu√°rio.</option>';

      usuariosCrono.forEach(u => {
        const email = (u.Email || "").trim();
        const nome  = (u.Nome  || "").trim();
        if(!email) return;

        const opt = document.createElement("option");
        opt.value = email.toLowerCase();   // usado na valida√ß√£o
        opt.textContent = nome || email;   // mostra s√≥ o nome, como no doc
        select.appendChild(opt);
      });

      // Recupera √∫ltimo usu√°rio lembrado (se houver)
      const last = localStorage.getItem(STORAGE_LAST_USER_CRONO);
      if(last){
        const opt = Array.from(select.options).find(o => o.value === last.toLowerCase());
        if(opt) select.value = last.toLowerCase();
      }

    }catch(erro){
      console.error(erro);
      const msg = document.getElementById("msg");
      msg.textContent = "N√£o foi poss√≠vel carregar a lista de usu√°rios autorizados.";
      msg.className = "msg err";
    }
  }

  async function processarLoginCrono(event){
    event.preventDefault();

    const selectUsuario   = document.getElementById("usuario");
    const senhaInput      = document.getElementById("senha");
    const lembrarCheck    = document.getElementById("lembrarUsuario");
    const msg             = document.getElementById("msg");

    msg.textContent = "";
    msg.className = "msg";

    const emailSelecionado = (selectUsuario.value || "").trim().toLowerCase();
    const senhaDigitada    = (senhaInput.value || "").trim();

    if(!emailSelecionado || !senhaDigitada){
      msg.textContent = "Selecione um usu√°rio e informe a senha.";
      msg.classList.add("err");
      return;
    }

    try{
      if(!usuariosCrono || usuariosCrono.length === 0){
        await carregarUsuariosCrono();
      }

      const user = usuariosCrono.find(u =>
        (u.Email || "").trim().toLowerCase() === emailSelecionado
      );

      if(!user){
        msg.textContent = "Usu√°rio n√£o autorizado para o Cronograma.";
        msg.classList.add("err");
        return;
      }

      if(user.Senha !== senhaDigitada){
        msg.textContent = "Senha inv√°lida. Verifique e tente novamente.";
        msg.classList.add("err");
        return;
      }

      // Sess√£o padr√£o do ERP
      localStorage.setItem("impar_user", JSON.stringify(user));

      // Lembrar usu√°rio, se marcado
      if(lembrarCheck.checked){
        localStorage.setItem(STORAGE_LAST_USER_CRONO, emailSelecionado);
      }else{
        localStorage.removeItem(STORAGE_LAST_USER_CRONO);
      }

      msg.textContent = "Login realizado com sucesso! Redirecionando...";
      msg.classList.add("ok");

      setTimeout(() => {
        // m√≥dulo cronograma / farol
        window.location.href = "cronograma/farol.html";
      }, 400);

    }catch(e){
      console.error(e);
      msg.textContent = "N√£o foi poss√≠vel autenticar. Verifique sua conex√£o.";
      msg.classList.add("err");
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    carregarUsuariosCrono();
    document.getElementById("loginForm").addEventListener("submit", processarLoginCrono);
  });
</script>

</body>
</html>
