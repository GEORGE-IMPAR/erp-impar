<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ERP √çMPAR ‚Äî Gest√£o de Projetos</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* ... TODO O CSS ANTERIOR IGUAL ... */
    :root{--bg1:#0b1e4a;--bg2:#0e3b6e;--bg3:#0f766e;--panel:rgba(2,6,23,.66);--panel2:rgba(2,6,23,.78);--border:rgba(148,163,184,.45);--text:#e5e7eb;--soft:rgba(229,231,235,.78);--blue:#3b82f6;--green:#22c55e;--yellow:#fbbf24;--red:#ef4444;--radius:18px}*{box-sizing:border-box;margin:0;padding:0}html,body{height:100%}body{min-height:100vh;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--text);background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));display:flex;flex-direction:column;opacity:0}@keyframes imparEnter{0%{opacity:0;transform:translateY(28px) scale(.98);filter:blur(10px)}100%{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}}body.impar-enter{animation:imparEnter .75s cubic-bezier(.16,1,.3,1) both}@media (prefers-reduced-motion:reduce){body{opacity:1}body.impar-enter{animation:none}}header{padding:14px 14px 10px;display:flex;justify-content:center}.header-inner{width:100%;max-width:1200px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}.brand{display:flex;align-items:center;gap:12px;text-shadow:0 2px 6px rgba(0,0,0,.75);min-width:0}.logo-orb{width:36px;height:36px;border-radius:999px;flex:0 0 auto;position:relative;background:conic-gradient(from 210deg,#22c55e,#06b6d4,#3b82f6,#a855f7,#f97316,#22c55e);box-shadow:0 10px 22px rgba(0,0,0,.35),0 0 0 1px rgba(255,255,255,.18) inset;overflow:hidden}.logo-orb:before{content:"";position:absolute;inset:-6px;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.55),transparent 55%)}.brand-text{display:flex;flex-direction:column;gap:2px;min-width:0}.brand-kicker{font-size:12px;letter-spacing:.22em;text-transform:uppercase;font-weight:800;opacity:.9}.brand-title{font-size:18px;font-weight:900;line-height:1.05}.brand-sub{font-size:14px;font-weight:800;opacity:.92;line-height:1.1}.tag-top{margin-left:auto;font-size:11px;padding:6px 10px;border-radius:999px;background:rgba(15,23,42,.85);border:1px solid rgba(148,163,184,.6);color:var(--soft);display:flex;align-items:center;gap:8px}main{flex:1 0 auto;display:flex;justify-content:center;padding:12px 16px 18px}.layout{width:100%;max-width:1200px;display:flex;justify-content:center}.container{width:100%;border-radius:var(--radius);border:1px solid rgba(148,163,184,.6);box-shadow:0 24px 60px rgba(15,23,42,.9);background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));padding:18px}.topbox{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 14px;border-radius:14px;border:2px solid rgba(34,197,94,.45);background:linear-gradient(120deg,rgba(2,6,23,.78),rgba(2,6,23,.35));box-shadow:0 18px 60px rgba(0,0,0,.35);flex-wrap:wrap}.topbox-left .title{font-size:18px;font-weight:900;margin-bottom:4px}.user-label{font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:rgba(156,163,175,.92);margin-bottom:2px;font-weight:800}.user-values{font-size:12px;color:#cfd8ff;line-height:1.25;font-weight:700}.hint{margin:10px 2px 10px;font-size:14px;color:rgba(231,236,255,.92);opacity:.95;line-height:1.35;text-shadow:0 2px 10px rgba(0,0,0,.35)}.card{margin-top:10px;border-radius:16px;border:1px solid rgba(148,163,184,.35);background:rgba(2,6,23,.55);padding:14px;display:flex;flex-direction:column;min-height:280px;box-shadow:0 18px 48px rgba(0,0,0,.22);backdrop-filter:blur(10px)}label{display:block;font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:#9ca3af;margin-bottom:6px;font-weight:900}.req-star{color:#fbbf24;font-weight:900;text-shadow:0 0 10px rgba(251,191,36,.35);margin-left:2px}input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #111827;background:#020617;color:var(--text);font-size:14px;outline:0;font-family:inherit;transition:box-shadow .18s ease,border-color .18s ease}textarea{min-height:80px;resize:vertical}input:focus,select:focus,textarea:focus{border-color:var(--blue);box-shadow:0 0 0 1px rgba(59,130,246,.95),0 0 18px rgba(59,130,246,.4)}.field-group{margin-bottom:14px}.farol-options{display:flex;gap:12px;flex-wrap:wrap}.farol-option{flex:1;min-width:100px}.farol-radio{display:none}.farol-label{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:12px;border:2px solid rgba(148,163,184,.25);background:rgba(2,6,23,.35);cursor:pointer;transition:all .2s ease;font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:.05em}.farol-label:hover{border-color:rgba(148,163,184,.45);background:rgba(2,6,23,.55)}.farol-radio:checked+.farol-label{transform:scale(1.05)}.farol-radio:checked+.farol-label.verde{border-color:var(--green);background:rgba(34,197,94,.15);box-shadow:0 0 20px rgba(34,197,94,.3)}.farol-radio:checked+.farol-label.amarelo{border-color:var(--yellow);background:rgba(251,191,36,.15);box-shadow:0 0 20px rgba(251,191,36,.3)}.farol-radio:checked+.farol-label.vermelho{border-color:var(--red);background:rgba(239,68,68,.15);box-shadow:0 0 20px rgba(239,68,68,.3)}.farol-icon{font-size:24px}.actions{margin-top:auto;display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;padding-top:14px}.btn{border:none;border-radius:999px;padding:10px 16px;font-size:12px;text-transform:uppercase;letter-spacing:.12em;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;min-width:220px;transition:transform .22s cubic-bezier(.16,1,.3,1),box-shadow .22s cubic-bezier(.16,1,.3,1),filter .22s cubic-bezier(.16,1,.3,1)}.btn-primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617;box-shadow:0 10px 30px rgba(22,163,74,.6)}.btn-primary:hover{transform:translateY(-1px) scale(1.035);filter:saturate(1.18) brightness(1.08);box-shadow:0 0 0 1px rgba(34,197,94,.95),0 0 22px rgba(34,197,94,.55),0 18px 45px rgba(22,163,74,.55)}.btn-primary:active{transform:translateY(0) scale(.99)}.btn-secondary{background:#111827;color:#fff;border:1px solid #374151}.btn-secondary:hover{background:#1f2937;transform:translateY(-1px)}.mini-spinner{width:14px;height:14px;border-radius:999px;border:2px solid rgba(2,6,23,.35);border-top-color:rgba(2,6,23,.85);display:inline-block;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}footer{margin-top:auto;background:#020617;color:#9ca3af;padding:8px 12px;font-size:10px;text-align:center}@media (max-width:900px){.btn{width:100%;min-width:unset}input,select,textarea{font-size:16px}.farol-options{flex-direction:column}}
  </style>
</head>
<body>

  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo-orb"></div>
        <div class="brand-text">
          <div class="brand-kicker">ERP</div>
          <div class="brand-title">√çMPAR</div>
          <div class="brand-sub">Gest√£o de Projetos</div>
        </div>
      </div>
      <div class="tag-top">
        <span class="user-label">Logado como</span>
        <strong id="userName">Coordenador</strong>
      </div>
    </div>
  </header>

  <main>
    <div class="layout">
      <div class="container">
        
        <div class="topbox">
          <div class="topbox-left">
            <div class="title">Atualizar Status do Projeto</div>
            <div class="user-values">Mantenha a gest√£o √† vista sempre atualizada</div>
          </div>
        </div>

        <div class="hint">
          üìã Selecione o projeto e atualize o status. A atualiza√ß√£o aparecer√° <strong>automaticamente na TV</strong> da empresa.
        </div>

        <div class="card">
          <form id="formProjeto">
            
            <div class="field-group">
              <label for="projeto">Projeto <span class="req-star">‚òÖ</span></label>
              <select id="projeto" required>
                <option value="">Carregando projetos...</option>
              </select>
            </div>

            <div class="field-group">
              <label for="status">Status Atual <span class="req-star">‚òÖ</span></label>
              <textarea id="status" placeholder="Ex: Funda√ß√£o conclu√≠da, iniciando estrutura met√°lica..." required></textarea>
            </div>

            <div class="field-group">
              <label for="execucao">Tipo de Execu√ß√£o <span class="req-star">‚òÖ</span></label>
              <select id="execucao" required>
                <option value="">Selecione...</option>
                <option value="Interno">Interno</option>
                <option value="Empreiteiro">Empreiteiro</option>
              </select>
            </div>

            <div class="field-group">
              <label>Farol de Status <span class="req-star">‚òÖ</span></label>
              <div class="farol-options">
                <div class="farol-option">
                  <input type="radio" name="farol" value="verde" id="farol-verde" class="farol-radio" required>
                  <label for="farol-verde" class="farol-label verde">
                    <span class="farol-icon">üü¢</span>
                    <span>Verde</span>
                  </label>
                </div>
                <div class="farol-option">
                  <input type="radio" name="farol" value="amarelo" id="farol-amarelo" class="farol-radio">
                  <label for="farol-amarelo" class="farol-label amarelo">
                    <span class="farol-icon">üü°</span>
                    <span>Amarelo</span>
                  </label>
                </div>
                <div class="farol-option">
                  <input type="radio" name="farol" value="vermelho" id="farol-vermelho" class="farol-radio">
                  <label for="farol-vermelho" class="farol-label vermelho">
                    <span class="farol-icon">üî¥</span>
                    <span>Vermelho</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="actions">
              <button type="button" class="btn btn-secondary" onclick="window.location.href='index.html'">
                ‚Üê Voltar
              </button>
              <button type="submit" class="btn btn-primary" id="btnSalvar">
                üíæ Atualizar Projeto
              </button>
            </div>

          </form>
        </div>

      </div>
    </div>
  </main>

  <footer>
    <div>¬© 2026 ERP √çMPAR ‚Äî Sistema de Gest√£o Integrada</div>
  </footer>

  <!-- JavaScript -->
  <script src="js/gestao_projetos.js"></script>
  <script>
    // Anima√ß√£o de entrada
    setTimeout(() => document.body.classList.add('impar-enter'), 50);

    // Usu√°rio logado
    const usuarioLogado = localStorage.getItem('usuarioNome') || 'Nicolas';
    document.getElementById('userName').textContent = usuarioLogado;

    // Carregar lista de projetos ao iniciar
    async function carregarListaProjetos() {
      try {
        const projetos = await listarProjetos();
        const select = document.getElementById('projeto');
        
        select.innerHTML = '<option value="">Selecione o projeto...</option>';
        
        projetos.forEach(projeto => {
          const option = document.createElement('option');
          option.value = projeto.id;
          option.textContent = projeto.nome;
          option.dataset.coordenador = projeto.coordenador;
          select.appendChild(option);
        });
        
      } catch (error) {
        mostrarErro('Erro', 'N√£o foi poss√≠vel carregar a lista de projetos');
        console.error(error);
      }
    }

    // Carregar dados do projeto selecionado
    document.getElementById('projeto').addEventListener('change', async function() {
      if (!this.value) return;
      
      try {
        const projetos = await listarProjetos();
        const projeto = projetos.find(p => p.id == this.value);
        
        if (projeto) {
          document.getElementById('status').value = projeto.status;
          document.getElementById('execucao').value = projeto.execucao;
          document.querySelector(`input[name="farol"][value="${projeto.farol}"]`).checked = true;
        }
      } catch (error) {
        console.error('Erro ao carregar dados do projeto:', error);
      }
    });

    // Submit do formul√°rio
    document.getElementById('formProjeto').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const btnSalvar = document.getElementById('btnSalvar');
      btnSalvar.disabled = true;
      btnSalvar.innerHTML = '<span class="mini-spinner"></span> Salvando...';

      const dados = {
        projeto_id: document.getElementById('projeto').value,
        projeto_nome: document.getElementById('projeto').options[document.getElementById('projeto').selectedIndex].text,
        status: document.getElementById('status').value,
        execucao: document.getElementById('execucao').value,
        farol: document.querySelector('input[name="farol"]:checked').value,
        coordenador: usuarioLogado
      };

      try {
        const resultado = await atualizarProjeto(dados);
        
        mostrarSucesso(
          'Projeto Atualizado!',
          `${dados.projeto_nome} foi atualizado com sucesso. A TV ser√° atualizada automaticamente.`
        );
        
        // Resetar form
        document.getElementById('formProjeto').reset();
        
      } catch (error) {
        mostrarErro('Erro ao Atualizar', error.message);
      } finally {
        btnSalvar.disabled = false;
        btnSalvar.innerHTML = 'üíæ Atualizar Projeto';
      }
    });

    // Inicializar
    carregarListaProjetos();
  </script>

</body>
</html>