<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ERP √çMPAR ‚Äî Gest√£o √† Vista TV</title>
  <style>
    :root{
      --bg1:#0b1e4a;
      --bg2:#0e3b6e;
      --bg3:#0f766e;
      --text: #e5e7eb;
      --green:#22c55e;
      --yellow:#facc15;
      --red:#ef4444;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow:hidden}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
      display:flex;
      flex-direction:column;
    }

    header{
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(2,6,23,.85);
      border-bottom:2px solid rgba(34,197,94,.3);
      flex-shrink:0;
      position:relative;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo-orb{
      width:42px;height:42px;border-radius:999px;
      position:relative;
      background: conic-gradient(from 210deg,#22c55e,#06b6d4,#3b82f6,#a855f7,#f97316,#22c55e);
      box-shadow:0 10px 22px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.18) inset;
      overflow:hidden;
    }
    .logo-orb:before{
      content:""; position:absolute; inset:-6px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 55%);
    }
    .brand-text{display:flex; flex-direction:column; gap:1px;}
    .brand-kicker{font-size:11px; letter-spacing:.22em; text-transform:uppercase; font-weight:800; opacity:.9;}
    .brand-title{font-size:24px; font-weight:900; line-height:1;}
    .brand-sub{font-size:15px; font-weight:800; opacity:.92;}

    .header-info{
      text-align:right;
      font-size:13px;
    }
    .header-info strong{
      display:block;
      font-size:16px;
      color:var(--green);
      margin-bottom:4px;
    }
    .relogio{
      font-size:28px;
      font-weight:900;
      font-variant-numeric:tabular-nums;
    }

    /* >>> Linha discreta para usu√°rio logado (n√£o muda layout) <<< */
    .header-user{
      margin-top:6px;
      font-size:12px;
      opacity:.85;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:520px;
      margin-left:auto;
    }
    .header-user b{
      color:var(--green);
      font-weight:900;
    }

    .ultima-sync{
      position:absolute;
      top:16px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(34,197,94,.15);
      border:1px solid rgba(34,197,94,.4);
      padding:8px 16px;
      border-radius:999px;
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
      animation:pulseSync 2s ease-in-out infinite;
      z-index:2;
    }
    @keyframes pulseSync{
      0%, 100%{opacity:.9; transform:translateX(-50%) scale(1);}
      50%{opacity:1; transform:translateX(-50%) scale(1.02);}
    }

    .btn-fullscreen{
      position:fixed;
      bottom:20px;
      right:20px;
      background:var(--green);
      color:#000;
      border:none;
      padding:14px 24px;
      border-radius:12px;
      font-size:16px;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(34,197,94,.4);
      transition:all .3s;
      z-index:9999;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-fullscreen:hover{
      transform:scale(1.05);
      box-shadow:0 12px 30px rgba(34,197,94,.6);
    }
    .btn-fullscreen.hide{
      display:none;
    }

    main{
      flex:1;
      overflow-y:auto;
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .container{
      width:100%;
      max-width:1400px;
    }

    .projetos-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(380px, 1fr));
      gap:20px;
    }

    .projeto-card{
      padding:24px;
      border-radius:16px;
      border:2px solid rgba(148,163,184,.4);
      background:rgba(2,6,23,.75);
      box-shadow:0 10px 30px rgba(0,0,0,.4);
      position:relative;
      transition:all .3s;
    }

    .projeto-card.atualizado{
      animation:destaque 2s ease-out;
      border-color:var(--green);
      box-shadow:0 0 30px rgba(34,197,94,.5), 0 10px 30px rgba(0,0,0,.4);
    }

    @keyframes destaque{
      0%, 100%{transform:scale(1);}
      50%{transform:scale(1.02);}
    }

    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:16px;
    }

    .card-titulo{
      font-size:22px;
      font-weight:900;
      color:#fff;
      line-height:1.2;
    }

    .farol{
      width:50px;
      height:50px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:32px;
      flex-shrink:0;
      animation:pulse 2s ease-in-out infinite;
    }
    .farol.verde{
      background:radial-gradient(circle, rgba(34,197,94,.25), transparent);
      box-shadow:0 0 25px rgba(34,197,94,.5);
    }
    .farol.amarelo{
      background:radial-gradient(circle, rgba(250,204,21,.25), transparent);
      box-shadow:0 0 25px rgba(250,204,21,.5);
    }
    .farol.vermelho{
      background:radial-gradient(circle, rgba(239,68,68,.25), transparent);
      box-shadow:0 0 25px rgba(239,68,68,.5);
    }

    @keyframes pulse{
      0%, 100%{transform:scale(1); opacity:1;}
      50%{transform:scale(1.08); opacity:.85;}
    }

    .card-info{
      display:flex;
      gap:12px;
      margin-bottom:14px;
    }
    .info-badge{
      flex:1;
      padding:8px 10px;
      border-radius:8px;
      background:rgba(15,23,42,.6);
      border:1px solid rgba(148,163,184,.2);
      font-size:11px;
    }
    .info-badge-label{
      text-transform:uppercase;
      letter-spacing:.05em;
      opacity:.7;
      margin-bottom:3px;
    }
    .info-badge-value{
      font-size:14px;
      font-weight:700;
    }

    .card-status{
      padding:14px;
      border-radius:10px;
      background:linear-gradient(135deg, rgba(2,6,23,.6), rgba(15,118,110,.1));
      border:1px solid rgba(34,197,94,.2);
      margin-bottom:12px;
      min-height:70px;
    }
    .status-label{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--green);
      margin-bottom:6px;
      font-weight:800;
    }
    .status-text{
      font-size:14px;
      line-height:1.4;
      color:#fff;
    }

    .card-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding-top:10px;
      border-top:1px solid rgba(148,163,184,.15);
      font-size:11px;
      opacity:.8;
    }
    .footer-user{
      font-weight:700;
      color:var(--green);
    }

    .badge-novo{
      position:absolute;
      top:-8px;
      right:-8px;
      background:var(--green);
      color:#000;
      padding:4px 12px;
      border-radius:999px;
      font-size:10px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.05em;
      box-shadow:0 4px 12px rgba(34,197,94,.4);
      animation:badgePulse 1.5s ease-in-out infinite;
    }

    @keyframes badgePulse{
      0%, 100%{transform:scale(1);}
      50%{transform:scale(1.1);}
    }

    .loading{
      text-align:center;
      padding:60px;
      font-size:20px;
      opacity:.7;
    }

    footer{
      padding:10px;
      text-align:center;
      font-size:11px;
      opacity:.6;
      background:rgba(2,6,23,.5);
      flex-shrink:0;
    }

    main::-webkit-scrollbar{
      width:10px;
    }
    main::-webkit-scrollbar-track{
      background:rgba(15,23,42,.3);
    }
    main::-webkit-scrollbar-thumb{
      background:rgba(34,197,94,.4);
      border-radius:5px;
    }
    main::-webkit-scrollbar-thumb:hover{
      background:rgba(34,197,94,.6);
    }

    .projetos-grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      grid-template-rows:repeat(2, 1fr);
      gap:20px;
    }

    /* s√≥ o miolo anima (o grid) */
    .slide-out{
      animation:slideOut .55s ease-in forwards;
    }
    .slide-in{
      animation:slideIn .55s ease-out forwards;
    }

    @keyframes slideOut{
      from{ transform:translateX(0); opacity:1; }
      to{ transform:translateX(-60px); opacity:0; }
    }
    @keyframes slideIn{
      from{ transform:translateX(60px); opacity:0; }
      to{ transform:translateX(0); opacity:1; }
    }

    /* destaque mais ‚ÄúTV-friendly‚Äù quando atualiza */
    .projeto-card.atualizado{
      animation:destaque 2.6s ease-out;
      border-color:var(--green);
      box-shadow:0 0 40px rgba(34,197,94,.65), 0 10px 30px rgba(0,0,0,.4);
    }

    /* ===== CARD DESATUALIZADO (stale) ===== */
.projeto-card.stale{
  border-color: var(--red) !important;
  box-shadow: 0 0 26px rgba(239,68,68,.85), 0 10px 30px rgba(0,0,0,.4) !important;
  animation: stalePulse 1.1s ease-in-out infinite !important;
}
@keyframes stalePulse{
  0%,100%{ transform:scale(1); filter:brightness(1); }
  50%{ transform:scale(1.02); filter:brightness(1.25); }
}

/* ===== BADGE "FALTA ATUALIZA√á√ÉO!" ===== */
.badge-stale{
  position:absolute;
  top:-8px;
  right:-8px;
  background: var(--red);
  color:#000;
  padding:4px 12px;
  border-radius:999px;
  font-size:10px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:.05em;
  box-shadow:0 4px 12px rgba(239,68,68,.55);
  animation:badgePulseRed 1.2s ease-in-out infinite;
}
@keyframes badgePulseRed{
  0%,100%{transform:scale(1); filter:brightness(1);}
  50%{transform:scale(1.12); filter:brightness(1.15);}
}
/* ===== TV: ocupar mais a tela (override final) ===== */

/* 1) Menos ‚Äúmoldura‚Äù */
header{ padding:12px 16px; }
main{ padding:12px 14px; }         /* era 24px */
footer{ padding:8px; }

/* 2) Container 100% (sem max-width limitando) */
.container{ max-width:none; width:100%; }

/* 3) Grid ocupa a √°rea toda e divide em 3x2 de verdade */
.projetos-grid{
  width:100%;
  height: calc(100vh - 120px);     /* ajusta a altura √∫til (header+footer) */
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap:16px;                        /* era 20px (pode testar 14/16) */
}

/* 4) Card estica e fica mais ‚ÄúTV friendly‚Äù */
.projeto-card{
  padding:22px;                    /* um pouco maior */
  border-radius:18px;
}

/* 5) Fontes maiores (nitidez de longe) */
.card-titulo{ font-size:26px; }
.status-text{ font-size:16px; line-height:1.45; }
.info-badge-value{ font-size:16px; }
.info-badge{ font-size:12px; }
.relogio{ font-size:32px; }
.header-info strong{ font-size:18px; }

/* 6) Farol maior */
.farol{
  width:58px;
  height:58px;
  font-size:36px;
}

/* 7) Status com mais presen√ßa */
.card-status{
  min-height:92px;
  padding:16px;
}

/* 8) Ajuste fino para TVs menores */
@media (max-width:1200px){
  .projetos-grid{ gap:12px; }
  .card-titulo{ font-size:22px; }
  .status-text{ font-size:14px; }
  .farol{ width:52px; height:52px; font-size:32px; }
} 
/* ===== ALERTA FULLSCREEN (SEG/SEX) ===== */
.alert-overlay{
  position:fixed;
  inset:0;
  z-index:99999;
  display:none;
  align-items:center;
  justify-content:center;
  padding: clamp(14px, 3vw, 42px);
  color:#fff;
}

.alert-overlay.show{ display:flex; }

.alert-bg{
  position:absolute; inset:-25%;
  background:
    radial-gradient(circle at 25% 20%, rgba(250,204,21,.22), transparent 55%),
    radial-gradient(circle at 70% 70%, rgba(239,68,68,.16), transparent 55%),
    radial-gradient(circle at 50% 95%, rgba(34,197,94,.10), transparent 50%),
    linear-gradient(135deg, rgba(2,6,23,.85), rgba(2,6,23,.92));
  filter: blur(18px);
  opacity:.95;
  animation: alertFloat 10s ease-in-out infinite;
}

@keyframes alertFloat{
  0%{transform:translate3d(-1%, -1%, 0) scale(1.02);}
  50%{transform:translate3d(1%, 2%, 0) scale(1.06);}
  100%{transform:translate3d(-1%, -1%, 0) scale(1.02);}
}

.alert-card{
  position:relative;
  width:min(1180px, 96vw);
  border-radius:28px;
  background: rgba(2,6,23,.72);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
  padding: clamp(22px, 3.5vw, 44px);
  transform: translateY(16px) scale(.985);
  opacity:0;
  animation: alertEnter 0.9s cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes alertEnter{ to{transform:translateY(0) scale(1); opacity:1;} }

.alert-card:before{
  content:"";
  position:absolute; inset:-2px;
  background: conic-gradient(from 180deg,
    rgba(250,204,21,.90),
    rgba(255,152,0,.70),
    rgba(239,68,68,.40),
    rgba(250,204,21,.90));
  filter: blur(10px);
  opacity:.55;
  animation: alertSpin 6s linear infinite;
}

@keyframes alertSpin{ to{ transform:rotate(360deg);} }

.alert-card:after{
  content:"";
  position:absolute; inset:2px;
  border-radius:26px;
  background: linear-gradient(180deg, rgba(2,6,23,.72), rgba(2,6,23,.90));
}

.alert-kicker,
.alert-title,
.alert-msg,
.alert-sub,
.alert-side,
.alert-footer{
  position:relative;
  z-index:2;
}

.alert-kicker{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(250,204,21,.14);
  border:1px solid rgba(250,204,21,.35);
  font-weight:900;
  letter-spacing:.22em;
  text-transform:uppercase;
  font-size: 12px;
}

.alert-dot{
  width:10px;height:10px;border-radius:50%;
  background:#facc15;
  box-shadow: 0 0 0 10px rgba(250,204,21,.18);
  animation: alertPing 1.6s ease-out infinite;
}

@keyframes alertPing{
  0%{transform:scale(.9); box-shadow:0 0 0 0 rgba(250,204,21,.0);}
  60%{transform:scale(1); box-shadow:0 0 0 16px rgba(250,204,21,.18);}
  100%{transform:scale(1.02); box-shadow:0 0 0 26px rgba(250,204,21,.0);}
}

.alert-title{
  margin:16px 0 10px;
  font-size: clamp(36px, 4.5vw, 58px);
  line-height:1.02;
  letter-spacing:-.8px;
  font-weight:1000;
}

.alert-msg{
  margin:0;
  font-size: clamp(18px, 2.2vw, 26px);
  line-height:1.35;
  color: rgba(255,255,255,.92);
  max-width: 60ch;
}

.alert-sub{
  margin-top:14px;
  font-size: clamp(14px, 1.7vw, 16px);
  color: rgba(255,255,255,.74);
}

.alert-side{
  margin-top:20px;
  padding:16px;
  border-radius:18px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;
  flex-direction:column;
  gap:10px;
}

.alert-icon{
  font-size:72px;
  text-align:center;
  filter: drop-shadow(0 18px 18px rgba(0,0,0,.35));
  animation: alertPop 2.8s ease-in-out infinite;
}

@keyframes alertPop{
  0%,100%{transform:translateY(0) scale(1);}
  50%{transform:translateY(-6px) scale(1.03);}
}

.alert-progressWrap{
  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 999px;
  overflow:hidden;
  height: 12px;
}

.alert-bar{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, #facc15, #ff9800);
}

.alert-timerRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  color: rgba(255,255,255,.72);
}

.alert-footer{
  margin-top:18px;
  display:flex;
  justify-content:space-between;
  gap:12px;
  font-size:12px;
  color: rgba(255,255,255,.65);
  opacity:.95;
}

.alert-leave{
  animation: alertLeave .75s ease forwards !important;
}

@keyframes alertLeave{
  to{opacity:0; transform: translateY(18px) scale(.985);}
}

/* ===== ALERTA 16:00 ‚Äî ALOCA√á√ïES DI√ÅRIAS (FULLSCREEN) ===== */
.daily-alloc-overlay{
  position:fixed;
  inset:0;
  z-index:100000; /* acima de tudo */
  display:none;
  align-items:center;
  justify-content:center;
  padding: clamp(14px, 3vw, 42px);
  color:#fff;
}
.daily-alloc-overlay.show{ display:flex; }

.daily-alloc-bg{
  position:absolute; inset:-25%;
  background:
    radial-gradient(circle at 25% 20%, rgba(239,68,68,.26), transparent 58%),
    radial-gradient(circle at 75% 70%, rgba(250,204,21,.20), transparent 58%),
    radial-gradient(circle at 50% 95%, rgba(34,197,94,.10), transparent 52%),
    linear-gradient(135deg, rgba(2,6,23,.88), rgba(2,6,23,.95));
  filter: blur(18px);
  opacity:.98;
  animation: dailyAllocFloat 7s ease-in-out infinite;
}
@keyframes dailyAllocFloat{
  0%{transform:translate3d(-1%, -1%, 0) scale(1.03);}
  50%{transform:translate3d(1%, 2%, 0) scale(1.08);}
  100%{transform:translate3d(-1%, -1%, 0) scale(1.03);}
}

.daily-alloc-card{
  position:relative;
  width:min(1180px, 96vw);
  border-radius:28px;
  background: rgba(2,6,23,.78);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow:0 18px 70px rgba(0,0,0,.62);
  overflow:hidden;
  padding: clamp(22px, 3.5vw, 46px);
  transform: translateY(18px) scale(.98);
  opacity:0;
  animation: dailyAllocEnter .85s cubic-bezier(.2,.9,.2,1) forwards;
}
@keyframes dailyAllocEnter{ to{transform:translateY(0) scale(1); opacity:1;} }

.daily-alloc-card:before{
  content:"";
  position:absolute; inset:-2px;
  background: conic-gradient(from 180deg,
    rgba(239,68,68,.92),
    rgba(250,204,21,.70),
    rgba(239,68,68,.92));
  filter: blur(10px);
  opacity:.65;
  animation: dailyAllocSpin 3.6s linear infinite; /* mais agressivo */
}
@keyframes dailyAllocSpin{ to{ transform:rotate(360deg);} }

.daily-alloc-card:after{
  content:"";
  position:absolute; inset:2px;
  border-radius:26px;
  background: linear-gradient(180deg, rgba(2,6,23,.74), rgba(2,6,23,.94));
}

.daily-alloc-kicker,
.daily-alloc-title,
.daily-alloc-msg,
.daily-alloc-sub,
.daily-alloc-side,
.daily-alloc-footer{
  position:relative;
  z-index:2;
}

.daily-alloc-kicker{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(239,68,68,.16);
  border:1px solid rgba(239,68,68,.45);
  font-weight:1000;
  letter-spacing:.18em;
  text-transform:uppercase;
  font-size: 12px;
}

.daily-alloc-dot{
  width:10px;height:10px;border-radius:50%;
  background:#ef4444;
  box-shadow: 0 0 0 12px rgba(239,68,68,.22);
  animation: dailyAllocPing 1.0s ease-out infinite; /* mais r√°pido */
}
@keyframes dailyAllocPing{
  0%{transform:scale(.9); box-shadow:0 0 0 0 rgba(239,68,68,.0);}
  60%{transform:scale(1); box-shadow:0 0 0 18px rgba(239,68,68,.22);}
  100%{transform:scale(1.02); box-shadow:0 0 0 32px rgba(239,68,68,.0);}
}

.daily-alloc-title{
  margin:16px 0 10px;
  font-size: clamp(38px, 4.6vw, 60px);
  line-height:1.02;
  letter-spacing:-.8px;
  font-weight:1000;
}

.daily-alloc-msg{
  margin:0;
  font-size: clamp(18px, 2.25vw, 27px);
  line-height:1.35;
  color: rgba(255,255,255,.94);
  max-width: 62ch;
}
.daily-alloc-sub{
  margin-top:14px;
  font-size: clamp(14px, 1.7vw, 16px);
  color: rgba(255,255,255,.78);
}

.daily-alloc-side{
  margin-top:22px;
  padding:16px;
  border-radius:18px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;
  flex-direction:column;
  gap:10px;
}

.daily-alloc-icon{
  font-size:74px;
  text-align:center;
  filter: drop-shadow(0 20px 20px rgba(0,0,0,.40));
  animation: dailyAllocShake 0.9s ease-in-out infinite;
}
@keyframes dailyAllocShake{
  0%,100%{transform:translateX(0) rotate(0);}
  25%{transform:translateX(-2px) rotate(-1deg);}
  50%{transform:translateX(2px) rotate(1deg);}
  75%{transform:translateX(-1px) rotate(-.6deg);}
}

.daily-alloc-progressWrap{
  background: rgba(0,0,0,.28);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 999px;
  overflow:hidden;
  height: 12px;
}

.daily-alloc-bar{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, #ef4444, #facc15);
}

.daily-alloc-timerRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  color: rgba(255,255,255,.74);
}

.daily-alloc-footer{
  margin-top:18px;
  display:flex;
  justify-content:space-between;
  gap:12px;
  font-size:12px;
  color: rgba(255,255,255,.66);
  opacity:.98;
}

.daily-alloc-leave{
  animation: dailyAllocLeave .75s ease forwards !important;
}
@keyframes dailyAllocLeave{
  to{opacity:0; transform: translateY(20px) scale(.985);}
}
    
  </style>
</head>
<body>

 <!-- ===== ALERTA FULLSCREEN (SEG/SEX) ===== -->
<div id="alertOverlay" class="alert-overlay" aria-hidden="true">
  <div class="alert-bg"></div>

  <section class="alert-card" role="region" aria-label="Alerta Operacional">
    <div class="alert-kicker">
      <span class="alert-dot"></span>
      ALERTA OPERACIONAL
    </div>

    <h1 class="alert-title">Coordenadores</h1>

    <p class="alert-msg">
      N√£o esque√ßam de enviar a <b>lista dos colaboradores</b>
      que ir√£o <b>viajar na pr√≥xima semana</b>.
    </p>

    <div class="alert-sub">
      üìã Planejamento log√≠stico e operacional depende dessa informa√ß√£o.
    </div>

    <div class="alert-side">
      <div class="alert-icon">‚úàÔ∏è</div>

      <div class="alert-progressWrap" aria-hidden="true">
        <div class="alert-bar" id="alertBar"></div>
      </div>

      <div class="alert-timerRow">
        <span id="alertDayInfo">‚Äî</span>
        <span><span id="alertSec">20</span>s</span>
      </div>
    </div>

    <div class="alert-footer">
      <span>ERP √çMPAR ‚Ä¢ Gest√£o √† Vista</span>
      <span id="alertStamp">‚Äî</span>
    </div>
  </section>
</div>
  
<button class="btn-fullscreen" id="btnFullscreen" onclick="ativarFullscreen()">
  üñ•Ô∏è Ativar Tela Cheia
</button>

<header>
  <div class="brand">
    <div class="logo-orb"></div>
    <div class="brand-text">
      <div class="brand-kicker">ERP</div>
      <div class="brand-title">√çMPAR</div>
      <div class="brand-sub">Gest√£o √† Vista</div>
    </div>
  </div>

  <div class="ultima-sync" id="ultimaSync">
    üîÑ Sincronizando...
  </div>

  <div class="header-info">
    <strong id="dataAtual">‚Äî</strong>
    <div class="relogio" id="relogio">00:00:00</div>
    <div class="header-user" id="tvUser">Logado: <b id="tvUserName">‚Äî</b> <span id="tvUserEmail" style="opacity:.75;font-size:11px">‚Äî</span></div>
  </div>
</header>

<main>
  <div class="container">
    <div class="projetos-grid" id="projetosGrid">
      <div class="loading">üìä Carregando projetos...</div>
    </div>
  </div>
</main>

<footer>
  ERP √çMPAR ¬© 2026 ‚Äî Atualiza√ß√£o autom√°tica a cada 10 segundos
</footer>

<script>
const API_BASE = 'https://api.erpimpar.com.br/tv';

let projetosAtuais = [];
let ultimaAtualizacaoGlobal = null;
let ultimaAtualizacaoUsuario = null;

const PAGE_SIZE = 6;
const PAGE_INTERVAL_MS = 20000; // EX: 20s (ajuste como quiser)
const STALE_MS = 24 * 60 * 60 * 1000; // 1 dia

let pageIndex = 0;
let pageTimer = null;

let highlightProjectId = null;
let highlightUntilTs = 0;

// ===== ALERTA (SEG/SEX) NO LOOP =====
const ALERT_DURATION_MS = 20000; // 20s (igual PAGE_INTERVAL_MS)
let virtualIndex = 0;            // 0 = ALERTA, 1..N = p√°ginas normais
let alertShowing = false;

function isMondayOrFriday(d){
  const day = d.getDay(); // 0 dom, 1 seg, ... 5 sex
  return (day === 1 || day === 5);
}

function startAlertBar(){
  const bar = document.getElementById("alertBar");
  if(!bar) return;
  bar.style.transition = "none";
  bar.style.width = "0%";
  // for√ßa reflow
  bar.offsetHeight;
  bar.style.transition = `width ${ALERT_DURATION_MS}ms linear`;
  bar.style.width = "100%";
}
// ===== BEEP (sem arquivo) =====
function beep(times = 2, gapMs = 120){
  try{
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if(!AudioCtx) return;

    const ctx = new AudioCtx();

    // alguns browsers bloqueiam som sem intera√ß√£o do usu√°rio
    // ent√£o tentamos "acordar" o contexto
    if (ctx.state === "suspended") ctx.resume();

    let t = ctx.currentTime + 0.02;

    for(let i=0;i<times;i++){
      const o = ctx.createOscillator();
      const g = ctx.createGain();

      o.type = "sine";
      o.frequency.value = 880; // tom do bip
      g.gain.value = 0.0001;

      o.connect(g);
      g.connect(ctx.destination);

      // envelope r√°pido (bip curto)
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.20, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + 0.14);

      o.start(t);
      o.stop(t + 0.16);

      t += (gapMs/1000) + 0.16;
    }

    setTimeout(() => { try{ ctx.close(); }catch(e){} }, 1200);

  } catch(e){
    // se falhar, s√≥ ignora (TV segue normal)
  }
}
function showTravelAlert(){
  const overlay = document.getElementById("alertOverlay");
  const card = overlay ? overlay.querySelector(".alert-card") : null;
  if(!overlay || !card) return;

  const now = new Date();
  const days = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  const stamp = now.toLocaleString('pt-BR', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit' });

  document.getElementById("alertDayInfo").textContent = "Hoje: " + days[now.getDay()];
  document.getElementById("alertStamp").textContent = stamp;

  // contador 20 -> 0
  let remaining = Math.ceil(ALERT_DURATION_MS/1000);
  const secEl = document.getElementById("alertSec");
  if(secEl) secEl.textContent = remaining;

  overlay.classList.add("show");
  beep(2); // 2 bips
  overlay.setAttribute("aria-hidden","false");
  alertShowing = true;

  startAlertBar();

  const tick = setInterval(() => {
    remaining--;
    if(remaining < 0) remaining = 0;
    if(secEl) secEl.textContent = remaining;
  }, 1000);

  setTimeout(() => {
    card.classList.add("alert-leave");
    setTimeout(() => {
      clearInterval(tick);
      card.classList.remove("alert-leave");
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      alertShowing = false;
      virtualIndex = 0;
    }, 780);
  }, ALERT_DURATION_MS);
}
// ====================================

// ===== Logged user (ERP √çMPAR) ‚Äî vers√£o √öNICA (mesma do APP) =====
function getLoggedUser(){
  const candidates = [];

  const primaryKey = "ERPIMPAR_USER";
  const rawPrimary = (localStorage.getItem(primaryKey) || sessionStorage.getItem(primaryKey) || "").trim();
  if(rawPrimary) candidates.push(rawPrimary);

  const keys = ["usuarioLogado","impar_user","imparUser","user","ERP_IMPAR_USER","ERPIMPAR_LOGIN"];
  for(const k of keys){
    const raw = (localStorage.getItem(k) || sessionStorage.getItem(k) || "").trim();
    if(raw) candidates.push(raw);
  }

  for(const raw of candidates){
    try{
      const u = JSON.parse(raw);
      const nome  = (u.Nome || u.nome || u.name || u.userName || u.usuario || u.usuarioNome || "").toString().trim();
      const email = (u.Email || u.email || u.mail || u.userEmail || u.usuarioEmail || "").toString().trim();
      if(nome || email) return { nome: nome || "Usu√°rio", email: email || "‚Äî" };
    }catch(e){
      if(raw.includes("@")) return { nome:"Usu√°rio", email: raw };
    }
  }

  const nome2  = (localStorage.getItem("usuarioNome")  || "").trim();
  const email2 = (localStorage.getItem("usuarioEmail") || "").trim();
  return { nome: nome2 || "", email: email2 || "" };
}

function applyLoggedUserTV(){
  const u = getLoggedUser();
  const nomeTxt  = u.nome || "‚Äî";
  const emailTxt = u.email || "‚Äî";

  const elNome  = document.getElementById("tvUserName");
  const elEmail = document.getElementById("tvUserEmail");

  if(elNome)  elNome.textContent  = nomeTxt;
  if(elEmail) elEmail.textContent = emailTxt;

  // compatibilidade (se outros m√≥dulos usam isso)
  localStorage.setItem("usuarioNome", u.nome || "");
  localStorage.setItem("usuarioEmail", u.email || "");
}

// Inicializar
window.addEventListener('DOMContentLoaded', () => {
  applyLoggedUserTV();

  atualizarRelogio();
  setInterval(atualizarRelogio, 1000);

  carregarProjetos();
  setInterval(carregarProjetos, 10000);

  iniciarPager();

// Seg/Sex: mostra alerta imediatamente ao abrir a TV (sem esperar 20s)
if (isMondayOrFriday(new Date())) {
  showTravelAlert();
}

  verificarFullscreen();
  document.addEventListener('fullscreenchange', verificarFullscreen);
  document.addEventListener('webkitfullscreenchange', verificarFullscreen);
  document.addEventListener('mozfullscreenchange', verificarFullscreen);
  document.addEventListener('MSFullscreenChange', verificarFullscreen);
});

// Ativar fullscreen
function ativarFullscreen() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) elem.requestFullscreen();
  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
  else if (elem.mozRequestFullScreen) elem.mozRequestFullScreen();
  beep(1); // desbloqueia o √°udio com um bip curtinho
  // destravar √°udio no primeiro clique do fullscreen
  startAggressiveAlarm(200);
  stopAggressiveAlarm();
}

// Verificar fullscreen
function verificarFullscreen() {
  const isFullscreen =
    document.fullscreenElement ||
    document.webkitFullscreenElement ||
    document.mozFullScreenElement ||
    document.msFullscreenElement;

  const btn = document.getElementById('btnFullscreen');
  if (isFullscreen) btn.classList.add('hide');
  else btn.classList.remove('hide');
}

// Rel√≥gio
function atualizarRelogio() {
  const agora = new Date();
  const data = agora.toLocaleDateString('pt-BR', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
  const hora = agora.toLocaleTimeString('pt-BR');

  document.getElementById('dataAtual').textContent = data.charAt(0).toUpperCase() + data.slice(1);
  document.getElementById('relogio').textContent = hora;
}

// Converter string de data para Date
function parseDataBR(dataStr) {
  // Formato: "2026-02-18 09:30:00"
  if (!dataStr || typeof dataStr !== 'string') return null;
  const partes = dataStr.split(' ');
  if (partes.length !== 2) return null;

  const [dataParte, horaParte] = partes;
  const [ano, mes, dia] = dataParte.split('-');
  const [hora, min, seg] = horaParte.split(':');

  return new Date(
    parseInt(ano,10),
    parseInt(mes,10) - 1,
    parseInt(dia,10),
    parseInt(hora,10),
    parseInt(min,10),
    parseInt(seg,10)
  );
}

// Pager: troca tela a cada 2 min
function iniciarPager() {
  if (pageTimer) clearInterval(pageTimer);

  pageTimer = setInterval(() => {
    if (alertShowing) return;

    const totalPages = Math.max(1, Math.ceil(projetosAtuais.length / PAGE_SIZE));
    const allowed = isMondayOrFriday(new Date());

    // Se n√£o √© seg/sex, mant√©m comportamento normal
    if (!allowed) {
      if (totalPages <= 1) return;
      const next = (pageIndex + 1) % totalPages;
      setPage(next, true);
      return;
    }

    // Seg/Sex: adiciona "p√°gina extra" (ALERTA) no giro
    const virtualTotal = totalPages + 1; // +1 do alerta
    virtualIndex = (virtualIndex + 1) % virtualTotal;

    if (virtualIndex === 0) {
      // ALERTA ocupa a tela inteira por 20s
      showTravelAlert();
      return;
    }

    // p√°ginas normais (virtualIndex 1..totalPages)
    const targetPage = virtualIndex - 1;
    setPage(targetPage, true);

  }, PAGE_INTERVAL_MS);
}
// Setar p√°gina (com anima√ß√£o)
function setPage(newIndex, animate) {
  const totalPages = Math.max(1, Math.ceil(projetosAtuais.length / PAGE_SIZE));
  if (totalPages <= 1) {
    pageIndex = 0;
    renderizarProjetos(new Set(), false);
    return;
  }

  pageIndex = Math.max(0, Math.min(newIndex, totalPages - 1));
  renderizarProjetos(new Set(), animate);
}

// Carregar projetos da API
async function carregarProjetos() {
  try {
    const response = await fetch(`${API_BASE}/listar.php?t=${Date.now()}`);
    const data = await response.json();

    if (data.success && data.data && data.data.projetos && data.data.projetos.length > 0) {
      const projetosNovos = data.data.projetos;

      // descobrir o projeto mais recente (para badge "√öltima atualiza√ß√£o")
      let maisRecente = null;
      let maisRecenteTs = -1;

      projetosNovos.forEach(p => {
        const d = parseDataBR(p.data_atualizacao);
        if (!d) return;
        const ts = d.getTime();
        if (ts > maisRecenteTs) {
          maisRecenteTs = ts;
          maisRecente = p;
        }
      });

      if (maisRecente && maisRecenteTs > 0) {
        ultimaAtualizacaoGlobal = new Date(maisRecenteTs);
        ultimaAtualizacaoUsuario = (maisRecente.usuario_atualizacao || '').trim() || 'Sistema';
      }

      // detectar quais IDs mudaram
      const projetosAtualizados = detectarAtualizacoes(projetosNovos);

      // Atualiza base atual
      projetosAtuais = projetosNovos;

      // Se houve atualiza√ß√£o: focar no mais recente dentre os atualizados
      if (projetosAtualizados.size > 0) {
        const foco = encontrarMaisRecenteEntreAtualizados(projetosAtualizados);
        if (foco) {
          highlightProjectId = foco.id;
          highlightUntilTs = Date.now() + 15000; // 15s

          // pular para p√°gina do projeto atualizado
          const idx = projetosAtuais.findIndex(p => p.id === foco.id);
          if (idx >= 0) {
            const targetPage = Math.floor(idx / PAGE_SIZE);
            pageIndex = targetPage;
          }
        }
      }

      renderizarProjetos(projetosAtualizados, false);
      atualizarBadgeSync();

    } else {
      document.getElementById('projetosGrid').innerHTML = '<div class="loading">üì≠ Nenhum projeto cadastrado</div>';
    }
  } catch (error) {
    console.error('Erro ao carregar projetos:', error);
    document.getElementById('projetosGrid').innerHTML = '<div class="loading">‚ö†Ô∏è Erro ao carregar projetos</div>';
  }
}

// Detectar atualiza√ß√µes
function detectarAtualizacoes(projetosNovos) {
  const atualizados = new Set();

  projetosNovos.forEach(projetoNovo => {
    const projetoAntigo = projetosAtuais.find(p => p.id === projetoNovo.id);

    if (projetoAntigo) {
      if (projetoNovo.data_atualizacao !== projetoAntigo.data_atualizacao) {
        atualizados.add(projetoNovo.id);
      }
    } else {
      atualizados.add(projetoNovo.id);
    }
  });

  return atualizados;
}

function encontrarMaisRecenteEntreAtualizados(setIds) {
  let best = null;
  let bestTs = -1;

  projetosAtuais.forEach(p => {
    if (!setIds.has(p.id)) return;
    const d = parseDataBR(p.data_atualizacao);
    if (!d) return;
    const ts = d.getTime();
    if (ts > bestTs) {
      bestTs = ts;
      best = p;
    }
  });

  return best;
}

// Renderizar projetos (sempre 6 por tela)
function renderizarProjetos(projetosAtualizados, animate) {
  const grid = document.getElementById('projetosGrid');

  const farolEmoji = {'verde':'üü¢','amarelo':'üü°','vermelho':'üî¥'};

  const totalPages = Math.max(1, Math.ceil(projetosAtuais.length / PAGE_SIZE));
  if (pageIndex >= totalPages) pageIndex = 0;

  const start = pageIndex * PAGE_SIZE;
  const slice = projetosAtuais.slice(start, start + PAGE_SIZE);

  const doRender = () => {
    const agoraTs = Date.now();

    const html = slice.map(projeto => {
      const dataAtualizada = parseDataBR(projeto.data_atualizacao);
      if (!dataAtualizada) return '';

      const diffMs = Date.now() - dataAtualizada.getTime();
      const diffMins = Math.floor(diffMs / 60000);
      const diffHoras = Math.floor(diffMins / 60);
      const diffDias = Math.floor(diffHoras / 24);

      let tempoRelativo;
      if (diffMins < 1) tempoRelativo = 'Agora mesmo';
      else if (diffMins < 60) tempoRelativo = `h√° ${diffMins} min`;
      else if (diffHoras < 24) tempoRelativo = `h√° ${diffHoras}h`;
      else tempoRelativo = `h√° ${diffDias} dia${diffDias > 1 ? 's' : ''}`;

      const dataFormatada = dataAtualizada.toLocaleString('pt-BR', {
        day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit'
      });

const foiAtualizado = projetosAtualizados.has(projeto.id);
const estaEmDestaque = (highlightProjectId === projeto.id) && (agoraTs < highlightUntilTs);

// desatualizado = sem atualiza√ß√£o h√° mais de STALE_MS
const ageMs = Date.now() - dataAtualizada.getTime();
const estaDesatualizado = ageMs > STALE_MS;

// classes do card
const classAtualizado = (foiAtualizado || estaEmDestaque) ? 'atualizado' : '';
const classStale = (estaDesatualizado && !foiAtualizado && !estaEmDestaque) ? 'stale' : '';

let badge = "";
if (estaDesatualizado && !foiAtualizado && !estaEmDestaque) {
  badge = '<div class="badge-stale">Falta atualiza√ß√£o!</div>';
} else if (foiAtualizado || estaEmDestaque) {
  badge = '<div class="badge-novo">Atualizado!</div>';
}
return `
  <div class="projeto-card ${classAtualizado} ${classStale}">  
          ${badge}
          <div class="card-header">
            <h2 class="card-titulo">${projeto.nome}</h2>
            <div class="farol ${projeto.farol}">
              ${farolEmoji[projeto.farol] || '‚ö™'}
            </div>
          </div>

          <div class="card-info">
            <div class="info-badge">
              <div class="info-badge-label">üë∑ Coordenador</div>
              <div class="info-badge-value">${projeto.coordenador}</div>
            </div>
            <div class="info-badge">
              <div class="info-badge-label">üîß Execu√ß√£o</div>
              <div class="info-badge-value">${projeto.execucao}</div>
            </div>
          </div>

          <div class="card-status">
            <div class="status-label">üìä Status Atual</div>
            <div class="status-text">${projeto.status}</div>
          </div>

          <div class="card-footer">
            <div>
              <span class="footer-user">üïê ${tempoRelativo}</span>
              <div style="font-size:10px;opacity:.7;margin-top:2px">${dataFormatada}</div>
            </div>
            <div>
              <span class="footer-user">${(projeto.usuario_atualizacao || 'Sistema')}</span>
            </div>
          </div>
        </div>
      `;
    }).join('');

    grid.innerHTML = html || '<div class="loading">üì≠ Nenhum projeto cadastrado</div>';

    if (projetosAtualizados.size > 0) {
      setTimeout(() => {
        document.querySelectorAll('.badge-novo').forEach(b => {
          b.style.animation = 'none';
          b.style.opacity = '0';
          setTimeout(() => b.remove(), 250);
        });
        document.querySelectorAll('.projeto-card.atualizado').forEach(card => {
          const isFocus = (Date.now() < highlightUntilTs);
          if (!isFocus) card.classList.remove('atualizado');
        });
      }, 6000);
    }
  };

  if (!animate) {
    doRender();
    return;
  }

  grid.classList.remove('slide-in');
  grid.classList.add('slide-out');

  setTimeout(() => {
    grid.classList.remove('slide-out');
    doRender();
    grid.classList.add('slide-in');
    setTimeout(() => grid.classList.remove('slide-in'), 600);
  }, 560);
}

// Atualizar badge de sincroniza√ß√£o (data do projeto + usu√°rio)
function atualizarBadgeSync() {
  const badge = document.getElementById('ultimaSync');

  if (ultimaAtualizacaoGlobal) {
    const dataFormatada = ultimaAtualizacaoGlobal.toLocaleString('pt-BR', {
      day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit'
    });

    const usuario = (ultimaAtualizacaoUsuario || 'Sistema');

    badge.innerHTML = `‚úÖ √öltima atualiza√ß√£o: ${dataFormatada} ‚Äî ${usuario}`;
    badge.style.background = 'rgba(34,197,94,.2)';
    badge.style.borderColor = 'rgba(34,197,94,.5)';

    setTimeout(() => {
      badge.style.background = 'rgba(34,197,94,.15)';
      badge.style.borderColor = 'rgba(34,197,94,.4)';
    }, 2000);
  } else {
    badge.innerHTML = 'üîÑ Aguardando dados...';
  }
}

// ===== ALERTA 16:00 ‚Äî ALOCA√á√ïES DI√ÅRIAS (SEG A SEX) =====
const DAILY_ALLOC_HOUR = 16;
const DAILY_ALLOC_MIN  = 0;
const DAILY_ALLOC_DURATION_MS = 20000; // 20s

// evita disparar v√°rias vezes no mesmo dia
const DAILY_ALLOC_KEY_PREFIX = "TV_DAILY_ALLOC_SHOWN_";

function isWeekday(d){
  const day = d.getDay(); // 0=Dom ... 6=Sab
  return day >= 1 && day <= 5; // Seg..Sex
}
function ymd(d){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const da = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${da}`;
}

// ===== ALARME AGRESSIVO (bem chamativo) =====
let _allocAlarmCtx = null;
let _allocAlarmStop = null;

function startAggressiveAlarm(durationMs){
  try{
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if(!AudioCtx) return;

    if(!_allocAlarmCtx) _allocAlarmCtx = new AudioCtx();
    const ctx = _allocAlarmCtx;

    if(ctx.state === "suspended") ctx.resume();

    // master gain (volume)
    const master = ctx.createGain();
    master.gain.value = 0.95; // alto (limite pr√°tico no WebAudio)
    master.connect(ctx.destination);

    // 2 osciladores (siren√£o mais forte)
    const o1 = ctx.createOscillator();
    const o2 = ctx.createOscillator();
    o1.type = "square";
    o2.type = "sawtooth";
    o1.frequency.value = 780;
    o2.frequency.value = 520;

    const g = ctx.createGain();
    g.gain.value = 0.0001;

    o1.connect(g);
    o2.connect(g);
    g.connect(master);

    const t0 = ctx.currentTime + 0.02;
    o1.start(t0);
    o2.start(t0);

    // sirene alternando r√°pido + ‚Äúgating‚Äù pra ficar agressivo
    let step = 0;
    const interval = setInterval(() => {
      step++;
      const f1 = (step % 2 === 0) ? 980 : 680;
      const f2 = (step % 2 === 0) ? 640 : 420;

      o1.frequency.setTargetAtTime(f1, ctx.currentTime, 0.015);
      o2.frequency.setTargetAtTime(f2, ctx.currentTime, 0.015);

      // ‚Äúcorta‚Äù o som em pulsos curtos
      const on = (step % 3 !== 0);
      g.gain.setTargetAtTime(on ? 0.70 : 0.12, ctx.currentTime, 0.01);
    }, 160);

    const stop = () => {
      try{ clearInterval(interval); }catch(e){}
      try{ g.gain.setTargetAtTime(0.0001, ctx.currentTime, 0.02); }catch(e){}
      setTimeout(() => {
        try{ o1.stop(); o2.stop(); }catch(e){}
        try{ o1.disconnect(); o2.disconnect(); }catch(e){}
        try{ g.disconnect(); master.disconnect(); }catch(e){}
      }, 160);
    };

    _allocAlarmStop = stop;
    setTimeout(stop, durationMs);

  }catch(e){}
}

function stopAggressiveAlarm(){
  try{ if(_allocAlarmStop) _allocAlarmStop(); }catch(e){}
  _allocAlarmStop = null;
}

// ===== MOSTRAR OVERLAY 30s =====
function showDailyAllocAlert(){
  const overlay = document.getElementById("dailyAllocOverlay");
  const card = overlay ? overlay.querySelector(".daily-alloc-card") : null;
  if(!overlay || !card) return;

  const now = new Date();
  const days = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  document.getElementById("dailyAllocDayInfo").textContent = "Hoje: " + days[now.getDay()];
  document.getElementById("dailyAllocStamp").textContent =
    now.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});

  // barra 0‚Üí100 em 30s
  const bar = document.getElementById("dailyAllocBar");
  if(bar){
    bar.style.transition = "none";
    bar.style.width = "0%";
    bar.offsetHeight; // reflow
    bar.style.transition = `width ${DAILY_ALLOC_DURATION_MS}ms linear`;
    bar.style.width = "100%";
  }

  // contador 30‚Üí0
  let remaining = Math.ceil(DAILY_ALLOC_DURATION_MS/1000);
  const secEl = document.getElementById("dailyAllocSec");
  if(secEl) secEl.textContent = remaining;

  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");

  startAggressiveAlarm(DAILY_ALLOC_DURATION_MS);

  const tick = setInterval(() => {
    remaining--;
    if(remaining < 0) remaining = 0;
    if(secEl) secEl.textContent = remaining;
  }, 1000);

  setTimeout(() => {
    card.classList.add("daily-alloc-leave");
    setTimeout(() => {
      clearInterval(tick);
      stopAggressiveAlarm();
      card.classList.remove("daily-alloc-leave");
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }, 780);
  }, DAILY_ALLOC_DURATION_MS);
}

// ===== DISPARO EXATO 16:00 (SEG-SEX) ‚Äî 1x por dia =====
function shouldFireDailyAlloc(now){
  if(!isWeekday(now)) return false;
  if(now.getHours() !== DAILY_ALLOC_HOUR) return false;
  if(now.getMinutes() !== DAILY_ALLOC_MIN) return false;

  // janela de 0..59s dentro do minuto 16:00 (checamos a cada 2s/5s)
  const key = DAILY_ALLOC_KEY_PREFIX + ymd(now);
  if(localStorage.getItem(key) === "1") return false;

  localStorage.setItem(key, "1");
  return true;
}

// checa a cada 2s pra n√£o ‚Äúperder‚Äù o minuto
setInterval(() => {
  const now = new Date();
  if(shouldFireDailyAlloc(now)){
    showDailyAllocAlert();
  }
}, 2000);
</script>
<!-- ===== ALERTA 16:00 (ALOCACOES DIARIAS) ‚Äî FULLSCREEN ===== -->
<div id="dailyAllocOverlay" class="daily-alloc-overlay" aria-hidden="true">
  <div class="daily-alloc-bg"></div>

  <section class="daily-alloc-card" role="region" aria-label="Alerta Aloca√ß√µes Di√°rias">
    <div class="daily-alloc-kicker">
      <span class="daily-alloc-dot"></span>
      üö® ALERTA OPERACIONAL ‚Äî ALOCA√á√ïES DI√ÅRIAS
    </div>

    <h1 class="daily-alloc-title">Coordenadores</h1>

    <p class="daily-alloc-msg">
      <b>Agora √†s 16:00</b>: realizar e confirmar as <b>aloca√ß√µes di√°rias</b> (equipes, frentes e prioridades).
    </p>

    <div class="daily-alloc-sub">
      ‚úÖ Evita falhas de execu√ß√£o ‚Ä¢ Alinha o time ‚Ä¢ Garante rastreabilidade (RDO) ‚Ä¢ Reduz retrabalho
    </div>

    <div class="daily-alloc-side">
      <div class="daily-alloc-icon" aria-hidden="true">‚ö†Ô∏è</div>

      <div class="daily-alloc-progressWrap" aria-hidden="true">
        <div class="daily-alloc-bar" id="dailyAllocBar"></div>
      </div>

      <div class="daily-alloc-timerRow">
        <span id="dailyAllocDayInfo">‚Äî</span>
        <span><span id="dailyAllocSec">30</span>s</span>
      </div>
    </div>

    <div class="daily-alloc-footer">
      <span>ERP √çMPAR ‚Ä¢ Gest√£o √† Vista</span>
      <span id="dailyAllocStamp">‚Äî</span>
    </div>
  </section>
</div>

</body>

</html>
