<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gest√£o √† Vista ‚Äî Projetos √çMPAR</title>
  <style>
    /* ... TODO O CSS DA TV ... */
    :root{--bg1:#0b1e4a;--bg2:#0e3b6e;--bg3:#0f766e;--text:#e5e7eb;--soft:rgba(229,231,235,.78);--green:#22c55e;--yellow:#fbbf24;--red:#ef4444;--blue:#3b82f6;--radius:24px}*{box-sizing:border-box;margin:0;padding:0}html,body{height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--text);background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));display:flex;flex-direction:column}header{padding:24px 32px;background:rgba(2,6,23,.85);border-bottom:2px solid rgba(148,163,184,.35);box-shadow:0 10px 40px rgba(0,0,0,.5);backdrop-filter:blur(10px)}.header-inner{max-width:1600px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:20px}.brand{display:flex;align-items:center;gap:16px}.logo-orb{width:52px;height:52px;border-radius:999px;position:relative;background:conic-gradient(from 210deg,#22c55e,#06b6d4,#3b82f6,#a855f7,#f97316,#22c55e);box-shadow:0 14px 32px rgba(0,0,0,.45),0 0 0 2px rgba(255,255,255,.18) inset;animation:logoSpin 20s linear infinite}@keyframes logoSpin{to{transform:rotate(360deg)}}.logo-orb:before{content:"";position:absolute;inset:-8px;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.55),transparent 60%)}.brand-text{display:flex;flex-direction:column;gap:4px}.brand-kicker{font-size:14px;letter-spacing:.25em;text-transform:uppercase;font-weight:800;opacity:.85}.brand-title{font-size:32px;font-weight:900;line-height:1;letter-spacing:-.02em}.brand-sub{font-size:18px;font-weight:800;opacity:.92}.status-info{text-align:right;font-size:14px;color:rgba(229,231,235,.8)}.status-info .big{font-size:20px;font-weight:900;margin-bottom:4px}.status-info .small{font-size:12px;opacity:.75}main{flex:1;display:flex;align-items:center;justify-content:center;padding:40px 32px;overflow:hidden}.carousel-container{width:100%;max-width:1400px;height:100%;max-height:700px;position:relative}.projeto-card{position:absolute;inset:0;border-radius:var(--radius);border:3px solid rgba(148,163,184,.5);background:linear-gradient(135deg,rgba(2,6,23,.92),rgba(15,23,42,.88));box-shadow:0 32px 80px rgba(0,0,0,.7);backdrop-filter:blur(20px);padding:48px;display:none;flex-direction:column;opacity:0;transform:scale(.95) translateY(20px);transition:all .6s cubic-bezier(.16,1,.3,1)}.projeto-card.active{display:flex;opacity:1;transform:scale(1) translateY(0)}.farol-badge{position:absolute;top:48px;right:48px;width:120px;height:120px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:64px;box-shadow:0 20px 50px rgba(0,0,0,.5);animation:farolPulse 2s ease-in-out infinite}@keyframes farolPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}.farol-badge.verde{background:radial-gradient(circle,rgba(34,197,94,.35),rgba(34,197,94,.15));border:4px solid var(--green);box-shadow:0 0 40px rgba(34,197,94,.6),0 20px 50px rgba(0,0,0,.5)}.farol-badge.amarelo{background:radial-gradient(circle,rgba(251,191,36,.35),rgba(251,191,36,.15));border:4px solid var(--yellow);box-shadow:0 0 40px rgba(251,191,36,.6),0 20px 50px rgba(0,0,0,.5)}.farol-badge.vermelho{background:radial-gradient(circle,rgba(239,68,68,.35),rgba(239,68,68,.15));border:4px solid var(--red);box-shadow:0 0 40px rgba(239,68,68,.6),0 20px 50px rgba(0,0,0,.5)}.projeto-header{margin-bottom:32px}.projeto-nome{font-size:48px;font-weight:900;line-height:1.1;letter-spacing:-.02em;margin-bottom:16px;text-shadow:0 4px 12px rgba(0,0,0,.5);max-width:70%}.projeto-coordenador{font-size:22px;color:rgba(229,231,235,.85);font-weight:700;display:flex;align-items:center;gap:10px}.coordenador-icon{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:999px;background:linear-gradient(135deg,#3b82f6,#2563eb);font-size:18px;box-shadow:0 8px 20px rgba(59,130,246,.4)}.projeto-info{flex:1;display:flex;flex-direction:column;gap:24px}.info-row{display:flex;flex-direction:column;gap:8px}.info-label{font-size:13px;text-transform:uppercase;letter-spacing:.12em;color:rgba(156,163,175,.9);font-weight:800}.info-value{font-size:24px;font-weight:700;color:var(--text);line-height:1.3}.status-box{padding:24px;border-radius:18px;background:rgba(2,6,23,.65);border:2px solid rgba(148,163,184,.25);box-shadow:0 10px 30px rgba(0,0,0,.3)}.execucao-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:999px;font-size:16px;font-weight:800;text-transform:uppercase;letter-spacing:.08em}.execucao-badge.interno{background:rgba(59,130,246,.2);border:2px solid rgba(59,130,246,.5);color:#93c5fd}.execucao-badge.empreiteiro{background:rgba(168,85,247,.2);border:2px solid rgba(168,85,247,.5);color:#d8b4fe}.projeto-footer{margin-top:auto;padding-top:24px;border-top:1px solid rgba(148,163,184,.2);display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}.ultima-atualizacao{font-size:14px;color:rgba(229,231,235,.7);display:flex;align-items:center;gap:8px}.atualizacao-badge{padding:6px 12px;border-radius:999px;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);color:#86efac;font-weight:800;font-size:12px}.nav-dots{display:flex;gap:12px;align-items:center}.nav-dot{width:12px;height:12px;border-radius:999px;background:rgba(148,163,184,.25);border:2px solid rgba(148,163,184,.4);transition:all .3s ease}.nav-dot.active{width:32px;background:linear-gradient(90deg,#22c55e,#16a34a);border-color:#22c55e;box-shadow:0 0 16px rgba(34,197,94,.5)}footer{background:rgba(2,6,23,.85);padding:16px 32px;text-align:center;font-size:11px;color:rgba(156,163,175,.8);border-top:1px solid rgba(148,163,184,.2)}.loading-overlay{position:fixed;inset:0;background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));display:flex;align-items:center;justify-content:center;flex-direction:column;gap:24px;z-index:9999;transition:opacity .5s ease}.loading-overlay.hidden{opacity:0;pointer-events:none}.loader{width:60px;height:60px;border-radius:999px;border:4px solid rgba(148,163,184,.2);border-top-color:#22c55e;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.loading-text{font-size:18px;font-weight:700;color:var(--text)}
  </style>
</head>
<body>

  <div class="loading-overlay" id="loader">
    <div class="loader"></div>
    <div class="loading-text">Carregando projetos...</div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo-orb"></div>
        <div class="brand-text">
          <div class="brand-kicker">GEST√ÉO √Ä VISTA</div>
          <div class="brand-title">PROJETOS √çMPAR</div>
          <div class="brand-sub">Status em Tempo Real</div>
        </div>
      </div>
      <div class="status-info">
        <div class="big" id="horaAtual">--:--</div>
        <div class="small">Atualiza√ß√£o autom√°tica</div>
      </div>
    </div>
  </header>

  <main>
    <div class="carousel-container" id="carouselContainer">
      <!-- Cards inseridos dinamicamente -->
    </div>
  </main>

  <footer>
    ¬© 2026 ERP √çMPAR ‚Äî Sistema de Gest√£o Integrada ‚Ä¢ Atualiza√ß√£o a cada 10 segundos
  </footer>

  <script src="js/gestao_projetos.js"></script>
  <script>
    let projetos = [];
    let currentIndex = 0;
    let carouselInterval;

    // Atualizar rel√≥gio
    function atualizarHora() {
      const agora = new Date();
      const hora = agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
      document.getElementById('horaAtual').textContent = hora;
    }
    setInterval(atualizarHora, 1000);
    atualizarHora();

    // Buscar projetos do backend (via API PHP)
    async function carregarProjetos() {
      try {
        console.log('üîÑ Buscando projetos do backend...');
        projetos = await listarProjetos();
        console.log('‚úÖ Projetos carregados:', projetos.length);
        
        if (projetos.length > 0) {
          renderizarProjetos();
          iniciarCarrossel();
        } else {
          mostrarMensagemVazia();
        }
        
        setTimeout(() => {
          document.getElementById('loader').classList.add('hidden');
        }, 1000);

      } catch (error) {
        console.error('‚ùå Erro ao carregar projetos:', error);
        mostrarErro();
      }
    }

    // Renderizar cards
    function renderizarProjetos() {
      const container = document.getElementById('carouselContainer');
      container.innerHTML = '';

      projetos.forEach((projeto, index) => {
        const farolEmoji = getFarolEmoji(projeto.farol);
        const execucaoClass = projeto.execucao.toLowerCase();

        const card = document.createElement('div');
        card.className = `projeto-card ${index === 0 ? 'active' : ''}`;
        card.innerHTML = `
          <div class="farol-badge ${projeto.farol}">
            ${farolEmoji}
          </div>

          <div class="projeto-header">
            <h1 class="projeto-nome">${projeto.nome}</h1>
            <div class="projeto-coordenador">
              <span class="coordenador-icon">üë§</span>
              <span>${projeto.coordenador}</span>
            </div>
          </div>

          <div class="projeto-info">
            <div class="info-row">
              <div class="info-label">üìã Status Atual</div>
              <div class="status-box">
                <div class="info-value">${projeto.status}</div>
              </div>
            </div>

            <div class="info-row">
              <div class="info-label">üèóÔ∏è Tipo de Execu√ß√£o</div>
              <div class="info-value">
                <span class="execucao-badge ${execucaoClass}">
                  ${projeto.execucao === 'Interno' ? 'üè¢' : 'üë∑'} ${projeto.execucao}
                </span>
              </div>
            </div>
          </div>

          <div class="projeto-footer">
            <div class="ultima-atualizacao">
              <span>√öltima atualiza√ß√£o:</span>
              <span class="atualizacao-badge">${projeto.usuario_atualizacao} ‚Ä¢ ${projeto.ultima_atualizacao}</span>
            </div>
            <div class="nav-dots">
              ${projetos.map((_, i) => `<div class="nav-dot ${i === index ? 'active' : ''}"></div>`).join('')}
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Iniciar carrossel
    function iniciarCarrossel() {
      if (carouselInterval) clearInterval(carouselInterval);
      
      carouselInterval = setInterval(() => {
        proximoProjeto();
      }, 8000); // 8 segundos por slide
    }

    // Pr√≥ximo projeto
    function proximoProjeto() {
      const cards = document.querySelectorAll('.projeto-card');
      if (cards.length === 0) return;
      
      cards[currentIndex].classList.remove('active');
      currentIndex = (currentIndex + 1) % projetos.length;
      cards[currentIndex].classList.add('active');
    }

    // Mensagem quando n√£o h√° projetos
    function mostrarMensagemVazia() {
      const container = document.getElementById('carouselContainer');
      container.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;gap:20px;text-align:center;">
          <div style="font-size:64px;">üìã</div>
          <div style="font-size:24px;font-weight:900;">Nenhum projeto cadastrado</div>
          <div style="font-size:16px;opacity:.75;">Cadastre projetos para visualizar aqui</div>
        </div>
      `;
      document.getElementById('loader').classList.add('hidden');
    }

    // Mensagem de erro
    function mostrarErro() {
      const container = document.getElementById('carouselContainer');
      container.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;gap:20px;text-align:center;">
          <div style="font-size:64px;">‚ö†Ô∏è</div>
          <div style="font-size:24px;font-weight:900;">Erro ao carregar projetos</div>
          <div style="font-size:16px;opacity:.75;">Verifique a conex√£o com o backend</div>
        </div>
      `;
      document.getElementById('loader').classList.add('hidden');
    }

    // Atualizar automaticamente (looping)
    setInterval(async () => {
      console.log('üîÑ Atualizando dados automaticamente...');
      await carregarProjetos();
    }, 10000); // 10 segundos

    // Inicializar
    carregarProjetos();
  </script>

</body>
</html>