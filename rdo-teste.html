<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>ERP √çMPAR ‚Äì RDO da Obra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --bg-card-inner: #020817;
      --bg-header: linear-gradient(90deg, #020617 0%, #020617 40%, #0f172a 100%);
      --accent-azul: #2563eb;
      --accent-verde: #22c55e;
      --accent-laranja: #fb923c;
      --texto-principal: #f9fafb;
      --texto-secundario: #9ca3af;
      --borda-suave: rgba(148, 163, 184, 0.25);
      --input-bg: #020617;
      --input-border: #1f2937;
      --input-radius: 999px;
      --shadow-card: 0 24px 60px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top left, #0b1120 0, #020617 45%, #000 100%);
      color: var(--texto-principal);
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--bg-header);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.85);
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-ball {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background: radial-gradient(circle at 20% 20%, #f97316, #1d4ed8 45%, #0f172a 100%);
    }

    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title-main {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .title-sub {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--texto-secundario);
      letter-spacing: 0.18em;
    }

    .btn-header {
      padding: 8px 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.7);
      color: #e5e7eb;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-decoration: none;
      cursor: pointer;
      transition: all .18s;
    }

    .btn-header-primary {
      background: linear-gradient(90deg, #1d4ed8, #22c55e);
      border: none;
      color: white;
    }

    main {
      flex: 1;
      padding: 18px 12px 24px;
      display: flex;
      justify-content: center;
    }

    .page-shell {
      width: 100%;
      max-width: 1100px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card-rdo {
      background: radial-gradient(circle at top left, #0b1120 0, #020617 45%, #020617 100%);
      border-radius: 24px;
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 18px;
    }

    .section {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(30, 64, 175, 0.4);
      border-radius: 20px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    select, input, textarea {
      background: var(--input-bg);
      border-radius: var(--input-radius);
      border: 1px solid var(--input-border);
      color: var(--texto-principal);
      padding: 9px 14px;
      font-size: 14px;
      width: 100%;
    }

    textarea {
      min-height: 110px;
      border-radius: 18px;
      resize: vertical;
      padding-right: 44px;
    }

    /* Microfone */
    .field-with-mic {
      position: relative;
    }

    .btn-mic {
      position: absolute;
      right: 12px;
      bottom: 12px;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #1d4ed8);
      color: #fff;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
    }

    .btn-mic.mic-active {
      border: 2px solid #f97316;
      animation: mic-pulse 1.2s infinite;
    }

    @keyframes mic-pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.07); }
      100% { transform: scale(1); }
    }

    /* Fotos */
    .foto-item {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(96,165,250,0.3);
      border-radius: 16px;
      padding: 12px;
      margin-top: 12px;
    }

    .foto-item img {
      width: 100%;
      border-radius: 12px;
    }

  </style>
</head>

<body>
<header>
  <div class="logo-area">
    <div class="logo-ball"></div>
    <div class="title-wrap">
      <div class="title-main">ERP √çMPAR ¬∑ RDO</div>
      <div class="title-sub">Registro di√°rio de obra</div>
    </div>
  </div>
  <a href="index.html" class="btn-header btn-header-primary">Menu</a>
</header>

<main>
  <div class="page-shell">

    <section class="card-rdo">
      <h2>RDO da obra</h2>
      <div class="section">
        <h3>Dados do RDO</h3>

        <label>Obra</label>
        <select id="obra-select">
          <option value="">Selecione...</option>
          <option value="036">036 ‚Äî Cl√≠nica Artisti</option>
          <option value="041">041 ‚Äî F√≥rum Araquari</option>
          <option value="052">052 ‚Äî Hospital NS F√°tima</option>
        </select>

        <label>Atividade</label>
        <select id="atividade-select" disabled>
          <option>Selecione a obra...</option>
        </select>

        <label>Data</label>
        <input type="date" id="data-rdo">

        <label>Hora in√≠cio</label>
        <input type="text" id="hora-inicio" placeholder="HH:MM">

        <label>Hora fim</label>
        <input type="text" id="hora-fim" placeholder="HH:MM">

        <label>Resumo do que foi executado</label>
        <div class="field-with-mic">
          <textarea id="descricao-rdo"
            placeholder="Toque no microfone e fale para descrever o servi√ßo executado..."></textarea>
          <button id="btn-mic-descricao" class="btn-mic">üéôÔ∏è</button>
        </div>

        <small id="mic-status">Ditado dispon√≠vel.</small>
      </div>
      <div class="section">
        <h3>Fotos da obra</h3>

        <button class="btn-header btn-header-primary" type="button" id="btn-tirar-foto">
          üì∏ Tirar foto
        </button>

        <div id="lista-fotos"></div>
      </div>

      <div class="section">
        <h3>Localiza√ß√£o</h3>

        <button class="btn-header" id="btn-localizar">üìç Capturar localiza√ß√£o</button>
        <div id="status-localizacao">Aguardando...</div>

        <div style="margin-top:10px;border-radius:14px;overflow:hidden;">
          <iframe id="mapa-obra" width="100%" height="240"
            src="https://www.google.com/maps?q=-27.0,-48.0&z=4&output=embed"></iframe>
        </div>

      </div>

      <button class="btn-header btn-header-primary" style="margin-top:18px;">
        üíæ Salvar RDO
      </button>

    </section>
  </div>
</main>

<footer style="text-align:center;padding:12px;color:#888;">ERP √çMPAR ¬∑ RDO piloto</footer>

<script>
// ====================
// 1. Preencher data/hora
// ====================
(function() {
  const agora = new Date();
  document.getElementById("data-rdo").value = agora.toISOString().slice(0,10);
  document.getElementById("hora-inicio").value =
    String(agora.getHours()).padStart(2,"0") + ":" +
    String(agora.getMinutes()).padStart(2,"0");
})();

// ====================
// 2. Atividades (mock)
// ====================
const atividadesPorObra = {
  "036": [
    {id:1,codigo:"1.1",descricao:"Funda√ß√£o bloco 1"},
    {id:2,codigo:"2.3",descricao:"Estrutura bloco 1"}
  ],
  "041": [
    {id:10,codigo:"1.0",descricao:"Demoli√ß√£o do terreno"},
    {id:11,codigo:"2.1",descricao:"Funda√ß√µes profundas"}
  ]
};

const obraSelect = document.getElementById("obra-select");
const atividadeSelect = document.getElementById("atividade-select");

obraSelect.addEventListener("change", () => {
  const obra = obraSelect.value;
  atividadeSelect.innerHTML = "";
  if (!atividadesPorObra[obra]) {
    atividadeSelect.disabled = true;
    atividadeSelect.innerHTML = `<option>Nenhuma atividade (mock)</option>`;
    return;
  }
  atividadeSelect.disabled = false;
  atividadeSelect.innerHTML =
    `<option value="">Selecione...</option>` +
    atividadesPorObra[obra].map(a =>
      `<option value="${a.id}">${a.codigo} ‚Äî ${a.descricao}</option>`
    ).join("");
});

// ====================
// 3. Ditado por voz (resumo)
// ====================
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const desc = document.getElementById("descricao-rdo");
const micBtn = document.getElementById("btn-mic-descricao");
const micStatus = document.getElementById("mic-status");

if (!SpeechRecognition) {
  micBtn.style.display = "none";
  micStatus.textContent = "Ditado n√£o suportado no navegador.";
}

let recognizing = false;
let recog;

if (SpeechRecognition) {
  recog = new SpeechRecognition();
  recog.lang = "pt-BR";
  recog.interimResults = true;

  micBtn.onclick = () => {
    if (!recognizing) {
      recog.start();
      recognizing = true;
      micBtn.classList.add("mic-active");
      micStatus.textContent = "Ouvindo...";
    } else {
      recog.stop();
      recognizing = false;
      micBtn.classList.remove("mic-active");
      micStatus.textContent = "Pausado.";
    }
  };

  recog.onresult = (e)=>{
    let t = "";
    for (let i=e.resultIndex;i<e.results.length;i++){
      t += e.results[i][0].transcript;
    }
    desc.value = t;
  };

  recog.onend = ()=>{
    recognizing=false;
    micBtn.classList.remove("mic-active");
  };
}

// ====================
// 4. Fotos com descri√ß√£o por voz
// ====================
const btnFoto = document.getElementById("btn-tirar-foto");
const listaFotos = document.getElementById("lista-fotos");

btnFoto.onclick = () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*;capture=camera";

  input.onchange = () => {
    const file = input.files[0];
    if (!file) return;

    const url = URL.createObjectURL(file);
    const div = document.createElement("div");
    div.className = "foto-item";

    div.innerHTML = `
      <img src="${url}">
      <button class="btn-mic mic-foto">üéôÔ∏è</button>
      <textarea class="foto-descricao" placeholder="Descri√ß√£o da foto..."></textarea>
    `;

    listaFotos.appendChild(div);

    const micFoto = div.querySelector(".mic-foto");
    const txtFoto = div.querySelector(".foto-descricao");

    if (!SpeechRecognition) {
      micFoto.style.display = "none";
      return;
    }

    const r = new SpeechRecognition();
    r.lang = "pt-BR";
    r.interimResults = true;

    let ativo = false;
    let base = "";

    micFoto.onclick = () => {
      if (!ativo) {
        base = txtFoto.value + " ";
        r.start();
        ativo = true;
        micFoto.classList.add("mic-active");
      } else {
        r.stop();
        ativo = false;
        micFoto.classList.remove("mic-active");
      }
    };

    r.onresult=(e)=>{
      let t="";
      for(let i=e.resultIndex;i<e.results.length;i++){
        t+=e.results[i][0].transcript;
      }
      txtFoto.value = base + t;
    };

    r.onend=()=>{
      ativo=false;
      micFoto.classList.remove("mic-active");
    };
  };

  input.click();
};

// ====================
// 5. Geolocaliza√ß√£o + mapa
// ====================
const btnLocalizar = document.getElementById("btn-localizar");
const statusLoc = document.getElementById("status-localizacao");
const mapa = document.getElementById("mapa-obra");

btnLocalizar.onclick = () => {
  if (!navigator.geolocation) {
    statusLoc.textContent = "Geolocaliza√ß√£o n√£o suportada.";
    return;
  }

  statusLoc.textContent = "Buscando localiza√ß√£o...";

  navigator.geolocation.getCurrentPosition(
    pos=>{
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      statusLoc.textContent =
        `Localiza√ß√£o obtida: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;

      mapa.src =
        `https://www.google.com/maps?q=${lat},${lng}&z=18&output=embed`;
    },
    err=>{
      statusLoc.textContent = "Erro ao obter localiza√ß√£o.";
    },
    {enableHighAccuracy:true, timeout:15000}
  );
};
</script>

</body>
</html>
