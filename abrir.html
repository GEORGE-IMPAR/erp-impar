<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ERP ÍMPAR • Acessando módulo…</title>
  <style>
    :root{
      --bg1:#071021;
      --bg2:#0b4aa6;
      --bg3:#22c55e;
      --card: rgba(10,18,32,.62);
      --stroke: rgba(96,165,250,.40);
      --text:#eaf2ff;
      --muted:#b7c7e6;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 480px at 20% 15%, rgba(96,165,250,.35), transparent 55%),
        radial-gradient(700px 420px at 80% 25%, rgba(34,197,94,.28), transparent 55%),
        linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 45%, var(--bg3) 130%);
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .wrap{
      width:min(560px, 92vw);
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius:18px;
      box-shadow: 0 28px 80px rgba(0,0,0,.45);
      padding:22px 20px;
      backdrop-filter: blur(10px);
    }
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-bottom:14px;
      margin-bottom:14px;
      border-bottom:1px solid rgba(96,165,250,.22);
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background: linear-gradient(120deg, #60a5fa, #22c55e);
      box-shadow: 0 0 0 4px rgba(96,165,250,.18);
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(96,165,250,.35);
      background: rgba(2,6,23,.35);
      color:var(--muted);
      white-space:nowrap;
    }
    h1{font-size:18px;margin:0 0 6px 0;}
    p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
    .row{display:flex;align-items:center;gap:14px;margin-top:16px;}
    .spinner{
      width:34px;height:34px;border-radius:999px;
      border:3px solid rgba(234,242,255,.22);
      border-top-color: rgba(96,165,250,.95);
      animation: spin .9s linear infinite;
      flex:0 0 auto;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .details{display:flex;flex-direction:column;gap:4px;}
    .where{
      font-weight:800;
      color:#fff;
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .mini{
      font-size:12px;color:rgba(234,242,255,.72);
      word-break:break-all;
    }
    .hint{
      margin-top:14px;
      font-size:11px;
      color:rgba(234,242,255,.55);
    }
    .btn{
      margin-top:16px;
      display:inline-flex;align-items:center;gap:8px;
      border-radius:12px;
      padding:10px 12px;
      border:1px solid rgba(96,165,250,.35);
      background: rgba(2,6,23,.35);
      color: rgba(234,242,255,.92);
      text-decoration:none;
      font-weight:700;
      font-size:12px;
    }
    .btn:hover{filter:brightness(1.06)}
  </style>
</head>
<body>
  <div class="wrap" role="status" aria-live="polite">
    <div class="top">
      <div class="brand"><span class="dot"></span> ERP ÍMPAR</div>
      <div class="pill" id="pill">Login único</div>
    </div>

    <h1 id="title">Logando na funcionalidade…</h1>
    <p id="subtitle">Aguarde um instante. Estamos abrindo o módulo com sua sessão ativa.</p>

    <div class="row">
      <div class="spinner" aria-hidden="true"></div>
      <div class="details">
        <div class="where" id="where">Carregando…</div>
        <div class="mini" id="mini"></div>
      </div>
    </div>

    <div class="hint" id="hint">Dica: se abrir em branco, volte e tente novamente (cache do navegador).</div>

    <a class="btn" href="/menu.html">↩ Voltar ao menu</a>
  </div>

<script>
  const KEY = "ERPIMPAR_USER";

  function getSessao(){
    const raw = localStorage.getItem(KEY) || sessionStorage.getItem(KEY);
    if(!raw) return null;
    try{ return JSON.parse(raw); }catch(e){ return null; }
  }

  // Lista branca para evitar redirect indevido
  const ROUTES = {
    materiais:  { label:"Solicitação de materiais", url:"/solicitacao.html" },
    documentos: { label:"Gerador de documentos", url:"/documentos/index.html" },
    cronograma: { label:"Cronograma (Farol)", url:"/cronograma/farol.html" },
    dashboard:  { label:"Dashboard de custos", url:"/documentos/dashboard_custos.html" },
    status:     { label:"Status para cliente", url:"/cronograma/status_cliente.html" }
  };

  const qs = new URLSearchParams(location.search);
  const to = (qs.get("to") || "").toLowerCase().trim();

  const user = getSessao();
  if(!user){
    location.replace("/index.html");
  } else if(!ROUTES[to]){
    location.replace("/menu.html");
  } else {
    const r = ROUTES[to];
    document.getElementById("where").textContent = r.label;
    document.getElementById("mini").textContent = r.url;
    document.getElementById("pill").textContent = (user.nome ? user.nome : "Sessão ativa");
    setTimeout(()=> location.href = r.url, 450);
  }
</script>
</body>
</html>
