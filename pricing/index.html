<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<title>ERP ÍMPAR - Pricing</title>
<style>
body{font-family:Candara,Segoe UI;background:#0b1f2a;color:#fff}
.btn{padding:10px 16px;border-radius:18px;border:none;cursor:pointer}
.green{background:#21c36f}
.blue{background:#2f80ed}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:8px;border-bottom:1px solid #1f3a4a}
</style>
</head>
<body>

<h2>Importar CSV</h2>

<label><input type="checkbox" id="onlyBR" checked> Buscar somente Brasil</label><br/><br/>
<input type="file" id="csvFile"/>

<button class="btn green" onclick="loadCSV()">Carregar</button>

<table>
<thead>
<tr>
<th>Código</th><th>EAN</th><th>Descrição</th><th>Qtd</th><th>NCM</th><th>UN</th>
</tr>
</thead>
<tbody id="tb"></tbody>
</table>

<script>
function parseCSV(text){
  const raw = text.replace(/\r/g,'').trim();
  if(!raw) return [];
  const lines = raw.split('\n').map(l=>l.trim()).filter(Boolean);
  const sep = lines[0].includes(';') ? ';' : ',';
  const headers = lines[0].split(sep).map(h=>h.toLowerCase());

  const idx = {
    codigo: headers.indexOf('codigo'),
    ean: headers.indexOf('ean'),
    descricao: headers.indexOf('descricao'),
    qtd: headers.indexOf('quantidade'),
    ncm: headers.indexOf('ncm'),
    un: headers.indexOf('un')
  };

  return lines.slice(1).map(l=>{
    const c = l.split(sep);
    return {
      codigo: c[idx.codigo]||'',
      ean: c[idx.ean]||'',
      descricao: c[idx.descricao]||'',
      qtd: c[idx.qtd]||'',
      ncm: c[idx.ncm]||'',
      un: c[idx.un]||''
    };
  });
}

function loadCSV(){
  const f = document.getElementById('csvFile').files[0];
  if(!f) return alert('Selecione um CSV');
  const r = new FileReader();
  r.onload = e=>{
    const data = parseCSV(e.target.result);
    const tb = document.getElementById('tb');
    tb.innerHTML='';
    data.forEach(it=>{
      tb.innerHTML += `<tr>
      <td>${it.codigo}</td>
      <td>${it.ean}</td>
      <td>${it.descricao}</td>
      <td>${it.qtd}</td>
      <td>${it.ncm}</td>
      <td>${it.un}</td>
      </tr>`;
    });
  };
  r.readAsText(f,'utf-8');
}
</script>
</body>
</html>
