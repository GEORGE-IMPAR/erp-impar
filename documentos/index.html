<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Documentos ÍMPAR</title>
<link rel="stylesheet" href="style.css">
<style>
  #versionador {
    position: fixed;
    bottom: 8px;
    right: 12px;
    background: #004aad;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-family: Arial, sans-serif;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    opacity: 0.8;
  }
</style>
</head>
<body>
  <!-- conteúdo original do sistema mantido -->
  
  <!-- Botão de geração DOCX -->
  <button id="btnGerarDocx">Gerar Contrato .docx</button>

  <!-- Versionador -->
  <div id="versionador">Versão 1.1 - Atualizado em 15/10/2025</div>

  <!-- Scripts principais -->
  <script src="script.js"></script>

  <!-- SCRIPT ATUALIZADO PARA GERAR DOCX -->
  <script>
  document.getElementById('btnGerarDocx').addEventListener('click', async () => {
    try {
      // coleta todos os dados do formulário na tela
      const dados = {};
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.id) dados[el.id] = el.value.trim();
      });

      if (!dados.codigo || !dados.servico) {
        alert('Preencha ao menos o Código e o Serviço antes de gerar o contrato.');
        return;
      }

      // muda estado do botão enquanto gera
      const btn = document.getElementById('btnGerarDocx');
      btn.disabled = true;
      btn.textContent = 'Gerando contrato...';

      // envia os dados ao PHP
      const resposta = await fetch('gerar_docx.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });

      if (!resposta.ok) throw new Error('Erro ao gerar o contrato (.docx).');

      // baixa o arquivo retornado
      const blob = await resposta.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Contrato-${dados.codigo || 'documento'}.docx`;
      a.click();

    } catch (err) {
      console.error(err);
      alert('Erro ao gerar contrato. Verifique os dados e tente novamente.');
    } finally {
      const btn = document.getElementById('btnGerarDocx');
      btn.disabled = false;
      btn.textContent = 'Gerar Contrato .docx';
    }
  });
  </script>
</body>
</html>