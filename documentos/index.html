<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ERP √çMPAR ‚Äì Gerador de Documentos</title>
<!-- Tom Select / SweetAlert2 / EmailJS -->
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // SweetAlert2 ‚Äî aplica tema √çMPAR globalmente (UI only)
  if (window.Swal && Swal.mixin) {
    window.Swal = Swal.mixin({
      customClass: {
        popup: "impar-swal",
        confirmButton: "impar-swal-confirm",
        cancelButton: "impar-swal-cancel"
      },
      buttonsStyling: false
    });
  }

  // Transi√ß√£o de entrada (slide suave)
  window.addEventListener("DOMContentLoaded", () => {
    document.body.classList.add("impar-enter");
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
<!-- Layout √çMPAR Premium ‚Äì mesmo padr√£o do cronograma/farol -->
<style>:root{
      --bg:#020617;
      --card:#020617;
      --border:#1f2937;
      --text:#e5e7eb;
      --text-soft:#9ca3af;
      --blue:#3b82f6;
      --blue-dark:#1d4ed8;
      --green:#22c55e;
      --yellow:#eab308;
      --red:#ef4444;
      --accent:#cc6e00;
    }
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      padding:8px 16px 4px;
      display:flex;
      justify-content:center;
    }
    .header-inner{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:space-between;
      gap:16px;
      align-items:flex-start;
    }
    .brand{
      display:flex;
      flex-direction:row;
      align-items:center;
      gap:12px;
      text-shadow:0 2px 6px rgba(0,0,0,.8);
    }
    .brand-txt{display:flex; flex-direction:column; gap:2px;}
    .brand-kicker{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.85;
    }
    .brand-title{
      font-size:16px;
      font-weight:800;
      letter-spacing:.02em;
    }
    .brand-sub{
      font-size:12px;
      opacity:.85;
    }
    .tag-top{
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.7);
      color:var(--text-soft);
      display:flex;
      gap:8px;
      align-items:center;
      margin-top:12px;
    }
    .pill-btn{
      border:none;
      background:transparent;
      color:inherit;
      font:inherit;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
    }
    .pill-btn .icn{font-size:14px;}

main{
  flex: 1 1 auto;
  display: flex;
  justify-content: center;
  padding: 6px 12px;
  overflow: hidden; /* chave: evita scrollbar fantasma */
}


.layout{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
      border-radius:14px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 24px 60px rgba(15,23,42,.9);
      padding:10px 14px;
    }

    h1{
      font-size:18px;
      margin-bottom:4px;
    }
    .subtitulo{
      font-size:12px;
      color:var(--text-soft);
      margin-bottom:10px;
    }

    form{
      margin-top:6px;
      font-size:12px;
    }
    label{
      display:block;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:#9ca3af;
      margin-bottom:4px;
    }
    input,select{
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #111827;
      background:#020617;
      color:var(--text);
      font-size:12px;
      outline:none;
    }
    input:focus,select:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 1px rgba(59,130,246,.95), 0 0 18px rgba(59,130,246,.55), 0 0 46px rgba(29,78,216,.35);
    }
    input[disabled]{
      opacity:.85;
      cursor:not-allowed;
    }

    .form-row{
      display:flex;
      gap:12px;
      margin-bottom:6px;
      flex-wrap:wrap;
    }
    .form-row>div{
      flex:1 1 0;
      min-width:160px;
    }

    .modo-manual-box{
      margin-top:4px;
      font-size:11px;
      color:var(--text-soft);
    }
    .modo-manual-box label{
      text-transform:none;
      letter-spacing:0;
      display:flex;
      align-items:center;
      gap:6px;
      margin:0;
      cursor:pointer;
    }
    .modo-manual-box input[type="checkbox"]{
      width:auto;
      accent-color:var(--blue);
    }

    .btn-primary,
    .btn-secondary{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight:600;
      cursor:pointer;
    }
    .btn-primary{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#020617;
      box-shadow:0 10px 30px rgba(22,163,74,.6);
    }
    .btn-secondary{
      background:#111827;
      color:#fff;
      border:1px solid #374151;
    }

    .actions{
      margin-top:6px;
      margin-bottom:4px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .header-info{
      margin-top:2px;
      margin-bottom:6px;
      font-size:12px;
      color:#cfd8ff;
    }
    .header-info strong{font-weight:600;}

    .table-wrapper{
      overflow-x:auto;
      border-radius:12px;
      border:1px solid #111827;
      margin-top:6px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      background:#020617;
      min-width:480px;
    }
    th,td{
      padding:5px 6px;
      border-bottom:1px solid #1f2937;
      text-align:left;
    }
    th{
      background:#020617;
      position:sticky;
      top:0;
      z-index:1;
      font-weight:600;
      color:var(--text-soft);
    }
    tbody tr:hover{
      background:#111827;
    }
    .btn-remover{
      cursor:pointer;
    }
    .hint{
      max-width:620px
      margin-top:4px;
      font-size:16px;
      color:#e7ecff;
  }
    footer{
      background:#020617;
      color:#9ca3af;
      padding:6px 12px;
      font-size:10px;
    }
    .rodape-inner{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    @media(max-width:900px){
      .container{padding:10px 14px}
      h1{font-size:16px;}
    }
  
/* =========================================================
   √çMPAR PREMIUM (Menu) ‚Äî Overrides Visuais
   *N√£o mexe em IDs, nomes e l√≥gica do JS*
   ========================================================= */

:root{
  --p-bg-left:  #0b3a8a;
  --p-bg-mid:   #0b4c7a;
  --p-bg-right: #0a8a71;

  --p-card: rgba(2, 6, 23, .58);
  --p-card-2: rgba(2, 6, 23, .70);
  --p-border: rgba(255,255,255,.10);
  --p-border-soft: rgba(255,255,255,.08);

  --p-text: #e5e7eb;
  --p-text-soft: rgba(229,231,235,.78);

  --p-blue: #2f7bff;
  --p-blue-soft: rgba(47,123,255,.35);
  --p-green: #22c55e;

  --p-grad: linear-gradient(90deg, rgba(37,99,235,1), rgba(16,185,129,1));
  --p-grad-soft: linear-gradient(90deg, rgba(37,99,235,.25), rgba(16,185,129,.20));

  --p-radius: 22px;
  --p-radius-sm: 14px;
}

/* Fundo igual Menu */
body{
  color: var(--p-text) !important;
  background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
      }
body{
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.layout{
  flex:1 0 auto;
  width:100%;
}
footer{
  margin-top:auto;
}

/* Evita scroll horizontal em tabelas sem "empurrar" a p√°gina */
.tabela-wrapper{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.tabela-wrapper table{
  min-width: 760px; /* garante scroll dentro do wrapper, n√£o no body */
}

/* Loader sempre centralizado */
/* Mobile (<= 720px) */
@media (max-width: 720px){
  header{
    padding: 14px 12px;
  }
  .header-inner{
    flex-wrap: wrap;
    gap: 10px;
  }
  .brand{
    flex: 1 1 auto;
    min-width: 0;
  }
  .brand-text{
    min-width:0;
  }
  .brand-line{
    white-space: normal;
    line-height: 1.15;
  }
  .brand-title{
    font-size: 18px;
  }
  .brand-sub{
    font-size: 12px;
  }
  .title-stack{
    flex: 1 1 100%;
    min-width: 0;
    text-align: left;
  }
  .page-title{
    font-size: 14px;
    white-space: normal;
    line-height: 1.15;
  }
  .sub-title{
    font-size: 12px;
    white-space: normal;
  }
   .actions{
    margin-left: auto;
  }

  .container{
    padding: 10px 14px;
  }
  .card{
    padding: 12px;
    border-radius: 18px;
    margin-bottom: 24px;
  }

  .form-row{
    gap: 10px;
  }
  .field{
    flex: 1 1 100%;
    min-width: 0;
  }

  .input,
  select,
  textarea{
    font-size: 14px;
  }

  /* Tabela: scroll dentro do card (sem quebrar layout) */
  .tabela-wrapper{
    margin-top: 10px;
    border-radius: 14px;
  }

  footer{
    padding: 6px 12px;
  }
}

/* Loader (igual menu) */
.loader-card{
  width:min(420px, 95vw);
  padding:10px 14px;
  border-radius:18px;
  background: rgba(2,6,23,.66);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 30px 80px rgba(0,0,0,.45);
  backdrop-filter: blur(12px);
  text-align:center;
}
.loader-title{ font-weight:700; letter-spacing:.2px; margin:2px 0 6px; }
.loader-sub{ color: rgba(229,231,235,.78); font-size:12px; margin:0 0 10px; }
.spinner{
  width:44px; height:44px;
  border-radius:999px;
  border:4px solid rgba(255,255,255,.14);
  border-top-color: rgba(37,99,235,1);
  border-right-color: rgba(16,185,129,1);
  animation: spin 0.9s linear infinite;
  margin: 0 auto 8px;
}
@keyframes spin{ to{ transform: rotate(360deg);} }


/* --- √çMPAR Premium: logo orb no header --- */
.logo-orb{
      width:36px;height:36px;border-radius:999px;
      position:relative;
      background: conic-gradient(from 210deg,
        #22c55e,
        #06b6d4,
        #3b82f6,
        #a855f7,
        #f97316,
        #22c55e);
      box-shadow:
        0 10px 22px rgba(0,0,0,.35),
        0 0 0 1px rgba(255,255,255,.18) inset;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo-orb:before{
      content:"";
      position:absolute; inset:-6px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 55%);
      filter: blur(0.2px);
    }
    .logo-orb:after{
      content:"";
      position:absolute; inset:-14px;
      background: radial-gradient(circle at 50% 50%, rgba(34,197,94,.35), transparent 65%);
      filter: blur(10px);
      opacity:.7;
    }

    header{
      padding:8px 14px;
      display:flex;
      justify-content:center;
    }
    .header-inner{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:space-between;
      gap:16px;
      align-items:flex-start;
    }
    .brand{
      display:flex;
      flex-direction:row;
      align-items:center;
      gap:12px;
      text-shadow:0 2px 6px rgba(0,0,0,.8);
    }
    .brand-txt{display:flex; flex-direction:column; gap:2px;}
    .brand-kicker{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.85;
    }
    .brand-title{
      font-size:16px;
      font-weight:800;
      letter-spacing:.02em;
    }
    .brand-sub{
      font-size:12px;
      opacity:.85;
    }
    .tag-top{
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.7);
      color:var(--text-soft);
      display:flex;
      gap:8px;
      align-items:center;
      margin-top:12px;
    }
    .pill-btn{
      border:none;
      background:transparent;
      color:inherit;
      font:inherit;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
    }
    .pill-btn .icn{font-size:14px;}

.layout{
      width:100%;
      max-width:1200px;
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
      border-radius:18px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 24px 60px rgba(15,23,42,.9);
      padding:10px 14px;
    }

    h1{
      font-size:18px;
      margin-bottom:4px;
    }
    .subtitulo{
      font-size:14px;
      color:var(--text-soft);
      margin-bottom:10px;
    }

    form{
      margin-top:4px;
      font-size:12px;
    }
    label{
      display:block;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:#9ca3af;
      margin-bottom:4px;
    }
    input,select{
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #111827;
      background:#020617;
      color:var(--text);
      font-size:12px;
      outline:none;
    }
    input:focus,select:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 1px rgba(59,130,246,.95), 0 0 18px rgba(59,130,246,.55), 0 0 46px rgba(29,78,216,.35);
    }
    input[disabled]{
      opacity:.85;
      cursor:not-allowed;
    }

    .form-row{
      display:flex;
      gap:12px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .form-row>div{
      flex:1 1 0;
      min-width:160px;
    }

    .modo-manual-box{
      margin-top:4px;
      font-size:11px;
      color:var(--text-soft);
    }
    .modo-manual-box label{
      text-transform:none;
      letter-spacing:0;
      display:flex;
      align-items:center;
      gap:6px;
      margin:0;
      cursor:pointer;
    }
    .modo-manual-box input[type="checkbox"]{
      width:auto;
      accent-color:var(--blue);
    }

    .btn-primary,
    .btn-secondary{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight:600;
      cursor:pointer;
    }
    .btn-primary{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#020617;
      box-shadow:0 10px 30px rgba(22,163,74,.6);
    }
    .btn-secondary{
      background:#111827;
      color:#fff;
      border:1px solid #374151;
    }

    .actions{
      margin-top:8px;
      margin-bottom:2px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .header-info{
      margin-top:-8px;
      margin-bottom:6px;
      font-size:12px;
      color:#cfd8ff;
    }
    .header-info strong{font-weight:600;}

    .table-wrapper{
      overflow-x:auto;
      border-radius:12px;
      border:1px solid #111827;
      margin-top:6px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      background:#020617;
      min-width:480px;
    }
    th,td{
      padding:5px 6px;
      border-bottom:1px solid #1f2937;
      text-align:left;
    }
    th{
      background:#020617;
      position:sticky;
      top:0;
      z-index:1;
      font-weight:600;
      color:var(--text-soft);
    }
    tbody tr:hover{
      background:#111827;
    }
    .btn-remover{
      cursor:pointer;
    }

    footer{
      background:#020617;
      color:#9ca3af;
      padding:6px 12px;
      font-size:10px;
    }
    .rodape-inner{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    @media(max-width:900px){
      .container{padding:10px 14px}
      h1{font-size:16px;}
    }
  
/* =========================================================
   √çMPAR PREMIUM (Menu) ‚Äî Overrides Visuais
   *N√£o mexe em IDs, nomes e l√≥gica do JS*
   ========================================================= */

:root{
  --p-bg-left:  #0b3a8a;
  --p-bg-mid:   #0b4c7a;
  --p-bg-right: #0a8a71;

  --p-card: rgba(2, 6, 23, .58);
  --p-card-2: rgba(2, 6, 23, .70);
  --p-border: rgba(255,255,255,.10);
  --p-border-soft: rgba(255,255,255,.08);

  --p-text: #e5e7eb;
  --p-text-soft: rgba(229,231,235,.78);

  --p-blue: #2f7bff;
  --p-blue-soft: rgba(47,123,255,.35);
  --p-green: #22c55e;

  --p-grad: linear-gradient(90deg, rgba(37,99,235,1), rgba(16,185,129,1));
  --p-grad-soft: linear-gradient(90deg, rgba(37,99,235,.25), rgba(16,185,129,.20));

  --p-radius: 22px;
  --p-radius-sm: 14px;
}

/* Fundo igual Menu */
body{
  color: var(--p-text) !important;
  background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
      }
body{
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.layout{
  flex:1 0 auto;
  width:100%;
}
footer{
  margin-top:auto;
}

/* Evita scroll horizontal em tabelas sem "empurrar" a p√°gina */
.tabela-wrapper{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.tabela-wrapper table{
  min-width: 760px; /* garante scroll dentro do wrapper, n√£o no body */
}

/* Loader sempre centralizado */
/* Mobile (<= 720px) */
@media (max-width: 720px){
  header{
    padding: 8px 14px;
  }
  .header-inner{
    flex-wrap: wrap;
    gap: 10px;
  }
  .brand{
    flex: 1 1 auto;
    min-width: 0;
  }
  .brand-text{
    min-width:0;
  }
  .brand-line{
    white-space: normal;
    line-height: 1.15;
  }
  .brand-title{
    font-size: 18px;
  }
  .brand-sub{
    font-size: 12px;
  }
  .title-stack{
    flex: 1 1 100%;
    min-width: 0;
    text-align: left;
  }
  .page-title{
    font-size: 14px;
    white-space: normal;
    line-height: 1.15;
  }
  .sub-title{
    font-size: 12px;
    white-space: normal;
  }
  .actions{
    margin-left: auto;
  }

  .container{
    padding: 10px 14px;
  }
  .card{
    padding: 12px;
    border-radius: 14px;
    margin-bottom: 24px;
  }

  .form-row{
    gap: 10px;
  }
  .field{
    flex: 1 1 100%;
    min-width: 0;
  }

  .input,
  select,
  textarea{
    font-size: 14px;
  }

  /* Tabela: scroll dentro do card (sem quebrar layout) */
  .tabela-wrapper{
    margin-top: 10px;
    border-radius: 14px;
  }

  footer{
    padding: 6px 12px;
  }
}

/* Loader (igual menu) */
.loader-card{
  width:min(420px, 95vw);
  padding:10px 14px;
  border-radius:18px;
  background: rgba(2,6,23,.66);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 30px 80px rgba(0,0,0,.45);
  backdrop-filter: blur(12px);
  text-align:center;
}
.loader-title{ font-weight:700; letter-spacing:.2px; margin:2px 0 6px; }
.loader-sub{ color: rgba(229,231,235,.78); font-size:12px; margin:0 0 10px; }
.spinner{
  width:44px; height:44px;
  border-radius:999px;
  border:4px solid rgba(255,255,255,.14);
  border-top-color: rgba(37,99,235,1);
  border-right-color: rgba(16,185,129,1);
  animation: spin 0.9s linear infinite;
  margin: 0 auto 8px;
}
@keyframes spin{ to{ transform: rotate(360deg);} }

/* --- √çMPAR Premium: logo orb no header --- */
.logo-orb{
      width:36px;height:36px;border-radius:999px;
      position:relative;
      background: conic-gradient(from 210deg,
        #22c55e,
        #06b6d4,
        #3b82f6,
        #a855f7,
        #f97316,
        #22c55e);
      box-shadow:
        0 10px 22px rgba(0,0,0,.35),
        0 0 0 1px rgba(255,255,255,.18) inset;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo-orb:before{
      content:"";
      position:absolute; inset:-6px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 55%);
      filter: blur(0.2px);
    }
    .logo-orb:after{
      content:"";
      position:absolute; inset:-14px;
      background: radial-gradient(circle at 50% 50%, rgba(34,197,94,.35), transparent 65%);
      filter: blur(10px);
      opacity:.7;
    }
#pageLoader.hidden{
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(-6px);
}

/* Mobile/overflow safety */
html, body{ width:100%; overflow-x:hidden; }


/* =========================================================
   SWEETALERT2 ‚Äî Tema √çMPAR Premium (UI only)
   ========================================================= */
.impar-swal{
  background: rgba(2,6,23,.92) !important;
  color: #e5e7eb !important;
  border: 1px solid rgba(255,255,255,.10) !important;
  border-radius: 18px !important;
  box-shadow: 0 30px 80px rgba(0,0,0,.55) !important;
  backdrop-filter: blur(14px);
}
.impar-swal .swal2-title{ color:#e5e7eb !important; font-weight:800; }
.impar-swal .swal2-html-container{ color: rgba(229,231,235,.88) !important; }
.impar-swal .swal2-icon{ border-color: rgba(59,130,246,.8) !important; }
.impar-swal .swal2-loader{
  border-color: rgba(59,130,246,.25) !important;
  border-top-color: rgba(59,130,246,.95) !important;
}
.impar-swal-confirm{
  border: 0 !important;
  border-radius: 12px !important;
  padding: 10px 14px !important;
  font-weight: 800 !important;
  color: #fff !important;
  background: linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e) !important;
  box-shadow: 0 18px 38px rgba(0,0,0,.35) !important;
}
.impar-swal-cancel{
  border: 1px solid rgba(255,255,255,.16) !important;
  border-radius: 12px !important;
  padding: 10px 14px !important;
  font-weight: 800 !important;
  color: #e5e7eb !important;
  background: rgba(255,255,255,.06) !important;
}
.impar-swal .swal2-close{ color: rgba(229,231,235,.7) !important; }
.impar-swal-body{
  display:flex; gap:12px; align-items:center; justify-content:center;
  padding-top: 6px;
}
.impar-spinner{
  width:18px; height:18px; border-radius:999px;
  border:3px solid rgba(59,130,246,.25);
  border-top-color: rgba(59,130,246,.95);
  animation: imparSpin .85s linear infinite;
  flex: 0 0 auto;
}
@keyframes imparSpin { to { transform: rotate(360deg); } }
.impar-swal-sub{ text-align:left; line-height:1.25; }
.impar-swal-sub b{ color:#e5e7eb; }


/* =========================================================
   TRANSI√á√ÉO DE ENTRADA ‚Äî estilo slide (menu ‚Üí solicita√ß√£o)
   ========================================================= */
body { opacity: 0; }
@keyframes imparEnter {
  0% { opacity:0; transform: translateY(34px) scale(.97); filter: blur(10px); }
  100% { opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
}
body.impar-enter { animation: imparEnter .80s cubic-bezier(.16,1,.3,1) both; }
@media (prefers-reduced-motion: reduce) {
  body { opacity: 1; }
  body.impar-enter { animation:none; }
}


/* ===== Loader Premium ‚Äî padr√£o INDEX (override) ===== */
#pageLoader{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  background: rgba(2,6,23,.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 9999;
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transition: opacity .35s ease, transform .35s ease, visibility .35s ease;
}
#pageLoader.hidden{
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(-6px);
}


/* ===== Bot√µes verdes ‚Äî hover/focus premium (zoom + brilho) ===== */
.btn-primary{
  transition: transform .22s cubic-bezier(.16,1,.3,1),
              box-shadow .22s cubic-bezier(.16,1,.3,1),
              filter .22s cubic-bezier(.16,1,.3,1);
  will-change: transform;
}
.btn-primary:hover{
  transform: translateY(-1px) scale(1.035);
  filter: saturate(1.18) brightness(1.08);
  box-shadow:
    0 0 0 1px rgba(34,197,94,.95),
    0 0 22px rgba(34,197,94,.55),
    0 18px 45px rgba(22,163,74,.55);
}
.btn-primary:active{
  transform: translateY(0) scale(.99);
  filter: saturate(1.08) brightness(1.03);
}
.btn-primary:focus-visible{
  outline:none;
  transform: translateY(-1px) scale(1.035);
  box-shadow:
    0 0 0 2px rgba(2,6,23,.90),
    0 0 0 4px rgba(34,197,94,.75),
    0 0 26px rgba(34,197,94,.55);
}
    .btn-primary.is-loading,
    .btn-secondary.is-loading{
      pointer-events:none;
      opacity:.92;
      filter:saturate(1.02) brightness(1.01);
    }
    .mini-spinner{
      width:14px;height:14px;
      border-radius:999px;
      border:2px solid rgba(2,6,23,.35);
      border-top-color:rgba(2,6,23,.85);
      display:inline-block;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

.pill-btn{
  transition: transform .2s cubic-bezier(.16,1,.3,1), box-shadow .2s cubic-bezier(.16,1,.3,1);
}
.pill-btn:hover{ transform: translateY(-1px) scale(1.02); box-shadow: 0 12px 28px rgba(0,0,0,.28); }
.pill-btn:focus-visible{ outline:none; box-shadow: 0 0 0 2px rgba(2,6,23,.9), 0 0 0 4px rgba(47,123,255,.55); }


    /* ===== Stepper (Etapas 1‚Äì5) ‚Äî padr√£o √çMPAR (addon m√≠nimo) ===== */
    .wizard-top{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      margin: 6px 0 8px;
    }
    .stepper{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:nowrap;
      user-select:none;
    }
    .stepper .dot{
      width:24px;
      height:24px;
      border-radius:999px;
      display:grid;
      place-items:center;
      font-weight:800;
      font-size:11px;
      color:#e5e7eb;
      background: rgba(2,6,23,.65);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    .stepper .dot.active{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.72);
      color:#ecfdf5;
      box-shadow:
        0 0 0 2px rgba(2,6,23,.75),
        0 0 0 4px rgba(34,197,94,.40),
        0 0 22px rgba(34,197,94,.35);
    }
    .stepper .line{
      width:22px;
      height:2px;
      border-radius:999px;
      background: rgba(255,255,255,.20);
    }
    .stepper .line.active{
      background: linear-gradient(90deg, rgba(34,197,94,.75), rgba(34,197,94,.20));
      box-shadow: 0 0 14px rgba(34,197,94,.25);
    }
    @media (max-width: 520px){
      .stepper .dot{ width:24px; height:24px; font-size:12px; }
      .stepper .line{ width:16px; }
      .wizard-top{ justify-content:center; }
    }


/* ===== Ajustes finos Stepper (alinhado ao t√≠tulo) ===== */
.header-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
}
.stepper{
  margin:0;
}
.stepper .dot.active{
  background: linear-gradient(180deg, rgba(34,197,94,.95), rgba(22,163,74,.95));
  border-color: rgba(34,197,94,1);
  color:#022c22;
  box-shadow:
    0 0 0 2px rgba(2,6,23,.85),
    0 0 0 4px rgba(34,197,94,.45),
    0 0 24px rgba(34,197,94,.55);
}


/* ===== v12: Ajuste √öNICO ‚Äî subir SOMENTE os steppers (sem mover os campos) ===== */
.wizard-top{ margin: 8px 0 10px !important; } /* mant√©m o layout dos campos */
.wizard-top .stepper{
  position: relative;
  top: -70px;          /* ajuste aqui: -4, -8, -10, -12... */
}


/* ===== v14: Ajuste √öNICO ‚Äî descer SOMENTE o bot√£o CONTINUAR ===== */
.footer-actions{
  position: relative;
}
.footer-actions .btn-primary{
  position: relative;
  //top: -4px; /* ajuste aqui: 8, 12, 16... */
}


/* ===== v15: Ajuste √öNICO ‚Äî subir SOMENTE bloco Usu√°rio + Email (sem afetar C√≥digo/bot√µes) ===== */
.user-block{
  position: relative;
  top: -5px; /* ajuste aqui: -4, -8, -12... */
  margin-top: 0 !important;
}


/* ===== v16: Navega√ß√£o Stepper 1 -> 2 (mock) ===== */
.step-pane .hint{
  margin-top: 4px;
  opacity: .85;
  font-size: 16px;
}

/* ===== v16: Navega√ß√£o Stepper 1 -> 2 (mock) ===== */
.btn-primary{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.arrow{ display:inline-block; font-weight:900; }
.arrow-left{ transform: rotate(180deg); }



    /* ===== ETAPA 1 (layout do slide) ===== */
    .etapa1-topbox{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:10px 14px;
      border-radius:14px;
      border:2px solid rgba(34,197,94,.55);
      background:linear-gradient(120deg, rgba(2,6,23,.78), rgba(2,6,23,.35));
      box-shadow:0 18px 60px rgba(0,0,0,.35);
    }
    .etapa1-title{
      font-size:18px;
      font-weight:800;
      letter-spacing:.01em;
      color:#e5e7eb;
      margin-bottom:6px;
    }
    .etapa1-user-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:#9ca3af;
      margin-bottom:2px;
    }
    .etapa1-user-values{
      font-size:12px;
      color:#cfd8ff;
      line-height:1.25;
    }

    .etapa1-stepper-wrap{display:flex; align-items:center; justify-content:flex-end;}
    .wizard-top{margin:0; padding:0;} /* neutraliza espa√ßo antigo */

    /* stepper alinhado do slide */
    .stepper{
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 8px;
      border-radius:999px;
      background:rgba(2,6,23,.35);
      border:1px solid rgba(255,255,255,.06);
    }
    .stepper .dot{
      width:24px;
      height:24px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      font-weight:800;
      background:#0b1220;
      color:#cbd5e1;
      border:1px solid rgba(148,163,184,.25);
      box-shadow:0 10px 24px rgba(0,0,0,.25);
    }
    .stepper .dot.active{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#020617;
      border-color:rgba(34,197,94,.6);
      box-shadow:0 14px 34px rgba(22,163,74,.45);
    }
    .stepper .line{
      width:56px;
      height:3px;
      border-radius:999px;
      background:rgba(148,163,184,.18);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .stepper .line.active{
      background:linear-gradient(90deg,#22c55e,#16a34a);
      box-shadow:0 10px 24px rgba(22,163,74,.35);
    }

    .req-star{
      color:#fbbf24; /* amarelo */
      font-weight:900;
      text-shadow:0 0 10px rgba(251,191,36,.35);
      margin-left:2px;
    }
    .field-help{
      margin-top:6px;
      min-height:14px;
      font-size:12px;
      color:#94a3b8;
    }
    .field-help.ok{ color:#86efac; }
    .field-help.err{ color:#fca5a5; font-weight:700; }

    .step1-body{
      display:flex;
      flex-direction:column;
      min-height:360px; /* empurra o CONTINUAR para baixo sem criar scroll */
    }
    @media (max-width: 560px){
      .step1-body{ min-height:320px; }
    }
    .step1-spacer{ flex:1; }
    .actions.actions-end{justify-content:flex-end; margin-top:auto; padding-bottom:2px; }

    /* anima√ß√µes (entrada/sa√≠da no padr√£o do index) */
    @keyframes paneIn{
      from{opacity:0; transform:translateY(10px) scale(.985);}
      to{opacity:1; transform:translateY(0) scale(1);}
    }
    .step-pane.pane-in{ animation:paneIn .28s ease-out both; }

    @keyframes shakeX{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-6px)}
      40%{transform:translateX(6px)}
      60%{transform:translateX(-4px)}
      80%{transform:translateX(4px)}
    }
    .input-error{
      border:2px solid rgba(239,68,68,.95) !important;
      border-color:rgba(239,68,68,.95) !important;
      box-shadow:0 0 0 1px rgba(239,68,68,.95), 0 0 18px rgba(239,68,68,.35), 0 0 46px rgba(239,68,68,.25) !important;
      animation:shakeX .28s ease-in-out;
    }


/* ===== ETAPA 2 ‚Äî Layout igual ao print (compacto, sem scroll) ===== */
.etapa-center{
  flex: 1;
  text-align:center;
  padding: 0 10px;
}
.etapa-code{
  font-size: 20px;
  font-weight: 900;
  letter-spacing: .4px;
  color: rgba(229,231,235,.98);
}
.etapa-sub{
  margin-top: 4px;
  font-size: 18px;
  color: rgba(229,231,235,.92);
  opacity: .95;
}

.step-pane{
  display:flex;
  flex-direction:column;
}
.step2-body{
  margin-top: 16px;
  flex: 1;
}
.grid-2{
  display:grid;
  grid-template-columns: 1.6fr 1fr;
  gap: 18px;
  align-items:end;
}
@media (max-width: 900px){
  .grid-2{ grid-template-columns: 1fr; }
}

.field{
  display:flex;
  flex-direction:column;
  gap: 8px;
}
.field .msg{
  display:none;
  margin-top: -4px;
  font-size: 14px;
  color: rgba(239,68,68,.95);
  opacity: .95;
}
.field.invalid .msg{ display:block; }
.field.invalid input,
.field.invalid textarea{
  border:2px solid rgba(239,68,68,.95) !important;
  border-color:rgba(239,68,68,.95) !important;
  box-shadow:0 0 0 1px rgba(239,68,68,.95), 0 0 18px rgba(239,68,68,.35), 0 0 46px rgba(239,68,68,.25) !important;
}
.field.invalid input:focus,
.field.invalid textarea:focus{
  border-color:rgba(239,68,68,.98) !important;
  box-shadow:0 0 0 1px rgba(239,68,68,.98), 0 0 0 4px rgba(239,68,68,.22), 0 0 20px rgba(239,68,68,.28) !important;
}

.wizard-actions{
  margin-top:auto !important;
  padding-top: 14px;
  padding-bottom: 6px;
}


/* ===== FIX FINAL (v2) ‚Äî garante efeito apesar de CSS duplicado =====
   Objetivo: subir tudo ~2-4px SEM mexer em estrutura/JS.
   Colocado no FINAL com !important para vencer overrides anteriores.
*/
header{ padding-top:6px !important; padding-bottom:2px !important; }
.tag-top{ margin-top:8px !important; }
main{ padding-top:4px !important; padding-bottom:4px !important; }


/* ===== FIX FINAL (v3) ‚Äî reduzir o front-end TODO mantendo propor√ß√µes =====
   Edge/Chrome (Windows) suportam 'zoom' e isso REDUZ layout (n√£o s√≥ visual),
   eliminando a barra vertical sem quebrar espa√ßamentos.
*/
html, body { height: 100% !important; }
body{
  zoom: 0.985;                 /* ajuste fino: 0.98 ~ 0.99 */
}
/* fallback (caso algum navegador ignore zoom) */
@supports not (zoom: 1){
  body{
    transform: scale(0.985);
    transform-origin: top center;
  }
}
/* garante que n√£o apare√ßa barra por 1px */
html, body { overflow: hidden !important; }


/* ===== FIX FINAL (v5) ‚Äî subir TUDO menos o rodap√© + remover o "F" =====
   - Move header + main para cima (footer fica ancorado).
   - N√£o mexe em HTML/JS.
*/
header, main{
  transform: translateY(-10px) !important; /* ajuste fino: -8px, -10px, -12px */
}


/* Ajuste: campo SERVI√áO (agora input) com fundo preto igual aos demais */
#step2 #servico{
  background: #020617 !important;
  color: #e5e7eb !important;
}

/* =========================
   RESPONSIVO (mobile/tablet)
   Mant√©m o layout √çMPAR, apenas reorganiza para telas menores
   ========================= */
@media (max-width: 900px){
  html, body { overflow-x: hidden; }
  body { padding: 10px !important; }
  .container { width: 100% !important; padding: 0 10px !important; }
  header { padding: 10px 0 !important; }
  .header-inner { flex-wrap: wrap !important; gap: 12px !important; }
  .brand { gap: 10px !important; }
  .brand-title { font-size: 18px !important; }
  .brand-sub { font-size: 12px !important; }

  .card { padding: 14px !important; }
  .tag-top { width: 100% !important; }
  .stepper { width: 100% !important; justify-content: flex-start !important; overflow-x: auto !important; }
  .stepper::-webkit-scrollbar { height: 6px; }
  .stepper .dot { transform: scale(.95); }

  .grid-2 { grid-template-columns: 1fr !important; gap: 12px !important; }
  .form-row { gap: 10px !important; }
  .field { flex: 1 1 100% !important; min-width: 0 !important; }
  .field label { font-size: 12px !important; }

  /* evita zoom no iPhone ao focar */
  input, select, textarea { font-size: 16px !important; }

  /* for√ßa qualquer min-width inline a n√£o estourar no mobile */
  [style*="min-width"] { min-width: 0 !important; }
  [style*="max-width"] { max-width: 100% !important; }

  .actions, .actions-end { flex-wrap: wrap !important; gap: 10px !important; }
  .btnVoltar, .btnContinuar, .btn-primary { width: 100% !important; justify-content: center !important; }
}
@media (max-width: 520px){
  body { padding: 8px !important; }
  .card { padding: 12px !important; border-radius: 18px !important; }
  .brand-title { font-size: 16px !important; }
  .pill-btn { width: 100% !important; justify-content: center !important; }
}


/* =========================
   RESPONSIVO v2 (ajustes solicitados - mobile)
   - Quebra cabe√ßalho: t√≠tulo > stepper > c√≥digo/descri√ß√£o
   - Bot√µes dentro do card e centralizados
   - Scroll vertical funcionando no mobile
   ========================= */
@media (max-width: 900px){
  /* libera scroll vertical */
  html, body { height: auto !important; overflow-y: auto !important; }

  /* cabe√ßalho (topbox) em coluna */
  .etapa1-topbox{
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 12px !important;
  }
  .etapa1-topbox .etapa1-left{ order: 1 !important; width: 100% !important; }
  .etapa1-topbox .etapa1-stepper-wrap{ order: 2 !important; width: 100% !important; justify-content: flex-start !important; overflow-x: auto !important; }
  .etapa1-topbox .etapa-center{ order: 3 !important; width: 100% !important; text-align: left !important; }

  /* stepper n√£o ficar colado no t√≠tulo */
  .etapa1-stepper-wrap{ padding-top: 6px !important; }

  /* card rolar por dentro sem estourar */
  .card{
    max-height: calc(100vh - 220px) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* bot√µes: espa√ßamento e dentro do card */
  .actions, .actions-end{
    width: 100% !important;
    justify-content: center !important;
    align-items: stretch !important;
    gap: 10px !important;
    margin-top: 14px !important;
  }
  .btn-primary, .btnVoltar, .btnContinuar{
    width: 100% !important;
  }

  /* Etapa 1: separa os bot√µes (Atualizar/Gerar/Continuar) */
  .etapa1-btns, .etapa1-actions, .etapa1-actions-row{
    display: flex !important;
    flex-direction: column !important;
    gap: 10px !important;
  }
}
@media (max-width: 520px){
  .card{ max-height: calc(100vh - 200px) !important; }
}


/* Campos preenchidos automaticamente via CEP */
.input.cep-auto:disabled, input.cep-auto:disabled, textarea.cep-auto:disabled, select.cep-auto:disabled{
  background: rgba(255,255,255,.06) !important;
  color: rgba(255,255,255,.65) !important;
  border-color: rgba(255,255,255,.18) !important;
  box-shadow: none !important;
  cursor: not-allowed !important;
}

</style>
</head>
<body>
<!-- Loader premium (mesmo padr√£o do layout) -->
<div aria-hidden="true" class="hidden" id="pageLoader">
<div aria-live="polite" class="loader-card" role="status">
<div aria-hidden="true" class="spinner"></div>
<div class="loader-title">Carregando m√≥dulo‚Ä¶</div>
<div class="loader-sub">Preparando sua sess√£o e carregando dados.</div>
</div>
</div>
<header>
<div class="header-inner">
<div class="brand">
<div aria-hidden="true" class="logo-orb"></div>
<div class="brand-txt">
<div class="brand-kicker">PLATAFORMA</div>
<div class="brand-title">ERP √çMPAR</div>
<div class="brand-sub">Gerador de Documentos</div>
<div class="brand-sub" style="opacity:.75;font-weight:600">Padroniza√ß√£o para gera√ß√£o de contratos e ordem de servi√ßos</div>
</div>
</div>
<div class="tag-top">
<button class="pill-btn" id="btnVoltarMenu" type="button">
<span class="icn">üè†</span> Menu principal
        </button>
</div>
</div>
</header>
<main>
<div class="layout">
<div class="container">
<div class="step-pane" id="step1" style="">
<div class="etapa1-topbox">
<div class="etapa1-left">
<div class="etapa1-title">Gerador de Documentos - √çMPAR</div>
<div class="etapa1-user">
<div class="etapa1-user-label">Usu√°rio</div>
<div class="etapa1-user-values">
<strong id="userNome">Usu√°rio</strong><br/>
<span id="userEmail">email@imparsistemas.com</span>
</div>
</div>
</div>
<div class="etapa1-stepper-wrap">
<div class="stepper" id="stepper">
<div class="dot active" id="dot1">1</div><div class="line" id="line12"></div>
<div class="dot" id="dot2">2</div><div class="line" id="line23"></div>
<div class="dot" id="dot3">3</div><div class="line" id="line34"></div>
<div class="dot" id="dot4">4</div><div class="line" id="line45"></div>
<div class="dot" id="dot5">5</div>
</div>
</div>
</div>
<div class="hint">

          Informar o c√≥digo do projeto no campo abaixo. Esse c√≥digo ser√° a chave para busca de documentos e utilizado para outras funcionalidades importantes na empresa.
        </div>
<div class="step1-body">
<form autocomplete="off" id="formEtapa1">
<div class="form-row">
<div style="max-width:620px">
<label for="codigoProjeto">C√ìDIGO <span class="req-star">*</span></label>
<input id="codigoProjeto" inputmode="text" maxlength="20" placeholder="Digite o c√≥digo do projeto (ex.: 036)" type="text"/>
<div class="field-help" id="codigoHelp"></div>
</div>
</div>
<div class="actions">
<button class="btn-primary" id="btnAtualizar" type="button">ATUALIZAR DOCUMENTOS</button>
<button class="btn-primary" id="btnGerar" type="button">GERAR DOCUMENTOS</button>
</div>
<div class="step1-spacer"></div>
<div class="actions actions-end">
<button class="btn-primary" id="btnContinuar" style="min-width:180px" type="button">
<span>CONTINUAR</span>
<span class="arrow arrow-right">‚ûú</span>
</button>
</div>
</form>
</div>
</div>
<div class="step-pane" id="step2" style="display:none;">
<div class="etapa1-topbox">
<div class="etapa1-left">
<div class="etapa1-title">Gerador de Documentos - √çMPAR</div>
<div class="etapa1-user">
<div class="etapa1-user-label">Usu√°rio</div>
<div class="etapa1-user-values">
<strong id="userNome2">Usu√°rio</strong><br/>
<span id="userEmail2">email@imparsistemas.com</span>
</div>
</div>
</div>
<div class="etapa-center">
<div class="etapa-code">C√≥digo: <span id="codigoResumo">AC00022</span></div>
<div class="etapa-sub">Etapa de informa√ß√µes gerais da obra</div>
</div>
<div class="etapa1-stepper-wrap">
<div aria-label="Etapas" class="stepper" id="stepper2">
<div class="dot active" id="dot1b">1</div><div class="line active" id="line12b"></div>
<div class="dot active" id="dot2b">2</div><div class="line" id="line23b"></div>
<div class="dot" id="dot3b">3</div><div class="line" id="line34b"></div>
<div class="dot" id="dot4b">4</div><div class="line" id="line45b"></div>
<div class="dot" id="dot5b">5</div>
</div>
</div>
</div>
<div class="card" style="display:flex; flex-direction:column; min-height: 360px;">
<form autocomplete="off" id="formEtapa2" style="display:flex; flex-direction:column; gap:12px; flex:1;">
<div class="form-row" style="display:flex; gap:12px; align-items:flex-start;">
<div class="field" data-name="Nome da obra" data-required="true" id="fNomeObra">
<label class="lbl">Nome da obra <span class="req">*</span></label>
<input class="input" id="nomeObra" placeholder="" type="text"/>
<div class="msg">Campo obrigat√≥rio.</div>
</div>
<div class="field" data-name="Projetista" data-required="false" id="fProjetista">
<label class="lbl">Projetista</label>
<input class="input" id="projetista" placeholder="" type="text"/>
<div class="msg"></div>
</div>
</div>
<div class="field" data-name="Servi√ßo" data-required="true" id="fServico">
<label class="lbl">Servi√ßo <span class="req">*</span></label>
<input class="input" id="servico" placeholder="" type="text"/>
<div class="msg">Campo obrigat√≥rio.</div>
</div>
<div class="field" data-name="Endere√ßo da obra" data-required="true" id="fEndereco">
<label class="lbl">Endere√ßo da obra <span class="req">*</span></label>
<input class="input" id="endereco" placeholder="" type="text"/>
<div class="msg">Campo obrigat√≥rio.</div>
</div>
<div style="flex:1"></div>
<div class="actions" style="justify-content:space-between; margin-top:auto; padding-top:10px;">
<button class="btn-primary btnVoltar" style="min-width:220px;" type="button">
<span class="arrow arrow-left">‚ûú</span>
<span>VOLTAR</span>
</button>
<button class="btn-primary btnContinuar" style="min-width:220px;" type="button">
<span>CONTINUAR</span>
<span class="arrow arrow-right">‚ûú</span>
</button>
</div>
</form>
</div>
</div><div class="step-pane" id="step3" style="display:none;">
<div class="etapa1-topbox">
<div class="etapa1-left">
<div class="etapa1-title">Gerador de Documentos - √çMPAR</div>
<div class="etapa1-user">
<div class="etapa1-user-label">Usu√°rio</div>
<div class="etapa1-user-values">
<strong id="userNome3">Usu√°rio</strong><br/>
<span id="userEmail3">email@imparsistemas.com</span>
</div>
</div>
</div>
<div class="etapa-center">
<div class="etapa-code">C√≥digo: <span id="codigoResumo3">AC00022</span></div>
<div class="etapa-sub">Etapa dos dados do contratante</div>
</div>
<div class="etapa1-stepper-wrap">
<div aria-label="Etapas" class="stepper" id="stepper3">
<div class="active dot" id="dot1c">1</div><div class="active line" id="line12c"></div>
<div class="active dot" id="dot2c">2</div><div class="active line" id="line23c"></div>
<div class="active dot" id="dot3c">3</div><div class="line" id="line34c"></div>
<div class="dot" id="dot4c">4</div><div class="line" id="line45c"></div>
<div class="dot" id="dot5c">5</div>
</div>
</div>
</div>
<div class="card" style="display:flex; flex-direction:column; min-height: 360px;">
<form autocomplete="off" id="formEtapa3" style="display:flex; flex-direction:column; gap:12px; flex:1;"><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Nome" data-required="true" id="fNomeContratante" style="flex:1;"><label class="lbl">Nome <span class="req">*</span></label><input class="input" id="nomeContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="CPF/CNPJ" data-required="true" id="fCpfCnpj" style="flex:1;"><label class="lbl">CPF/CNPJ <span class="req">*</span></label><input class="input" id="cpfCnpjContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Contato" data-required="true" id="fContato" style="flex:1.2;"><label class="lbl">Contato <span class="req">*</span></label><input class="input" id="contatoContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Telefone" data-required="true" id="fTelefone" style="flex:1;"><label class="lbl">Telefone <span class="req">*</span></label><input class="input" id="telefoneContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="CEP" data-required="true" id="fCep" style="flex:1;"><label class="lbl">CEP <span class="req">*</span></label><input class="input" id="cepContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Logradouro (atualiza automaticamente pelo CEP)" data-required="true" id="fLogradouro" style="flex:2;"><label class="lbl">Logradouro (atualiza automaticamente pelo CEP) <span class="req">*</span></label><input class="input" id="logradouroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="N√∫mero" data-required="true" id="fNumero" style="flex:1;"><label class="lbl">N√∫mero <span class="req">*</span></label><input class="input" id="numeroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Complemento" data-required="true" id="fComplemento" style="flex:1;"><label class="lbl">Complemento <span class="req">*</span></label><input class="input" id="complementoContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Bairro" data-required="true" id="fBairro" style="flex:1;"><label class="lbl">Bairro <span class="req">*</span></label><input class="input" id="bairroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Cidade" data-required="true" id="fCidade" style="flex:1;"><label class="lbl">Cidade <span class="req">*</span></label><input class="input" id="cidadeContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="UF" data-required="true" id="fUf" style="flex:0.6;"><label class="lbl">UF <span class="req">*</span></label><input class="input" id="ufContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Email" data-required="true" id="fEmail" style="flex:1.4;"><label class="lbl">Email <span class="req">*</span></label><input class="input" id="emailContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div style="flex:1"></div><div class="actions" style="justify-content:space-between; margin-top:auto; padding-top:10px;"><button class="btn-primary btnVoltar" style="min-width:220px;" type="button"><span class="arrow arrow-left">‚ûú</span><span>VOLTAR</span></button><button class="btn-primary btnContinuar" style="min-width:220px;" type="button"><span>CONTINUAR</span><span class="arrow arrow-right">‚ûú</span></button></div></form>
</div>
</div><div class="step-pane" id="step4" style="display:none;">
<div class="etapa1-topbox">
<div class="etapa1-left">
<div class="etapa1-title">Gerador de Documentos - √çMPAR</div>
<div class="etapa1-user">
<div class="etapa1-user-label">Usu√°rio</div>
<div class="etapa1-user-values">
<strong id="userNome3">Usu√°rio</strong><br/>
<span id="userEmail3">email@imparsistemas.com</span>
</div>
</div>
</div>
<div class="etapa-center">
<div class="etapa-code">C√≥digo: <span id="codigoResumo3">AC00022</span></div>
<div class="etapa-sub">Etapa dos dados da contratada</div>
</div>
<div class="etapa1-stepper-wrap">
<div aria-label="Etapas" class="stepper" id="stepper4">
<div class="active dot" id="dot1d">1</div><div class="active line" id="line12d"></div>
<div class="active dot" id="dot2d">2</div><div class="active line" id="line23d"></div>
<div class="active dot" id="dot3d">3</div><div class="line" id="line34d"></div>
<div class="dot" id="dot4d">4</div><div class="line" id="line45d"></div>
<div class="dot" id="dot5d">5</div>
</div>
</div>
</div>
<div class="card" style="display:flex; flex-direction:column; min-height: 360px;">
<form autocomplete="off" id="formEtapa4" style="display:flex; flex-direction:column; gap:12px; flex:1;"><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Nome" data-required="true" id="fNomeContratante" style="flex:1;"><label class="lbl">Nome <span class="req">*</span></label><input class="input" id="nomeContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="CPF/CNPJ" data-required="true" id="fCpfCnpj" style="flex:1;"><label class="lbl">CPF/CNPJ <span class="req">*</span></label><input class="input" id="cpfCnpjContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Contato" data-required="true" id="fContato" style="flex:1.2;"><label class="lbl">Contato <span class="req">*</span></label><input class="input" id="contatoContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Telefone" data-required="true" id="fTelefone" style="flex:1;"><label class="lbl">Telefone <span class="req">*</span></label><input class="input" id="telefoneContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="CEP" data-required="true" id="fCep" style="flex:1;"><label class="lbl">CEP <span class="req">*</span></label><input class="input" id="cepContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Logradouro (atualiza automaticamente pelo CEP)" data-required="true" id="fLogradouro" style="flex:2;"><label class="lbl">Logradouro (atualiza automaticamente pelo CEP) <span class="req">*</span></label><input class="input" id="logradouroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="N√∫mero" data-required="true" id="fNumero" style="flex:1;"><label class="lbl">N√∫mero <span class="req">*</span></label><input class="input" id="numeroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Complemento" data-required="true" id="fComplemento" style="flex:1;"><label class="lbl">Complemento <span class="req">*</span></label><input class="input" id="complementoContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Bairro" data-required="true" id="fBairro" style="flex:1;"><label class="lbl">Bairro <span class="req">*</span></label><input class="input" id="bairroContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div class="form-row" style="display:flex; gap:12px; align-items:flex-start;"><div class="field" data-name="Cidade" data-required="true" id="fCidade" style="flex:1;"><label class="lbl">Cidade <span class="req">*</span></label><input class="input" id="cidadeContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="UF" data-required="true" id="fUf" style="flex:0.6;"><label class="lbl">UF <span class="req">*</span></label><input class="input" id="ufContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div><div class="field" data-name="Email" data-required="true" id="fEmail" style="flex:1.4;"><label class="lbl">Email <span class="req">*</span></label><input class="input" id="emailContratante" type="text"/><div class="msg">Campo obrigat√≥rio.</div></div></div><div style="flex:1"></div><div class="actions" style="justify-content:space-between; margin-top:auto; padding-top:10px;"><button class="btn-primary btnVoltar" style="min-width:220px;" type="button"><span class="arrow arrow-left">‚ûú</span><span>VOLTAR</span></button><button class="btn-primary btnContinuar" style="min-width:220px;" type="button"><span>CONTINUAR</span><span class="arrow arrow-right">‚ûú</span></button></div></form>
</div>
</div>
</div></div></main>
<footer>
<div class="rodape-inner">
<span>¬© 2025 ERP √çMPAR ‚Ä¢ Gerador de Documentos</span>
<span>Layout integrado ao cronograma e farol de obras</span>
</div>
</footer>
<script>
    // Voltar para o menu principal
    document.getElementById("btnVoltarMenu").addEventListener("click", () => {
      const btn = document.getElementById("btnVoltarMenu");
      const undo = setBtnLoading(btn, "ABRINDO MENU...");
      showLoader("Abrindo menu‚Ä¶", "Carregando m√≥dulos e permiss√µes.");
      setTimeout(() => {
        undo();
        window.location.href = "./menu.html";
      }, 350);
    });

    // ===== Loader Premium =====
    function showLoader(title, sub){
      const el = document.getElementById("pageLoader");
      if(!el) return;
      const t = el.querySelector(".loader-title");
      const s = el.querySelector(".loader-sub");
      if(t) t.textContent = title || "Carregando m√≥dulo‚Ä¶";
      if(s) s.textContent = sub || "Preparando sua sess√£o e carregando dados.";
      el.classList.remove("hidden");
    }
    function hideLoader(){
      const el = document.getElementById("pageLoader");
      if(!el) return;
      el.classList.add("hidden");
    }

  // helpers para fluxo de CEP (mant√©m padr√£o do loader premium)
  function showProcessing(message){
    try { showLoader(message || "Carregando..."); }
    catch(e){
      const l = document.getElementById("pageLoader");
      if(l){ l.classList.remove("hidden"); l.setAttribute("aria-hidden","false"); }
    }
  }
  function hideProcessing(){
    try { hideLoader(); }
    catch(e){
      const l = document.getElementById("pageLoader");
      if(l){ l.classList.add("hidden"); l.setAttribute("aria-hidden","true"); }
    }
  }

    // ===== UX helpers (padr√£o √çMPAR) =====
    function setBtnLoading(btn, label){
      if(!btn) return () => {};
      const old = {
        html: btn.innerHTML,
        disabled: btn.disabled,
        w: btn.style.minWidth || ""
      };
      btn.disabled = true;
      btn.classList.add("is-loading");
      btn.style.minWidth = old.w || btn.offsetWidth + "px";
      btn.innerHTML = `<span>${label}</span> <span class="mini-spinner" aria-hidden="true"></span>`;
      return () => {
        btn.disabled = old.disabled;
        btn.classList.remove("is-loading");
        btn.innerHTML = old.html;
        btn.style.minWidth = old.w;
      };
    }

    function shake(el){
    if(!el) return;
    el.classList.remove("shake");
    // for√ßa reflow
    void el.offsetWidth;
    el.classList.add("shake");
}

function getHelpEl(input){
    if(!input) return null;
    // tenta padr√µes comuns do layout
    const byId = input.id ? document.getElementById(input.id + "Help") : null;
    if(byId) return byId;
    const field = input.closest(".field");
    if(field){
        const h = field.querySelector(".field-help, .field-error, .help, small");
        if(h) return h;
    }
    // fallback: procurar logo ap√≥s o input
    const sib = input.parentElement ? input.parentElement.querySelector(".field-help, .field-error, .help, small") : null;
    return sib || null;
}

function setFieldError(input, message){
    if(!input) return;
    input.classList.add("input-error");
    input.classList.remove("input-ok");
    const helpEl = getHelpEl(input);
    if(helpEl){
        helpEl.textContent = message || "Informa√ß√£o inv√°lida";
        helpEl.style.display = "block";
        helpEl.style.color = "#ff5b5b";
    }
}

function clearFieldError(input){
    if(!input) return;
    input.classList.remove("input-error");
    input.classList.add("input-ok");
    const helpEl = getHelpEl(input);
    if(helpEl){
        helpEl.textContent = "";
        helpEl.style.display = "none";
    }
}

    function bindLiveValidationForForm(form){
    if(!form) return;

    const q = (sel)=> form.querySelector(sel);

    const cpfEl   = q("#cpfCnpjContratante, #cpfCnpjContratada, input[id*='cpf'], input[id*='cnpj']");
    const telEl   = q("#telefoneContratante, #telefoneContratada, input[id*='telefone']");
    const cepEl   = q("#cepContratante, #cepContratada, input[id*='cep']");
    const emailEl = q("#emailContratante, #emailContratada, input[id*='email']");

    // pode existir em mais de um passo
    const numeroEls = Array.from(form.querySelectorAll("input[id*='numero'], input[name*='numero'], input[data-name*='NUMERO']"));

    const setReq = (el)=>{
        if(!el) return false;
        const v = (el.value||"").trim();
        if(!v){
            setFieldError(el, "Campo obrigat√≥rio.");
            shake(el);
            return false;
        }
        return true;
    };

    const digitsOnlyBind = (el)=>{
        if(!el) return;
        el.addEventListener("input", ()=>{
            const d = onlyDigits(el.value||"");
            if(el.value !== d) el.value = d;
            // enquanto digita, limpa o erro pra ficar suave
            if(d) clearFieldError(el);
        });
        // aplica normaliza√ß√£o inicial
        el.value = onlyDigits(el.value||"");
    };

    // Bloqueio de texto (somente d√≠gitos)
    digitsOnlyBind(cpfEl);
    digitsOnlyBind(telEl);
    digitsOnlyBind(cepEl);
    numeroEls.forEach(digitsOnlyBind);

    const validateCpfNow = (el)=>{
        if(!setReq(el)) return false;
        const v = onlyDigits(el.value||"");
        if(!isCpfCnpjValid(v)){
            setFieldError(el, "CPF/CNPJ inv√°lido");
            shake(el);
            return false;
        }
        clearFieldError(el);
        return true;
    };

    const validatePhoneNow = (el)=>{
        if(!setReq(el)) return false;
        const v = onlyDigits(el.value||"");
        if(!isPhoneValid(v)){
            setFieldError(el, "Telefone inv√°lido");
            shake(el);
            return false;
        }
        clearFieldError(el);
        return true;
    };

    const validateCepNow = (el)=>{
        if(!setReq(el)) return false;
        const v = onlyDigits(el.value||"");
        if(v.length !== 8){
            setFieldError(el, "CEP inv√°lido");
            shake(el);
            return false;
        }
        clearFieldError(el);
        return true;
    };

    const validateEmailNow = (el)=>{
        if(!setReq(el)) return false;
        const v = (el.value||"").trim();
        if(!isEmailValid(v)){
            setFieldError(el, "E-mail inv√°lido");
            shake(el);
            return false;
        }
        clearFieldError(el);
        return true;
    };

    const validateNumeroNow = (el)=>{
        if(!setReq(el)) return false;
        // j√° est√° digits-only; se tiver pelo menos 1 d√≠gito, ok
        clearFieldError(el);
        return true;
    };

    // Valida√ß√£o no BLUR (sem travar o foco)
    if(cpfEl)   cpfEl.addEventListener("blur", ()=> validateCpfNow(cpfEl));
    if(telEl)   telEl.addEventListener("blur", ()=> validatePhoneNow(telEl));
    if(cepEl)   cepEl.addEventListener("blur", ()=> validateCepNow(cepEl));
    if(emailEl) emailEl.addEventListener("blur", ()=> validateEmailNow(emailEl));
    numeroEls.forEach(el=> el.addEventListener("blur", ()=> validateNumeroNow(el)));
}

function onlyDigits(v){ return (v||"").replace(/\D+/g,''); }

function isEmailValid(email){
  const v=(email||"").trim();
  // simples e suficiente pro front-end
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(v);
}

function isPhoneValid(phone){
  const d=onlyDigits(phone);
  // BR: 10 (fixo) ou 11 (celular) com DDD
  if(!(d.length===10 || d.length===11)) return false;
  if(/^0+$/.test(d)) return false;
  // DDD 11-99
  const ddd=parseInt(d.slice(0,2),10);
  if(isNaN(ddd) || ddd<11 || ddd>99) return false;
  // se 11 d√≠gitos, o 3¬∫ tende a ser 9 (celular)
  if(d.length===11 && d[2]!=='9') return false;
  return true;
}

function isCPFValid(cpf){
  const v=onlyDigits(cpf);
  if(v.length!==11) return false;
  if(/^([0-9])\1+$/.test(v)) return false;
  let sum=0;
  for(let i=0;i<9;i++) sum += parseInt(v[i],10) * (10-i);
  let d1 = (sum*10)%11; if(d1===10) d1=0;
  if(d1!==parseInt(v[9],10)) return false;
  sum=0;
  for(let i=0;i<10;i++) sum += parseInt(v[i],10) * (11-i);
  let d2=(sum*10)%11; if(d2===10) d2=0;
  return d2===parseInt(v[10],10);
}

function isCNPJValid(cnpj){
  const v=onlyDigits(cnpj);
  if(v.length!==14) return false;
  if(/^([0-9])\1+$/.test(v)) return false;
  const calc=(base)=>{
    let sum=0, pos=base-7;
    for(let i=0;i<base;i++){
      sum += parseInt(v[i],10)*pos--;
      if(pos<2) pos=9;
    }
    const r=sum%11;
    return (r<2)?0:(11-r);
  };
  const d1=calc(12);
  const d2=calc(13);
  return d1===parseInt(v[12],10) && d2===parseInt(v[13],10);
}

function isCpfCnpjValid(val){
  const d=onlyDigits(val);
  if(d.length===11) return isCPFValid(d);
  if(d.length===14) return isCNPJValid(d);
  return false;
}

async function preencherEnderecoViaCEP(stepEl){
  const cepEl = stepEl.querySelector('#cepContratante');
  const logEl = stepEl.querySelector('#logradouroContratante');
  const bairroEl = stepEl.querySelector('#bairroContratante');
  const cidEl = stepEl.querySelector('#cidadeContratante');
  const ufEl = stepEl.querySelector('#ufContratante');

  // travar/destravar campos preenchidos pelo CEP (fica cinza e evita edi√ß√£o manual)
  const lockAddr = (locked)=>{
    [logEl, bairroEl, cidEl, ufEl].forEach(el=>{
      if(!el) return;
      el.disabled = !!locked;
      if(locked) el.classList.add('cep-auto');
      else el.classList.remove('cep-auto');
    });
  };
  if(!cepEl) return;

  const cep=onlyDigits(cepEl.value);
  if(cep.length!==8){ lockAddr(false); return; }

  // spinner/mensagem padr√£o
  showProcessing('Consultando CEP...');
  try{
    const res=await fetch(`https://viacep.com.br/ws/${cep}/json/`);
    const data=await res.json();
    hideProcessing();

    lockAddr(false);
    if(data && !data.erro){
      if(logEl) logEl.value = data.logradouro || '';
      if(bairroEl) bairroEl.value = data.bairro || '';
      if(cidEl) cidEl.value = data.localidade || '';
      if(ufEl) ufEl.value = data.uf || '';
      lockAddr(true);
      // limpa erros caso existam
      [logEl,bairroEl,cidEl,ufEl].forEach(el=> el && clearFieldError(el));
    }else{
      setFieldError(cepEl,'CEP n√£o encontrado');
    }
  }catch(e){
    lockAddr(false);

    hideProcessing();
    setFieldError(cepEl,'Falha ao consultar CEP');
  }
}

function validateStep1(){
  const codigoEl = document.getElementById('codigoProjeto');
  if(!codigoEl) return true;
  const v=(codigoEl.value||'').trim();
  // obrigat√≥rio
  if(!v){
    setFieldError(codigoEl,'Informe o c√≥digo do projeto');
    return false;
  }
  // alfanum√©rico
  if(!/^[A-Za-z0-9]+$/.test(v)){
    setFieldError(codigoEl,'Use apenas letras e n√∫meros');
    return false;
  }
  clearFieldError(codigoEl);
  return true;
}

function validateStep2(){
    const form = document.getElementById("formEtapa2");
    if(!form) return true;

    const fields = Array.from(form.querySelectorAll(".field[data-required='true']"));
    let firstBad = null;

    fields.forEach(f => {
      const input = f.querySelector("input, textarea, select");
      const val = (input && (input.value || "")).toString().trim();
      const ok = val.length > 0;
      if(!ok){
        f.classList.add("invalid");
        if(!firstBad) firstBad = input;
      } else {
        f.classList.remove("invalid");
      }
    });

    if(firstBad){
      try{ firstBad.focus({preventScroll:true}); }catch(e){ try{ firstBad.focus(); }catch(_){} }
      // mant√©m padr√£o das mensagens j√° existentes no mockup
      if (typeof Swal !== "undefined"){
        Swal.fire({
          icon:"warning",
          title:"Campo obrigat√≥rio",
          text:"Preencha os campos destacados para continuar.",
          confirmButtonText:"Ok"
        });
      }
      return false;
    }
    return true;
  }

/**
 * Wizard √çMPAR ‚Äî navega√ß√£o Step 1 ‚Üí 5
 * - N√£o depende de IDs duplicados.
 * - Mant√©m layout est√°vel (n√£o mexe em CSS).
 * - Valida c√≥digo na etapa 1 usando requireCodigo() (se existir).
 * - Atualiza steppers (dots e lines) dentro da etapa vis√≠vel.
 */

(function () {

  const STEPS = [1,2,3,4,5];

  function getStepEl(n){
    return document.getElementById("step" + n);
  }

  
  // ===== Valida√ß√£o ETAPA 3 (mesmo padr√£o da Etapa 2) =====
  function validateStep3(){
    const form = document.getElementById("formEtapa3");
    if(!form) return true;

    const fields = Array.from(form.querySelectorAll(".field[data-required='true']"));
    let firstBad = null;

    fields.forEach(f => {
      // Complemento n√£o √© obrigat√≥rio
      if(((f.getAttribute('data-name')||'').toLowerCase().includes('complemento')) || ((f.id||'').toLowerCase().includes('complemento'))){
        const msg = f.querySelector('.msg');
        if(msg) msg.textContent = '';
        f.classList.remove('invalid');
        return;
      }

      const input = f.querySelector("input, textarea, select");
      const val = (input && (input.value || "")).toString().trim();
      const ok = val.length > 0;
      if(!ok){
        f.classList.add("invalid");
        if(!firstBad) firstBad = input;
        const msg = f.querySelector(".msg");
        if (msg) msg.textContent = "Campo obrigat√≥rio.";
      } else {
        f.classList.remove("invalid");
        const msg = f.querySelector(".msg");
        if (msg) msg.textContent = "";
      }
    });

    if (firstBad){
      try{ firstBad.focus({preventScroll:true}); }catch(e){}
      Swal.fire({
        icon: "warning",
        title: "Campos obrigat√≥rios",
        html: "Preencha todos os campos obrigat√≥rios para continuar.",
        confirmButtonText: "Ok"
      });
      return false;
    }

  // valida√ß√µes espec√≠ficas (CPF/CNPJ, telefone, CEP, e-mail)
  const cpfEl = formEtapa3.querySelector('#cpfCnpjContratante');
  if(cpfEl && !isCpfCnpjValid(cpfEl.value)){
    setFieldError(cpfEl,'CPF/CNPJ inv√°lido');
    return false;
  }

  const telEl = formEtapa3.querySelector('#telefoneContratante');
  if(telEl && !isPhoneValid(telEl.value)){
    setFieldError(telEl,'Telefone inv√°lido');
    return false;
  }

  const cepEl = formEtapa3.querySelector('#cepContratante');
  if(cepEl && onlyDigits(cepEl.value).length!==8){
    setFieldError(cepEl,'CEP inv√°lido');
    return false;
  }

  const emailEl = formEtapa3.querySelector('#emailContratante');
  if(emailEl && !isEmailValid(emailEl.value)){
    setFieldError(emailEl,'E-mail inv√°lido');
    return false;
  }

    return true;
  }



  // ===== Valida√ß√£o ETAPA 4 (mesmo padr√£o da Etapa 3) =====
  function validateStep4(){
    const form = document.getElementById("formEtapa4");
    if(!form) return true;

    const fields = Array.from(form.querySelectorAll(".field[data-required='true']"));
    let firstBad = null;

    fields.forEach(f => {
      // Complemento n√£o √© obrigat√≥rio
      if(((f.getAttribute('data-name')||'').toLowerCase().includes('complemento')) || ((f.id||'').toLowerCase().includes('complemento'))){
        const msg = f.querySelector('.msg');
        if(msg) msg.textContent = '';
        f.classList.remove('invalid');
        return;
      }

      const input = f.querySelector("input, textarea, select");
      const val = (input && (input.value || "")).toString().trim();
      const ok = val.length > 0;
      if(!ok){
        f.classList.add("invalid");
        if(!firstBad) firstBad = input;
        const msg = f.querySelector(".msg");
        if (msg) msg.textContent = "Campo obrigat√≥rio.";
      } else {
        f.classList.remove("invalid");
        const msg = f.querySelector(".msg");
        if (msg) msg.textContent = "";
      }
    });

    if (firstBad){
      try{ firstBad.focus({preventScroll:true}); }catch(e){}
      Swal.fire({
        icon: "warning",
        title: "Campos obrigat√≥rios",
        html: "Preencha todos os campos obrigat√≥rios para continuar.",
        confirmButtonText: "Ok"
      });
      return false;
    }

  // valida√ß√µes espec√≠ficas (CPF/CNPJ, telefone, CEP, e-mail)
  const cpfEl = formEtapa4.querySelector('#cpfCnpjContratante');
  if(cpfEl && !isCpfCnpjValid(cpfEl.value)){
    setFieldError(cpfEl,'CPF/CNPJ inv√°lido');
    return false;
  }

  const telEl = formEtapa4.querySelector('#telefoneContratante');
  if(telEl && !isPhoneValid(telEl.value)){
    setFieldError(telEl,'Telefone inv√°lido');
    return false;
  }

  const cepEl = formEtapa4.querySelector('#cepContratante');
  if(cepEl && onlyDigits(cepEl.value).length!==8){
    setFieldError(cepEl,'CEP inv√°lido');
    return false;
  }

  const emailEl = formEtapa4.querySelector('#emailContratante');
  if(emailEl && !isEmailValid(emailEl.value)){
    setFieldError(emailEl,'E-mail inv√°lido');
    return false;
  }

    return true;
  }


function getCurrentStep(){
    for (const n of STEPS){
      const el = getStepEl(n);
      if (el && el.style.display !== "none") return n;
    }
    return 1;
  }

  function setDisplayStep(n){
    STEPS.forEach(k => {
      const el = getStepEl(k);
      if (!el) return;
      if (k === n) { el.style.display = ""; el.classList.remove("pane-in"); void el.offsetWidth; el.classList.add("pane-in"); }
      else { el.style.display = "none"; el.classList.remove("pane-in"); }
    });
  }

  // Pega o container do step ativo e busca bot√µes dentro dele
  function getActivePane(){
    const n = getCurrentStep();
    return getStepEl(n);
  }

  function getBtnContinuar(pane){
    // Step1 pode ter id, steps seguintes devem ter class
    return pane.querySelector("#btnContinuar") || pane.querySelector(".btnContinuar");
  }

  function getBtnVoltar(pane){
    // Step2+ devem ter .btnVoltar (e podem estar display:none no Step2)
    return pane.querySelector("#btnVoltar") || pane.querySelector(".btnVoltar");
  }

  function setStepperActive(pane, n){
    // Atualiza SOMENTE os dots/lines dentro do step vis√≠vel (evita conflito de ids duplicados)
    const dots = Array.from(pane.querySelectorAll(".stepper .dot"));
    const lines = Array.from(pane.querySelectorAll(".stepper .line"));

    dots.forEach((d, idx) => {
      const i = idx + 1;
      d.classList.toggle("active", i <= n);
    });

    // linhas: ativar at√© a anterior ao step atual (ex: step3 => ativa linhas 1-2 e 2-3)
    lines.forEach((l, idx) => {
      const a = idx + 1; // line 1-2 => idx 0
      l.classList.toggle("active", a < n);
    });
  }

  // Se voc√™ quiser ‚Äúblindar‚Äù a altura, pode travar minHeight baseado no Step1
  function lockMinHeight(fromStep, toStep){
    try{
      const fromEl = getStepEl(fromStep);
      const toEl   = getStepEl(toStep);
      if (!fromEl || !toEl) return;
      const h = fromEl.offsetHeight || 0;
      if (h > 0) toEl.style.minHeight = h + "px";
    }catch(e){}
  }

  // Limpa listeners antigos, clonando o bot√£o (evita duplicar addEventListener ao trocar step)
  function resetBtn(btn){
    if(!btn) return null;
    const clone = btn.cloneNode(true);
    btn.parentNode.replaceChild(clone, btn);
    return clone;
  }

  function bindStep(n){
    const pane = getStepEl(n);
    if(!pane) return;

    // Atualiza stepper do pane atual
    setStepperActive(pane, n);

    // Bot√µes
    let btnC = getBtnContinuar(pane);
    let btnV = getBtnVoltar(pane);

    btnC = resetBtn(btnC);
    btnV = resetBtn(btnV);

    // Voltar: s√≥ aparece a partir do Step2
    if (btnV){
      btnV.style.display = (n >= 2) ? "inline-flex" : "none";
      btnV.addEventListener("click", () => {
        const undo = setBtnLoading(btnV, "VOLTANDO...");
        showLoader("Voltando‚Ä¶", "Carregando etapa anterior.");
        setTimeout(() => {
          hideLoader();
          undo();
          const prev = Math.max(1, n - 1);
          setDisplayStep(prev);
          bindStep(prev);
        }, 220);
      });
    }

    // Continuar
    if (btnC){
      // Step5 vira ‚ÄúFinalizar e Concluir‚Äù
      if (n === 5){
        btnC.innerHTML = '<span>Finalizar e Concluir</span> <span class="arrow arrow-right">‚ûú</span>';
      }

      btnC.addEventListener("click", () => {
        // Valida√ß√£o no Step1
        if (n === 1 && typeof requireCodigo === "function"){
          const codigo = requireCodigo();
          if(!codigo) return;
        }

        // Valida√ß√£o no Step2 (campos obrigat√≥rios)
        if (n === 2 && typeof validateStep2 === "function"){
          const ok = validateStep2();
          if(!ok) return;
        }
        if (n === 3 && typeof validateStep3 === "function"){
          const ok = validateStep3();
          if(!ok) return;
        }
        if (n === 4 && typeof validateStep4 === "function"){
          const ok = validateStep4();
          if(!ok) return;
        }


        const undo = setBtnLoading(btnC, (n === 5 ? "FINALIZANDO..." : "CONTINUANDO..."));
        showLoader((n === 5 ? "Finalizando‚Ä¶" : "Carregando‚Ä¶"), (n === 5 ? "Concluindo e salvando informa√ß√µes." : "Preparando pr√≥xima etapa."));
        setTimeout(() => { hideLoader(); undo(); }, 260);

        const next = Math.min(5, n + 1);
        if (next === n) return;

        // opcional: trava altura (reduz ‚Äúdan√ßa‚Äù/scroll)
        lockMinHeight(n, next);

        if (!getStepEl(next)){
          Swal.fire({icon:"info", title:"Pr√≥xima etapa ainda n√£o dispon√≠vel", html:"A Etapa "+next+" ainda n√£o foi implementada neste arquivo. Seus dados da Etapa "+n+" permanecem aqui.", confirmButtonText:"Ok"});
          return;
        }

        setDisplayStep(next);

        // Sync do C√≥digo no topo da Etapa 2 (se existir)
        if (next === 2){
          const inCodigo = document.getElementById("codigoProjeto");
          const outCodigo = document.getElementById("codigoResumo");
          const outCodigo3 = document.getElementById("codigoResumo3");
          if (inCodigo){
            const v = (inCodigo.value || "").trim();
            if (v){
              if (outCodigo) outCodigo.textContent = v;
              if (outCodigo3) outCodigo3.textContent = v;
            }
          }
        }

        bindStep(next);
      });
    }
  }

  // Inicializa√ß√£o: garante Step1 vis√≠vel e bind
  function init(){
  // CEP: auto-preenchimento (Etapa 3 e 4)
  const step3=document.getElementById('step3');
  const step4=document.getElementById('step4');
  if(step3){ const cep3=step3.querySelector('#cepContratante'); if(cep3){ cep3.addEventListener('blur', ()=>preencherEnderecoViaCEP(step3)); } }
  if(step4){ const cep4=step4.querySelector('#cepContratante'); if(cep4){ cep4.addEventListener('blur', ()=>preencherEnderecoViaCEP(step4)); } }


    // Se seu HTML j√° mostra o Step1, ok. Se n√£o, for√ßamos.
    setDisplayStep(1);
    bindStep(1);

      // Valida√ß√µes ao perder o foco (Etapas 3 e 4)
      bindLiveValidationForForm(document.getElementById('formEtapa3'));
      bindLiveValidationForForm(document.getElementById('formEtapa4'));
}

  // roda quando tudo carregou
  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }

})();
</script>

<script>
/* SSO ERP √çMPAR: aplica usu√°rio/e-mail do login_erp no Gerador (todas as etapas) */
(function(){
  const KEY_EMAIL = "erp_user_email";
  const KEY_NOME  = "erp_user_nome";

  function setAll(nome, email){
    const nomeFinal = (nome || "").trim() || "Usu√°rio";
    const emailFinal = (email || "").trim() || "email@imparsistemas.com";

    // IDs usados no Menu + varia√ß√µes comuns em outros m√≥dulos
    const nomeIds = ["userNome","userName","usuarioNome","usuarioName","nomeUsuario","nomeUser"];
    const emailIds = ["userEmail","userMail","usuarioEmail","emailUsuario","emailUser","user-email"];

    nomeIds.forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.textContent = nomeFinal;
    });

    emailIds.forEach(id=>{
      const el = document.getElementById(id);
      if(el){
        if(el.tagName === "A"){
          el.textContent = emailFinal;
          el.href = "mailto:" + emailFinal;
        }else{
          el.textContent = emailFinal;
        }
      }
    });

    // Fallback por prefixo (caso existam m√∫ltiplos campos)
    document.querySelectorAll('[id^="userNome"],[id^="userName"]').forEach(el => { el.textContent = nomeFinal; });
    document.querySelectorAll('[id^="userEmail"],[id^="userMail"]').forEach(el => {
      if(el.tagName === "A"){
        el.textContent = emailFinal;
        el.href = "mailto:" + emailFinal;
      }else{
        el.textContent = emailFinal;
      }
    });
  }


  function safeJsonParse(txt){
    try{ return JSON.parse(txt); }catch(e){ return null; }
  }

  function pickFirst(obj, keys){
    if(!obj) return "";
    for(const k of keys){
      if(obj[k]!==undefined && obj[k]!==null && String(obj[k]).trim()!=="") return String(obj[k]).trim();
    }
    return "";
  }

  function readUserFromStorage(storage){
    if(!storage) return {nome:"", email:""};

    // 1) ERPIMPAR_USER (mais "oficial" no menu atual)
    const k1 = storage.getItem("ERPIMPAR_USER");
    if(k1){
      const o = safeJsonParse(k1);
      const nome = pickFirst(o, ["nome","name","Nome","user","usuario","Usu√°rio"]);
      const email = pickFirst(o, ["email","Email","mail","e-mail","usuarioEmail","userEmail"]);
      if(nome || email) return {nome, email};
    }

    // 2) impar_user (legado)
    const k2 = storage.getItem("impar_user");
    if(k2){
      const o = safeJsonParse(k2);
      const nome = pickFirst(o, ["Nome","nome","name"]);
      const email = pickFirst(o, ["Email","email","mail"]);
      if(nome || email) return {nome, email};
    }

    // 3) usuarioLogado (outro legado)
    const k3 = storage.getItem("usuarioLogado");
    if(k3){
      const o = safeJsonParse(k3);
      const nome = pickFirst(o, ["Nome","nome","name","respons√°vel","responsavel"]);
      const email = pickFirst(o, ["Email","email","mail"]);
      if(nome || email) return {nome, email};
    }

    // 4) chaves "diretas"
    const nome = storage.getItem("erp_user_nome") || storage.getItem("erp_user_name") || "";
    const email = storage.getItem("erp_user_email") || storage.getItem("erp_user_mail") || "";
    if(nome || email) return {nome: (nome||"").trim(), email: (email||"").trim()};

    return {nome:"", email:""};
  }

  function getFromSession(){
    // tenta v√°rios formatos (sessionStorage √© o padr√£o do login_erp)
    const fromSess = readUserFromStorage(sessionStorage);
    if(fromSess.nome || fromSess.email) return fromSess;

    // fallback espec√≠fico do login_erp antigo
    const nome = (sessionStorage.getItem("erp_user_nome")||"").trim();
    const email = (sessionStorage.getItem("erp_user_email")||"").trim();
    return { nome, email };
  }

  async function getFromUsuariosJson(email){
    if(!email) return { nome:"", email:"" };
    try{
      // De /documentos/ -> /usuarios.json
      const res = await fetch("../usuarios.json", { cache: "no-store" });
      if(!res.ok) throw new Error("usuarios.json: " + res.status);
      const usuarios = await res.json();
      const u = (Array.isArray(usuarios) ? usuarios : (usuarios.usuarios || usuarios.data || [])).find(x=>{
        const e = (x && (x.email || x.usuario) || "");
        return e === email;
      });
      return { nome: (u && u.nome) ? u.nome : "", email };
    }catch(e){
      return { nome:"", email };
    }
  }

  async function resolveUser(){
    // 1) SessionStorage (padr√£o do login_erp / navega√ß√£o na mesma aba)
    let u = getFromSession();
    if(u.email || u.nome) return u;

    // 2) LocalStorage (quando abre em nova aba / persist√™ncia)
    u = readUserFromStorage(localStorage);
    if(u.email || u.nome) return u;

    // 3) Fallback: email salvo no login (localStorage) + JSON de usu√°rios
    let email = localStorage.getItem("erp_login_usuario") || "";
    if(email){
      const fromJson = await getFromUsuariosJson(email);
      return { nome: fromJson.nome || "", email: fromJson.email || email };
    }

    return { nome:"", email:"" };
  }

  async function applyUser(){
    const { nome, email } = await resolveUser();
    if(nome || email) setAll(nome, email);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    applyUser();

    // Reaplica algumas vezes para evitar timing/elementos escondidos/loader
    let tries = 0;
    const t = setInterval(()=>{
      tries++;
      applyUser();
      if(tries >= 12) clearInterval(t);
    }, 250);
  });

  window.addEventListener("pageshow", ()=>{
    // quando volta do cache/back-forward
    applyUser();
    setTimeout(applyUser, 300);
  });

})();
</script>

</body>
</html>
