<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ERP √çMPAR ‚Äî Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#020617;
  --card:#0b1220;
  --border:#1f2937;
  --text:#f9fafb;
  --muted:#cbd5e1;
  --blue:#1d4ed8;
  --green:#22c55e;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",sans-serif}

body{
  margin:0;
  height:100vh;
  background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
  display:flex;
  flex-direction:column;
  color:var(--text);
  overflow:hidden; /* sem scroll */
}

/* ‚úÖ Cabe√ßalho (fundo premium) */
header{
  padding:14px 24px;
  background:rgba(2,6,23,0.94);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  gap:14px;
}

.logo-ball{
  width:40px;height:40px;border-radius:16px;
  background:conic-gradient(from 210deg,#22c55e,#38bdf8,#1d4ed8,#fb923c,#22c55e);
}

header .brand small{
  font-size:11px;
  letter-spacing:.18em;
  color:#9ca3af;
}
header .brand strong{
  display:block;
  font-size:18px;
}

/* MAIN */
main{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px 12px;
}

.login-card{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:22px;
  padding:36px 36px 32px;
  box-shadow:0 30px 80px rgba(0,0,0,.55);
}

h1{
  margin:0 0 8px;
  font-size:22px;
}
p{
  margin:0 0 22px;
  color:var(--muted);
  font-size:14px;
  line-height:1.35;
}

label{
  display:block;
  margin:14px 0 6px;
  font-size:14px;
  color:var(--muted);
}

select,input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
  font-size:15px;
}

/* ‚úÖ SENHA + OLHO FUNCIONANDO E CLIC√ÅVEL */
.password{
  position:relative;
}
.password input{
  padding-right:48px; /* espa√ßo pro olho */
}
.password button{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  width:34px;
  height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#020617;  /* mesmo fundo do campo */
  border:none;         /* sem borda */
  color:#9ca3af;
  font-size:16px;
  cursor:pointer;
  border-radius:10px;
  z-index:2;           /* garante que fica por cima */
}
.password button:hover{color:#e5e7eb}

.remember{
  display:flex;
  align-items:center;
  gap:10px;
  margin:16px 0 22px;
  font-size:14px;
  color:var(--muted);
}
.remember input{
  width:16px;height:16px;
  accent-color:var(--green);
}

button.login{
  width:100%;
  padding:15px;
  border:none;
  border-radius:999px;
  background:linear-gradient(120deg,var(--blue),var(--green));
  color:#fff;
  font-size:15px;
  font-weight:700;
  letter-spacing:.12em;
  cursor:pointer;
}

/* ‚úÖ Rodap√© com a MESMA cor do cabe√ßalho */
footer{
  padding:12px 24px;
  font-size:12px;
  color:#9ca3af;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background:rgba(2,6,23,0.94);   /* igual ao header */
  border-top:1px solid var(--border);
}
</style>
</head>

<body>

<header>
  <div class="logo-ball"></div>
  <div class="brand">
    <small>PLATAFORMA</small>
    <strong>ERP √çMPAR</strong>
    <small>Gest√£o integrada de obras & contratos</small>
  </div>
</header>

<main>
  <div class="login-card">
    <h1>Login ‚Äî ERP √çMPAR</h1>
    <p>Selecione seu usu√°rio corporativo, informe a senha e acesse a plataforma.</p>

    <label for="usuario">Usu√°rio</label>
    <select id="usuario">
      <option>Selecione o usu√°rio</option>
    </select>

    <label for="senha">Senha</label>
    <div class="password">
      <input id="senha" type="password" placeholder="Digite sua senha" autocomplete="current-password">
      <button id="btnOlho" type="button" aria-label="Mostrar/ocultar senha" title="Mostrar/ocultar senha">üëÅ</button>
    </div>

    <div class="remember">
      <input id="lembrar" type="checkbox">
      <span>Lembrar meu usu√°rio (e senha) neste computador</span>
    </div>

    <button class="login" type="button">ENTRAR</button>
  </div>
</main>

<footer>
  <span>¬© 2025 ERP √çMPAR</span>
  <span>Ambiente interno ¬∑ Desenvolvido por √çMPAR Sistemas</span>
</footer>

<script>
  const KEY = "ERPIMPAR_USER";

  function getStore(remember){
    return remember ? localStorage : sessionStorage;
  }

  async function carregarUsuarios() {
  // 1) tenta com cache-bust (resolve cache do Pages)
  const url = "usuarios_erp.json?v=" + Date.now();

  const r = await fetch(url, { cache: "no-store" });
  if (!r.ok) throw new Error("HTTP " + r.status + " ao abrir " + url);

  // 2) l√™ como texto e remove BOM (resolve JSON com caractere invis√≠vel)
  const txt = await r.text();
  const clean = txt.replace(/^\uFEFF/, "").trim(); // remove BOM

  const data = JSON.parse(clean);

  if (!Array.isArray(data)) {
    throw new Error("usuarios_erp.json n√£o √© um array. (Formato inesperado)");
  }
  return data;
}


  function limparSessao(){
    localStorage.removeItem(KEY);
    sessionStorage.removeItem(KEY);
  }

  function salvarSessao(user, remember){
    const store = getStore(remember);
    // n√£o salva senha
    const payload = {
      nome: user.nome,
      email: user.email,
      cargo: user.cargo,
      telefone: user.telefone,
      foto: user.foto,
      modulos: Array.isArray(user.modulos) ? user.modulos : [],
      ts: Date.now(),
      remember: !!remember
    };
    store.setItem(KEY, JSON.stringify(payload));
    // garante que n√£o ficou nada no outro storage
    (remember ? sessionStorage : localStorage).removeItem(KEY);
  }

  (async () => {
    const sel = document.getElementById("usuario");
    const inpSenha = document.getElementById("senha");
    const chkLembrar = document.getElementById("lembrar");
    const btnEntrar = document.querySelector("button.login");

    let usuarios = [];
    try{
      usuarios = await carregarUsuarios();
      console.log("Usu√°rios carregados:", usuarios.length, usuarios[0]);

      // popula select      sel.innerHTML = `<option value="">Selecione o usu√°rio</option>`;
      usuarios.forEach((u, idx) => {
        const opt = document.createElement("option");
        opt.value = String(idx);
        opt.textContent = u.nome;
        sel.appendChild(opt);
      });
    }catch(e){
      console.error(e);
      alert("Erro ao carregar usu√°rios (JSON). Verifique se usuarios_erp.json est√° na raiz do GitHub.");
      return;
    }

    // se j√° estiver logado, pula pro menu
    const sess = localStorage.getItem(KEY) || sessionStorage.getItem(KEY);
    if(sess){
      window.location.href = "menu.html";
      return;
    }

    btnEntrar.addEventListener("click", () => {
      const idx = sel.value;
      const senhaDigitada = inpSenha.value || "";

      if(idx === ""){
        alert("Selecione um usu√°rio.");
        return;
      }

      const user = usuarios[Number(idx)];
      if(!user){
        alert("Usu√°rio inv√°lido.");
        return;
      }

      if(String(user.senha || "") !== String(senhaDigitada)){
        alert("Senha incorreta.");
        return;
      }

      salvarSessao(user, chkLembrar.checked);
      window.location.href = "menu.html";
    });
  })();
</script>

<script>
  // ‚úÖ Olho funcionando
  const senha = document.getElementById("senha");
  const btnOlho = document.getElementById("btnOlho");

  btnOlho.addEventListener("click", () => {
    const isPwd = senha.type === "password";
    senha.type = isPwd ? "text" : "password";
    // opcional: mudar √≠cone para dar feedback
    btnOlho.textContent = isPwd ? "üôà" : "üëÅ";
  });
</script>

</body>
</html>
