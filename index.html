<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>ERP √çMPAR ‚Äî Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg:#020617;
  --card:#0b1220;
  --border:#1f2937;
  --text:#f9fafb;
  --muted:#cbd5e1;
  --blue:#1d4ed8;
  --green:#22c55e;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",sans-serif}

body{
  margin:0;
  height:100vh;
  background:linear-gradient(120deg,#0b1e4a,#0e3b6e,#0f766e);
  display:flex;
  flex-direction:column;
  color:var(--text);
  overflow:hidden;
}

/* HEADER */
header{
  padding:14px 24px;
  background:rgba(2,6,23,0.94);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  gap:14px;
}

.logo-ball{
  width:40px;height:40px;border-radius:16px;
  background:conic-gradient(from 210deg,#22c55e,#38bdf8,#1d4ed8,#fb923c,#22c55e);
  box-shadow:0 0 0 1px rgba(255,255,255,.04), 0 18px 40px rgba(0,0,0,.35);
}

header .brand small{
  font-size:11px;
  letter-spacing:.18em;
  color:#9ca3af;
}
header .brand strong{
  display:block;
  font-size:18px;
}

/* MAIN */
main{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px 12px;
}

/* entrada do card */
@keyframes cardIn{
  from{opacity:0; transform:translateY(10px) scale(.985);}
  to{opacity:1; transform:translateY(0) scale(1);}
}

.login-card{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:22px;
  padding:36px 36px 30px;
  box-shadow:0 30px 80px rgba(0,0,0,.55);
  animation:cardIn .35s ease-out both;
  transition:transform .18s ease, box-shadow .18s ease;
}
.login-card:hover{
  transform:translateY(-1px);
  box-shadow:0 36px 95px rgba(0,0,0,.58);
}

h1{margin:0 0 8px;font-size:22px}
p{margin:0 0 22px;color:var(--muted);font-size:14px;line-height:1.35}

label{display:block;margin:14px 0 6px;font-size:14px;color:var(--muted)}

select,input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
  font-size:15px;
  outline:none;
  transition:border-color .14s ease, box-shadow .14s ease, transform .08s ease;
}
select:hover,input:hover{border-color:rgba(148,163,184,.55)}
select:focus,input:focus{
  border-color:rgba(29,78,216,.95);
  box-shadow:0 0 0 4px rgba(29,78,216,.18);
}
select:active,input:active{transform:scale(.997)}

.password{position:relative}
.password input{padding-right:48px}

.password button{
  position:absolute;
  right:12px; top:50%;
  transform:translateY(-50%);
  width:34px;height:34px;
  display:flex;align-items:center;justify-content:center;
  background:#020617;
  border:none;
  color:#9ca3af;
  font-size:16px;
  cursor:pointer;
  border-radius:10px;
  z-index:2;
  transition:transform .12s ease, color .12s ease, background .12s ease;
}
.password button:hover{
  color:#e5e7eb;
  background:rgba(255,255,255,.04);
}
.password button:active{transform:translateY(-50%) scale(.96)}

.remember{
  display:flex;
  align-items:center;
  gap:10px;
  margin:16px 0 18px;
  font-size:14px;
  color:var(--muted);
}
.remember input{
  width:16px;height:16px;
  accent-color:var(--green);
}
.remember input:focus{
  outline:none;
  box-shadow:0 0 0 4px rgba(29,78,216,.18);
  border-radius:4px;
}

/* bot√£o wax */
button.login{
  width:100%;
  padding:15px;
  border:none;
  border-radius:999px;
  background:linear-gradient(120deg,var(--blue),var(--green));
  color:#fff;
  font-size:15px;
  font-weight:800;
  letter-spacing:.12em;
  cursor:pointer;
  transition:transform .12s ease, box-shadow .14s ease, filter .14s ease, letter-spacing .14s ease;
  box-shadow:0 14px 30px rgba(29,78,216,.20);
}
button.login:hover{
  filter:saturate(1.06) brightness(1.03);
  transform:translateY(-1px);
  letter-spacing:.16em;
  box-shadow:0 18px 42px rgba(34,197,94,.18), 0 16px 34px rgba(29,78,216,.22);
}
button.login:active{
  transform:translateY(1px) scale(.992);
  box-shadow:0 10px 22px rgba(0,0,0,.35);
}
button.login.is-loading{
  pointer-events:none;
  opacity:.92;
  filter:saturate(1.02);
}

#loginStatus{
  margin-top:12px;
  font-size:12px;
  color:#cbd5e1;
  min-height:16px;
}

/* FOOTER */
footer{
  padding:12px 24px;
  font-size:12px;
  color:#9ca3af;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background:rgba(2,6,23,0.94);
  border-top:1px solid var(--border);
}

@media (prefers-reduced-motion: reduce){
  .login-card{animation:none; transition:none;}
  *{transition:none !important;}
}
/* =========================
   √çMPAR PREMIUM ‚Äî UI ONLY
   (sem mexer em l√≥gica)
   ========================= */

/* Evita scroll lateral e melhora viewport */
html, body { overflow-x: hidden; }
body { min-height: 100svh; }

/* Foco azul brilhante (desktop + mobile) */
input:focus, select:focus, textarea:focus{
  outline: none !important;
  border-color: rgba(59,130,246,.95) !important;
  box-shadow:
    0 0 0 3px rgba(59,130,246,.22),
    0 0 0 8px rgba(59,130,246,.10),
    0 18px 40px rgba(0,0,0,.35) !important;
  transform: translateY(-1px);
  transition: box-shadow .14s ease, border-color .14s ease, transform .14s ease;
}

/* Hover/press premium no bot√£o principal */
button, .btn, #btnEntrar{
  transition: transform .14s ease, filter .14s ease, box-shadow .14s ease;
}
#btnEntrar:hover{
  transform: translateY(-1px);
  filter: brightness(1.06);
  box-shadow: 0 18px 40px rgba(0,0,0,.38);
}
#btnEntrar:active{
  transform: translateY(0px) scale(.99);
  filter: brightness(.98);
}

/* Erro de senha (inline) */
.status-error{
  color: rgba(239,68,68,.98) !important;
  font-weight: 800 !important;
}
.input-error{
  border-color: rgba(239,68,68,.92) !important;
  box-shadow:
    0 0 0 3px rgba(239,68,68,.20),
    0 0 0 8px rgba(239,68,68,.10),
    0 18px 40px rgba(0,0,0,.35) !important;
}

/* Loader overlay premium */
.loader{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(2,6,23,.70);
  backdrop-filter: blur(10px);
  z-index: 9999;
}
.loader.hidden{ display:none; }


/* ===== Loader overlay (n√£o empurra layout) ===== */
#pageLoader{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  background: rgba(2,6,23,.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 9999;
}
#pageLoader.hidden{ display:none; }

.loader-card{
  width: min(520px, 92vw);
  background: rgba(3,10,24,.88);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
  padding: 18px 18px 16px;
}
.loader-row{ display:flex; gap:14px; align-items:center; }
.loader-title{ font-size: 18px; font-weight: 800; letter-spacing:.2px; color:#e5e7eb; }
.loader-sub{ font-size: 13px; color: rgba(226,232,240,.75); margin-top:4px; }
.spinner{
  width: 46px; height: 46px; border-radius: 999px;
  border: 4px solid rgba(59,130,246,.22);
  border-top-color: rgba(34,197,94,.85);
  animation: spin 1.05s linear infinite;
  flex: 0 0 auto;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== Foco mais ‚Äúbrilhante‚Äù no desktop ===== */
@media (min-width: 768px){
  input:focus, select:focus{
    border-color: rgba(59,130,246,.95) !important;
    box-shadow: 0 0 0 6px rgba(59,130,246,.22), 0 0 22px rgba(59,130,246,.25) !important;
  }
}

/* ===== Erro de senha persiste (vermelho) ===== */
.input-error{
  border-color: rgba(239,68,68,.95) !important;
  box-shadow: 0 0 0 6px rgba(239,68,68,.18), 0 0 22px rgba(239,68,68,.22) !important;
}
#loginStatus.status-error{
  color: #ef4444 !important;
  font-weight: 700;
}

.loader-card{
  width: min(520px, 92vw);
  background: rgba(6, 14, 34, .92);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
  padding: 22px 20px;
  box-shadow: 0 24px 70px rgba(0,0,0,.55);
  text-align: center;
}
.loader-spin{
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 4px solid rgba(255,255,255,.12);
  border-top-color: rgba(59,130,246,.95);
  border-right-color: rgba(16,185,129,.85);
  margin: 0 auto 12px;
  animation: spin .9s linear infinite;
}
.loader-title{
  font-size: 18px;
  font-weight: 900;
  letter-spacing: .4px;
}
.loader-sub{
  margin-top: 4px;
  color: rgba(148,163,184,.95);
  font-size: 13px;
  line-height: 1.35;
}
@keyframes spin{ to { transform: rotate(360deg);} }

/* Transi√ß√µes suaves para o card inteiro */
.card{
  animation: fadeUp .28s ease both;
}
@keyframes fadeUp{
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

</style>
</head>

<body>
<header>
  <div class="logo-ball"></div>
  <div class="brand">
    <small>PLATAFORMA</small>
    <strong>ERP √çMPAR</strong>
    <small>Gest√£o integrada de obras & contratos</small>
  </div>
</header>

<main>
  <div class="login-card">
    <h1>Login ‚Äî ERP √çMPAR</h1>
    <p>Selecione seu usu√°rio corporativo, informe a senha e acesse a plataforma.</p>

    <label for="usuario">Usu√°rio</label>
    <select id="usuario">
      <option value="">Carregando usu√°rios...</option>
    </select>

    <label for="senha">Senha</label>
    <div class="password">
      <input id="senha" type="password" placeholder="Digite sua senha" autocomplete="current-password" />
      <button id="btnOlho" type="button" aria-label="Mostrar/ocultar senha" title="Mostrar/ocultar senha">üëÅ</button>
    </div>

    <div class="remember">
      <input id="lembrar" type="checkbox" />
      <span>Lembrar meu usu√°rio (e senha) neste computador</span>
    </div>

    <button class="login" id="btnEntrar" type="button">ENTRAR</button>
    <div id="loginStatus"></div>
  </div>
</main>

<footer>
  <span>¬© 2025 ERP √çMPAR</span>
  <span>Ambiente interno ¬∑ Desenvolvido por √çMPAR Sistemas</span>
</footer>

<script>
  // ====== Olho funcionando ======
  const senhaEl = document.getElementById("senha");
  const btnOlho = document.getElementById("btnOlho");
  btnOlho.addEventListener("click", () => {
    const isPwd = senhaEl.type === "password";
    senhaEl.type = isPwd ? "text" : "password";
    btnOlho.textContent = isPwd ? "üôà" : "üëÅ";
  });

  // ====== Login √∫nico ======
  const KEY = "ERPIMPAR_USER";
  const selUsuario = document.getElementById("usuario");
  const chkLembrar = document.getElementById("lembrar");
  const btnEntrar = document.getElementById("btnEntrar");
    const statusEl = document.getElementById("loginStatus");
  let lastUserKey = null;
  let hasAuthError = false;

  selUsuario.addEventListener("change", () => {
    const k = selUsuario.value || "";
    if (k !== lastUserKey) {
      clearAuthError();
    }
    lastUserKey = k;
    // ao trocar de usu√°rio, sempre limpa senha e volta borda azul
    if (senhaEl) senhaEl.value = "";
  });
  // ====== Loader Premium (UI only) ======
  const loaderEl = document.getElementById("pageLoader");
  function showLoader(title, sub){
    if(!loaderEl) return;
    const t = loaderEl.querySelector(".loader-title");
    const s = loaderEl.querySelector(".loader-sub");
    if (t && title) t.textContent = title;
    if (s && sub) s.textContent = sub;
    loaderEl.classList.remove("hidden");
    loaderEl.setAttribute("aria-hidden","false");
  }
  function hideLoader(){
    if(!loaderEl) return;
    loaderEl.classList.add("hidden");
    loaderEl.setAttribute("aria-hidden","true");
  }

  // ====== Erro visual no campo senha (UI only) ======
  function markSenhaErro(on){
    if(!senhaEl) return;
    senhaEl.classList.toggle("input-error", !!on);
  }

  function setStatus(msg){
    if(!statusEl) return;
    statusEl.textContent = msg || "";
    statusEl.classList.toggle("status-error", !!msg);
  }

  function clearAuthError(){
    hasAuthError = false;
    markSenhaErro(false);
    setStatus("");
  }

  function getStore(remember){
    return remember ? localStorage : sessionStorage;
  }

  function salvarSessao(user, remember){
    const store = getStore(remember);
    const payload = {
      nome: user.nome || "",
      email: user.email || "",
      cargo: user.cargo || "",
      telefone: user.telefone || "",
      foto: user.foto || "",
      modulos: Array.isArray(user.modulos) ? user.modulos : [],
      ts: Date.now(),
      remember: !!remember
    };
    store.setItem(KEY, JSON.stringify(payload));
    (remember ? sessionStorage : localStorage).removeItem(KEY);
  }

  async function carregarUsuarios(){
    // cache-bust + remove BOM
    const url = "/usuarios_erp.json?v=" + Date.now();
    const r = await fetch(url, { cache: "no-store" });
    if(!r.ok) throw new Error("HTTP " + r.status + " ao abrir " + url);
    const txt = await r.text();
    const clean = txt.replace(/^\uFEFF/, "").trim();
    const data = JSON.parse(clean);
    if(!Array.isArray(data)) throw new Error("usuarios_erp.json n√£o √© um array");
    return data;
  }

  function getSessao(){
    const raw = localStorage.getItem(KEY) || sessionStorage.getItem(KEY);
    if(!raw) return null;
    try { return JSON.parse(raw); } catch { return null; }
  }

  (async () => {
    // se j√° tiver sess√£o, vai direto pro menu
    const s = getSessao();
    if(s){
      showLoader();
        window.location.href = "menu.html";
      return;
    }

    let usuarios = [];
    try{
      usuarios = await carregarUsuarios();
      selUsuario.innerHTML = `<option value="">Selecione o usu√°rio</option>`;
      usuarios.forEach((u, idx) => {
        const opt = document.createElement("option");
        opt.value = String(idx);
        opt.textContent = u.nome || ("Usu√°rio " + (idx+1));
        selUsuario.appendChild(opt);
      });
      setStatus("");
    }catch(e){
      console.error(e);
      selUsuario.innerHTML = `<option value="">Erro ao carregar usu√°rios</option>`;
      setStatus("Erro ao carregar usu√°rios (JSON). Confira se usuarios_erp.json est√° publicado na raiz do site.");
      return;
    }

    btnEntrar.addEventListener("click", () => {
      const idx = selUsuario.value;
      const senhaDigitada = (senhaEl?.value || "").trim();
      lastUserKey = idx || "";

      if(!idx){
        // sem usu√°rio: n√£o √© erro de senha
        hasAuthError = false;
        markSenhaErro(false);
        setStatus("Selecione um usu√°rio.");
        return;
      }

      if(!senhaDigitada){
        // se j√° errou a senha para esse usu√°rio, mant√©m o estado vermelho
        markSenhaErro(!!hasAuthError);
        setStatus(hasAuthError ? "Senha incorreta. Tente novamente." : "Digite sua senha.");
        return;
      }

      const u = usuarios[Number(idx)];
      if(!u){
        hasAuthError = false;
        markSenhaErro(false);
        setStatus("Usu√°rio inv√°lido.");
        return;
      }

      // valida√ß√£o de senha
      if(String(senhaDigitada) !== String(u.senha || "")){
        hasAuthError = true;
        markSenhaErro(true);
        setStatus("Senha incorreta. Tente novamente.");
        return;
      }

      // sucesso: limpa erro e usa loader premium (sem mensagem verde)
      clearAuthError();
      showLoader("Carregando m√≥dulos‚Ä¶", "Preparando sua sess√£o e carregando seus cards.");
      btnEntrar.classList.add("loading");
      btnEntrar.textContent = "ENTRANDO‚Ä¶";

    <div class="loader-card">
      <div class="loader-spin" aria-hidden="true"></div>
      <div class="loader-title">Carregando m√≥dulos‚Ä¶</div>
      <div class="loader-sub">Preparando seus cards e permiss√µes de acesso.</div>
    </div>


      try{
        const remember = !!chkLembrar?.checked;
        salvarSessao(u, remember);
      }catch(e){ /* UI only */ }


    <div class="loader-card">
      <div class="loader-spin" aria-hidden="true"></div>
      <div class="loader-title">Carregando m√≥dulos‚Ä¶</div>
      <div class="loader-sub">Preparando seus cards e permiss√µes de acesso.</div>
    </div>

      // redireciona para menu
      setTimeout(() => {
        window.location.href = "menu.html";
      }, 1200);

    <div class="loader-card">
      <div class="loader-spin" aria-hidden="true"></div>
      <div class="loader-title">Carregando m√≥dulos‚Ä¶</div>
      <div class="loader-sub">Preparando seus cards e permiss√µes de acesso.</div>
    </div>

    });
})();
</script>
<!-- Loader Premium (UI only) -->
  <div id="pageLoader" class="loader hidden" aria-hidden="true">
    <div class="loader-card">
      <div class="loader-spin" aria-hidden="true"></div>
      <div class="loader-title">Carregando m√≥dulos‚Ä¶</div>
      <div class="loader-sub">Preparando seus cards e permiss√µes de acesso.</div>
    </div>
  </div>

</body>
</html>
